<!DOCTYPE html>
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Signing HTTP Messages</title><script>
function anchorRewrite() {
  map = { };
  if (window.location.hash.length >= 1) {
    var fragid = window.location.hash.substr(1);
    if (fragid) {
      if (! document.getElementById(fragid)) {
        var prefix = "rfc.";
        var mapped = map[fragid];
        if (mapped) {
          window.location.hash = mapped;
        } else if (fragid.indexOf("section-") == 0) {
          window.location.hash = prefix + "section." + fragid.substring(8);
        } else if (fragid.indexOf("appendix-") == 0) {
          window.location.hash = prefix + "section." + fragid.substring(9);
        } else if (fragid.indexOf("s-") == 0) {
          var postfix = fragid.substring(2);
          if (postfix.startsWith("abstract")) {
            window.location.hash = prefix + postfix;
          } else if (postfix.startsWith("note-")) {
            window.location.hash = prefix + "note." + postfix.substring(5);
          } else {
            window.location.hash = prefix + "section." + postfix;
          }
        } else if (fragid.indexOf("p-") == 0) {
          var r = fragid.substring(2);
          var p = r.indexOf("-");
          if (p >= 0) {
            window.location.hash = prefix + "section." + r.substring(0, p) + ".p." + r.substring(p + 1);
          }
        }
      }
    }  
  }
}
window.addEventListener('hashchange', anchorRewrite);
window.addEventListener('DOMContentLoaded', anchorRewrite);
</script><!--Specified as xml2rfc-ext-css-contents--><style>
body {
  font: 16px "Helvetica Neue","Open Sans",Helvetica,Calibri,sans-serif;
  color: #333;
  font-size-adjust: 0.5;
  line-height: 24px;
  margin: 75px auto;
  max-width: 624px;
  padding: 0 5px;
}

.title, .filename, h1, h2, h3, h4, h5 {
  font: 16px "Roboto Condensed","Helvetica Neue","Open Sans",Helvetica,Calibri,sans-serif;
  font-size-adjust: 0.5;
  font-weight: bold;
  color: #333;
  line-height: 100%;
  margin: 1.2em 0 0.3em;
}
.title, #rfc\.title h1 { font-size: 32px; }
h1, section h1, h2, section h2, section h3, nav h2 { font-size: 20px; }
h3, section h4, h4, section h5 { font-size: 16px; }
h1 a[href], h2 a[href], h3 a[href], h4 a[href] {
  color: #333;
}

table {
  margin-left: 0em;
  border-collapse: collapse;
}
th {
  text-align: left;
  border-bottom: 2px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
  vertical-align: top;
}
tr:nth-child(2n+1) > td,
tr:nth-child(2n+1) > th {
  background-color: #f9f9f9;
}
td.reference {
  max-width: 200px;
  border-top: none;
  padding-right: 1em;
}
.right {
  text-align: right;
}


table.header, table#rfc\.headerblock {
  width: 100%;
}
table.header td, table#rfc\.headerblock td {
  border: none;
  background-color: transparent;
  color: black;
  padding: 0;
}
.filename {
  display: block;
  color: rgb(119, 119, 119);
  font-size: 20px;
  font-weight: normal;
  line-height: 100%;
  margin: 10px 0 32px;
}
#rfc\.abstract+p, #rfc\.abstract+p code, #rfc\.abstract+p samp, #rfc\.abstract+p tt {
  font-size: 20px;
  line-height: 28px;
}

samp, tt, code, pre, span.tt {
  font-size: 13.5px;
  font-family: Consolas, monospace;
  font-size-adjust: none;
}
pre {
  background-color: #eee;
  border: 1px solid #ddd;
  overflow-x: auto;
  padding: 5px;
  margin: 5px;
}
.figure, caption {
  font-style: italic;
  margin: 0 1.5em;
  text-align: left;
}

address {
  margin: 16px 2px;
  line-height: 20px;
}
.vcard {
  font-style: normal;
}
.vcardline {
  display: block;
}
.vcardline .fn, address b {
  font-weight: normal;
}
.vcardline .hidden {
  display: none;
}

dl {
  margin-left: 1em;
}
dl.dl-horizontal: {
  margin-left: 0;
}
dl > dt {
  float: left;
  margin-right: 1em;
}
dl.nohang > dt {
  float: none;
}
dl > dd {
  margin-bottom: .5em;
}
dl.compact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}
ul.empty {
  list-style-type: none;
}
ul.empty li {
  margin-top: .5em;
}

hr {
  border: 0;
  border-top: 1px solid #eee;
}
hr.noprint {
  display: none;
}

a {
  text-decoration: none;
}
a[href] {
  color: #2a6496;
}
a[href]:hover {
  background-color: #eee;
}

p, ol, ul, li {
  padding: 0;
}
p {
  margin: 0.5em 0;
}
ol, ul {
  margin: 0.2em 0 0.2em 2em;
}
li {
  margin: 0.2em 0;
}
address {
  font-style: normal;
}

ul.toc ul {
  margin: 0 0 0 2em;
}
ul.toc li {
  list-style: none;
  margin: 0;
}

@media screen and (min-width: 924px) {
  body {
    padding-right: 350px;
  }
  body>ul.toc, body>#rfc\.toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 500px);
    width: 300px;
    z-index: 1;
    overflow: auto;
    overscroll-behavior: contain;
  }
  body>#rfc\.toc {
    top: 55px;
  }
  body>ul.toc {
    top: 100px;
  }

  ul.toc {
    margin: 0 0 0 4px;
    font-size: 12px;
    line-height: 20px;
  }
  ul.toc ul {
    margin-left: 1.2em;
  }
}</style><link rel="Contents" href="#rfc.toc"><link rel="Author" href="#rfc.authors"><link rel="License" href="#rfc.copyrightnotice"><link rel="Chapter" title="1 Introduction" href="#rfc.section.1"><link rel="Chapter" title="2 Identifying and Canonicalizing Content" href="#rfc.section.2"><link rel="Chapter" title="3 HTTP Message Signatures" href="#rfc.section.3"><link rel="Chapter" title="4 The ‘Signature’ HTTP Header" href="#rfc.section.4"><link rel="Chapter" title="5 IANA Considerations" href="#rfc.section.5"><link rel="Chapter" title="6 Security Considerations" href="#rfc.section.6"><link rel="Chapter" title="7 References" href="#rfc.section.7"><link rel="Appendix" title="A Examples" href="#rfc.section.A"><link rel="Appendix" title="B Topics for Working Group Discussion" href="#rfc.section.B"><link rel="Appendix" title="Acknowledgements" href="#rfc.section.unnumbered-1"><link rel="Appendix" title="Document History" href="#rfc.section.unnumbered-2"><meta name="viewport" content="initial-scale=1"><meta name="generator" content="http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.1327, 2020/09/24 11:13:36, XSLT vendor: libxslt http://xmlsoft.org/XSLT/, via: https://github.com/cabo/kramdown-rfc2629 version 1.3.10"><meta name="keywords" content="PKI"><link rel="schema.dcterms" href="http://purl.org/dc/terms/"><meta name="dcterms.creator" content="Backman, A."><meta name="dcterms.creator" content="Richer, J."><meta name="dcterms.creator" content="Sporny, M."><meta name="dcterms.issued" content="2020-10-05"><meta name="dcterms.abstract" content="This document describes a mechanism for creating, encoding, and verifying digital signatures or message authentication codes over content within an HTTP message. This mechanism supports use cases where the full HTTP message may not be known to the signer, and where the message may be transformed (e.g., by intermediaries) before reaching the verifier."><meta name="description" content="This document describes a mechanism for creating, encoding, and verifying digital signatures or message authentication codes over content within an HTTP message. This mechanism supports use cases where the full HTTP message may not be known to the signer, and where the message may be transformed (e.g., by intermediaries) before reaching the verifier."></head><body><header><table class="header" id="rfc.headerblock"><tbody><tr><td class="left">HTTP Working Group</td><td class="right">A. Backman</td></tr><tr><td class="left">Internet-Draft</td><td class="right">Amazon</td></tr><tr><td class="left">Intended status: Standards Track</td><td class="right">J. Richer</td></tr><tr><td class="left">Expires: April 8, 2021</td><td class="right">Bespoke Engineering</td></tr><tr><td class="left"></td><td class="right">M. Sporny</td></tr><tr><td class="left"></td><td class="right">Digital Bazaar</td></tr><tr><td class="left"></td><td class="right">October 5, 2020</td></tr></tbody></table><div id="rfc.title"><h1>Signing HTTP Messages</h1><div class="filename"><a href="https://datatracker.ietf.org/doc/draft-ietf-httpbis-message-signatures" class="smpl">draft-ietf-httpbis-message-signatures-latest</a></div></div></header><section><h2 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h2><div id="rfc.abstract.p.1"><p>This document describes a mechanism for creating, encoding, and verifying digital signatures or message authentication codes over content within an HTTP message. This mechanism supports use cases where the full HTTP message may not be known to the signer, and where the message may be transformed (e.g., by intermediaries) before reaching the verifier.</p></div></section><section class="note"><h2 id="rfc.note.1"><a href="#rfc.note.1">Note to Readers</a></h2><div id="rfc.note.1.p.1"><p><em>RFC EDITOR: please remove this section before publication</em></p></div><div id="rfc.note.1.p.2"><p>This draft is based on draft-cavage-http-signatures-12. <a href="https://github.com/w3c-dvcg/http-signatures/issues?page=2&amp;q=is%3Aissue+is%3Aopen">The community</a> and the authors have identified several issues with the current text. Additionally, the authors have identified a number of features that are required in order to support additional use cases. In order to preserve continuity with the effort that has been put into draft-cavage-http-signatures-12, this draft maintains normative compatibility with it, and thus does not address these issues or include these features, as doing so requires making backwards-incompatible changes to normative requirements. While such changes are inevitable, the editor recommends that they be driven by working group discussion following adoption of the draft (see <a href="#wg-discuss" title="Topics for Working Group Discussion">Appendix B</a>). The editor requests that the working group recognize the intent of this initial draft and this recommendation when considering adoption of this draft.</p></div></section><section id="rfc.status"><h2><a href="#rfc.status">Status of this Memo</a></h2><div id="rfc.boilerplate.1.p.1"><p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p></div><div id="rfc.boilerplate.1.p.2"><p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF). Note that other groups may also distribute working documents as Internet-Drafts. The list of current Internet-Drafts is at <a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a>.</p></div><div id="rfc.boilerplate.1.p.3"><p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time. It is inappropriate to use Internet-Drafts as reference material or to cite them other than as “work in progress”.</p></div><div id="rfc.boilerplate.1.p.4"><p>This Internet-Draft will expire on April 8, 2021.</p></div></section><section id="rfc.copyrightnotice"><h2><a href="#rfc.copyrightnotice">Copyright Notice</a></h2><div id="rfc.boilerplate.2.p.1"><p>Copyright (c) 2020 IETF Trust and the persons identified as the document authors. All rights reserved.</p></div><div id="rfc.boilerplate.2.p.2"><p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (<a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a>) in effect on the date of publication of this document. Please review these documents carefully, as they describe your rights and restrictions with respect to this document. Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p></div></section><hr class="noprint"><nav id="rfc.toc"><h2 class="np"><a href="#rfc.toc">Table of Contents</a></h2><ul class="toc"><li><a href="#rfc.section.1">1.</a>   <a href="#intro">Introduction</a><ul><li><a href="#rfc.section.1.1">1.1.</a>   <a href="#requirements-discussion">Requirements Discussion</a></li><li><a href="#rfc.section.1.2">1.2.</a>   <a href="#about_sigs">HTTP Message Transformations</a></li><li><a href="#rfc.section.1.3">1.3.</a>   <a href="#safe-transformations">Safe Transformations</a></li><li><a href="#rfc.section.1.4">1.4.</a>   <a href="#definitions">Conventions and Terminology</a></li></ul></li><li><a href="#rfc.section.2">2.</a>   <a href="#content-identifiers">Identifying and Canonicalizing Content</a><ul><li><a href="#rfc.section.2.1">2.1.</a>   <a href="#http-header-fields">HTTP Header Fields</a><ul><li><a href="#rfc.section.2.1.1">2.1.1.</a>   <a href="#canonicalization-examples">Canonicalization Examples</a></li></ul></li><li><a href="#rfc.section.2.2">2.2.</a>   <a href="#signature-creation-time">Signature Creation Time</a></li><li><a href="#rfc.section.2.3">2.3.</a>   <a href="#signature-expiration-time">Signature Expiration Time</a></li><li><a href="#rfc.section.2.4">2.4.</a>   <a href="#target-endpoint">Target Endpoint</a><ul><li><a href="#rfc.section.2.4.1">2.4.1.</a>   <a href="#canonicalization-examples-1">Canonicalization Examples</a></li></ul></li></ul></li><li><a href="#rfc.section.3">3.</a>   <a href="#message-signatures">HTTP Message Signatures</a><ul><li><a href="#rfc.section.3.1">3.1.</a>   <a href="#signature-metadata">Signature Metadata</a></li><li><a href="#rfc.section.3.2">3.2.</a>   <a href="#create">Creating a Signature</a><ul><li><a href="#rfc.section.3.2.1">3.2.1.</a>   <a href="#choose-metadata">Choose and Set Signature Metadata Properties</a></li><li><a href="#rfc.section.3.2.2">3.2.2.</a>   <a href="#canonicalization">Create the Signature Input</a></li><li><a href="#rfc.section.3.2.3">3.2.3.</a>   <a href="#sign-sig-input">Sign the Signature Input</a></li></ul></li><li><a href="#rfc.section.3.3">3.3.</a>   <a href="#verify">Verifying a Signature</a><ul><li><a href="#rfc.section.3.3.1">3.3.1.</a>   <a href="#enforcing-application-requirements">Enforcing Application Requirements</a></li></ul></li></ul></li><li><a href="#rfc.section.4">4.</a>   <a href="#sig">The ‘Signature’ HTTP Header</a><ul><li><a href="#rfc.section.4.1">4.1.</a>   <a href="#params">Signature Header Parameters</a></li><li><a href="#rfc.section.4.2">4.2.</a>   <a href="#example">Example</a></li></ul></li><li><a href="#rfc.section.5">5.</a>   <a href="#iana">IANA Considerations</a><ul><li><a href="#rfc.section.5.1">5.1.</a>   <a href="#hsa-registry">HTTP Signature Algorithms Registry</a><ul><li><a href="#rfc.section.5.1.1">5.1.1.</a>   <a href="#iana-hsa-template">Registration Template</a></li><li><a href="#rfc.section.5.1.2">5.1.2.</a>   <a href="#iana-hsa-contents">Initial Contents</a></li></ul></li><li><a href="#rfc.section.5.2">5.2.</a>   <a href="#param-registry">HTTP Signature Parameters Registry</a><ul><li><a href="#rfc.section.5.2.1">5.2.1.</a>   <a href="#iana-param-template">Registration Template</a></li><li><a href="#rfc.section.5.2.2">5.2.2.</a>   <a href="#iana-param-contents">Initial Contents</a></li></ul></li></ul></li><li><a href="#rfc.section.6">6.</a>   <a href="#security">Security Considerations</a></li><li><a href="#rfc.section.7">7.</a>   <a href="#rfc.references">References</a><ul><li><a href="#rfc.section.7.1">7.1.</a>   <a href="#rfc.references.1">Normative References</a></li><li><a href="#rfc.section.7.2">7.2.</a>   <a href="#rfc.references.2">Informative References</a></li></ul></li><li><a href="#rfc.section.A">Appendix A.</a>   <a href="#examples">Examples</a><ul><li><a href="#rfc.section.A.1">A.1.</a>   <a href="#example-keys">Example Keys</a><ul><li><a href="#rfc.section.A.1.1">A.1.1.</a>   <a href="#example-key-rsa-test">Example Key RSA test</a></li></ul></li><li><a href="#rfc.section.A.2">A.2.</a>   <a href="#example-keyid-values">Example keyId Values</a></li><li><a href="#rfc.section.A.3">A.3.</a>   <a href="#test-cases">Test Cases</a><ul><li><a href="#rfc.section.A.3.1">A.3.1.</a>   <a href="#signature-generation">Signature Generation</a></li><li><a href="#rfc.section.A.3.2">A.3.2.</a>   <a href="#signature-verification">Signature Verification</a></li></ul></li></ul></li><li><a href="#rfc.section.B">Appendix B.</a>   <a href="#wg-discuss">Topics for Working Group Discussion</a><ul><li><a href="#rfc.section.B.1">B.1.</a>   <a href="#issues">Issues</a><ul><li><a href="#rfc.section.B.1.1">B.1.1.</a>   <a href="#issue-alg-keyid">Confusing guidance on algorithm and key identification</a></li><li><a href="#rfc.section.B.1.2">B.1.2.</a>   <a href="#lack-of-definition-of-keyid-hurts-interoperability">Lack of definition of keyId hurts interoperability</a></li><li><a href="#rfc.section.B.1.3">B.1.3.</a>   <a href="#algorithm-registry-duplicates-work-of-jwa">Algorithm Registry duplicates work of JWA</a></li><li><a href="#rfc.section.B.1.4">B.1.4.</a>   <a href="#algorithm-registry-should-not-be-initialized-with-deprecated-entries">Algorithm Registry should not be initialized with deprecated entries</a></li><li><a href="#rfc.section.B.1.5">B.1.5.</a>   <a href="#no-percent-encoding-normalization-of-pathquery">No percent-encoding normalization of path/query</a></li><li><a href="#rfc.section.B.1.6">B.1.6.</a>   <a href="#misleading-name-for-headers-parameter">Misleading name for headers parameter</a></li><li><a href="#rfc.section.B.1.7">B.1.7.</a>   <a href="#changes-to-whitespace-in-header-field-values-break-verification">Changes to whitespace in header field values break verification</a></li><li><a href="#rfc.section.B.1.8">B.1.8.</a>   <a href="#multiple-set-cookie-headers-are-not-well-supported">Multiple Set-Cookie headers are not well supported</a></li><li><a href="#rfc.section.B.1.9">B.1.9.</a>   <a href="#covered-content-list-is-not-signed">Covered Content list is not signed</a></li><li><a href="#rfc.section.B.1.10">B.1.10.</a>   <a href="#algorithm-is-not-signed">Algorithm is not signed</a></li><li><a href="#rfc.section.B.1.11">B.1.11.</a>   <a href="#verification-key-identifier-is-not-signed">Verification key identifier is not signed</a></li><li><a href="#rfc.section.B.1.12">B.1.12.</a>   <a href="#max-values-precision-for-integer-string-and-decimal-string-not-defined">Max values, precision for Integer String and Decimal String not defined</a></li><li><a href="#rfc.section.B.1.13">B.1.13.</a>   <a href="#keyid-parameter-value-could-break-list-syntax">keyId parameter value could break list syntax</a></li><li><a href="#rfc.section.B.1.14">B.1.14.</a>   <a href="#creation-time-and-expiration-time-do-not-allow-for-clock-skew">Creation Time and Expiration Time do not allow for clock skew</a></li><li><a href="#rfc.section.B.1.15">B.1.15.</a>   <a href="#should-require-lowercased-header-field-names-as-identifiers">Should require lowercased header field names as identifiers</a></li><li><a href="#rfc.section.B.1.16">B.1.16.</a>   <a href="#reconcile-date-header-and-creation-time">Reconcile Date header and Creation Time</a></li><li><a href="#rfc.section.B.1.17">B.1.17.</a>   <a href="#remove-algorithm-specific-rules-for-content-identifiers">Remove algorithm-specific rules for content identifiers</a></li><li><a href="#rfc.section.B.1.18">B.1.18.</a>   <a href="#add-guidance-for-signing-compressed-headers">Add guidance for signing compressed headers</a></li><li><a href="#rfc.section.B.1.19">B.1.19.</a>   <a href="#transformations-to-via-header-field-value-break-verification">Transformations to Via header field value break verification</a></li><li><a href="#rfc.section.B.1.20">B.1.20.</a>   <a href="#case-changes-to-case-insensitive-header-field-values-break-verification">Case changes to case-insensitive header field values break verification</a></li><li><a href="#rfc.section.B.1.21">B.1.21.</a>   <a href="#need-more-examples-for-signature-header">Need more examples for Signature header</a></li><li><a href="#rfc.section.B.1.22">B.1.22.</a>   <a href="#expiration-not-needed">Expiration not needed</a></li></ul></li><li><a href="#rfc.section.B.2">B.2.</a>   <a href="#features">Features</a><ul><li><a href="#rfc.section.B.2.1">B.2.1.</a>   <a href="#define-more-content-identifiers">Define more content identifiers</a></li><li><a href="#rfc.section.B.2.2">B.2.2.</a>   <a href="#multiple-signature-support">Multiple signature support</a></li><li><a href="#rfc.section.B.2.3">B.2.3.</a>   <a href="#support-for-incremental-signing-of-header-field-value-list-items">Support for incremental signing of header field value list items</a></li><li><a href="#rfc.section.B.2.4">B.2.4.</a>   <a href="#support-expected-authority-changes">Support expected authority changes</a></li><li><a href="#rfc.section.B.2.5">B.2.5.</a>   <a href="#support-for-signing-specific-cookies">Support for signing specific cookies</a></li></ul></li></ul></li><li><a href="#acknowledgements">Acknowledgements</a></li><li><a href="#document-history">Document History</a></li><li><a href="#rfc.authors">Authors' Addresses</a></li></ul><ul class="toc"><li>Figures<ul><li><a href="#rfc.figure.1">Figure 1: Non-normative example Signature Input</a></li><li><a href="#rfc.figure.2">Figure 2: Non-normative example signature value</a></li></ul></li></ul></nav><section id="intro"><h2 id="rfc.section.1" class="np"><a href="#rfc.section.1">1.</a> <a href="#intro">Introduction</a></h2><div id="rfc.section.1.p.1"><p>Message integrity and authenticity are important security properties that are critical to the secure operation of many <a href="#HTTP"><cite title="Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing">[HTTP]</cite></a> applications. Application developers typically rely on the transport layer to provide these properties, by operating their application over <a href="#TLS"><cite title="The Transport Layer Security (TLS) Protocol Version 1.3">[TLS]</cite></a>. However, TLS only guarantees these properties over a single TLS connection, and the path between client and application may be composed of multiple independent TLS connections (for example, if the application is hosted behind a TLS-terminating gateway or if the client is behind a TLS Inspection appliance). In such cases, TLS cannot guarantee end-to-end message integrity or authenticity between the client and application. Additionally, some operating environments present obstacles that make it impractical to use TLS, or to use features necessary to provide message authenticity. Furthermore, some applications require the binding of an application-level key to the HTTP message, separate from any TLS certificates in use. Consequently, while TLS can meet message integrity and authenticity needs for many HTTP-based applications, it is not a universal solution.</p></div><div id="rfc.section.1.p.2"><p>This document defines a mechanism for providing end-to-end integrity and authenticity for content within an HTTP message. The mechanism allows applications to create digital signatures or message authentication codes (MACs) over only that content within the message that is meaningful and appropriate for the application. Strict canonicalization rules ensure that the verifier can verify the signature even if the message has been transformed in any of the many ways permitted by HTTP.</p></div><div id="rfc.section.1.p.3" class="avoidbreakafter"><p>The mechanism described in this document consists of three parts:</p></div><div id="rfc.section.1.p.4"><ul><li>A common nomenclature and canonicalization rule set for the different protocol elements and other content within HTTP messages.</li><li>Algorithms for generating and verifying signatures over HTTP message content using this nomenclature and rule set.</li><li>A mechanism for attaching a signature and related metadata to an HTTP message.</li></ul></div><section id="requirements-discussion"><h3 id="rfc.section.1.1"><a href="#rfc.section.1.1">1.1.</a> <a href="#requirements-discussion">Requirements Discussion</a></h3><div id="rfc.section.1.1.p.1"><p>HTTP permits and sometimes requires intermediaries to transform messages in a variety of ways. This may result in a recipient receiving a message that is not bitwise equivalent to the message that was oringally sent. In such a case, the recipient will be unable to verify a signature over the raw bytes of the sender’s HTTP message, as verifying digital signatures or MACs requires both signer and verifier to have the exact same signed content. Since the raw bytes of the message cannot be relied upon as signed content, the signer and verifier must derive the signed content from their respective versions of the message, via a mechanism that is resilient to safe changes that do not alter the meaning of the message.</p></div><div id="rfc.section.1.1.p.2"><p>For a variety of reasons, it is impractical to strictly define what constitutes a safe change versus an unsafe one. Applications use HTTP in a wide variety of ways, and may disagree on whether a particular piece of information in a message (e.g., the body, or the <span class="tt">Date</span> header field) is relevant. Thus a general purpose solution must provide signers with some degree of control over which message content is signed.</p></div><div id="rfc.section.1.1.p.3"><p>HTTP applications may be running in environments that do not provide complete access to or control over HTTP messages (such as a web browser’s JavaScript environment), or may be using libraries that abstract away the details of the protocol (such as <a href="https://openjdk.java.net/groups/net/httpclient/intro.html">the Java HTTPClient library</a>). These applications need to be able to generate and verify signatures despite incomplete knowledge of the HTTP message.</p></div></section><section id="about_sigs"><h3 id="rfc.section.1.2"><a href="#rfc.section.1.2">1.2.</a> <a href="#about_sigs">HTTP Message Transformations</a></h3><div id="rfc.section.1.2.p.1" class="avoidbreakafter"><p>As mentioned earlier, HTTP explicitly permits and in some cases requires implementations to transform messages in a variety of ways. Implementations are required to tolerate many of these transformations. What follows is a non-normative and non-exhaustive list of transformations that may occur under HTTP, provided as context:</p></div><div id="rfc.section.1.2.p.2"><ul><li>Re-ordering of header fields with different header field names (<a href="#HTTP"><cite title="Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing">[HTTP]</cite></a>, Section 3.2.2).</li><li>Combination of header fields with the same field name (<a href="#HTTP"><cite title="Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing">[HTTP]</cite></a>, Section 3.2.2).</li><li>Removal of header fields listed in the <span class="tt">Connection</span> header field (<a href="#HTTP"><cite title="Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing">[HTTP]</cite></a>, Section 6.1).</li><li>Addition of header fields that indicate control options (<a href="#HTTP"><cite title="Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing">[HTTP]</cite></a>, Section 6.1).</li><li>Addition or removal of a transfer coding (<a href="#HTTP"><cite title="Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing">[HTTP]</cite></a>, Section 5.7.2).</li><li>Addition of header fields such as <span class="tt">Via</span> (<a href="#HTTP"><cite title="Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing">[HTTP]</cite></a>, Section 5.7.1) and <span class="tt">Forwarded</span> (<a href="#RFC7239"><cite title="Forwarded HTTP Extension">[RFC7239]</cite></a>, Section 4).</li></ul></div></section><section id="safe-transformations"><h3 id="rfc.section.1.3"><a href="#rfc.section.1.3">1.3.</a> <a href="#safe-transformations">Safe Transformations</a></h3><div id="rfc.section.1.3.p.1" class="avoidbreakafter"><p>Based on the definition of HTTP and the requirements described above, we can identify certain types of transformations that should not prevent signature verification, even when performed on content covered by the signature. The following list describes those transformations:</p></div><div id="rfc.section.1.3.p.2"><ul><li>Combination of header fields with the same field name.</li><li>Reordering of header fields with different names.</li><li>Conversion between HTTP/1.x and HTTP/2, or vice-versa.</li><li>Changes in casing (e.g., “Origin” to “origin”) of any case-insensitive content such as header field names, request URI scheme, or host.</li><li>Addition or removal of leading or trailing whitespace to a header field value.</li><li>Addition or removal of <span class="tt">obs-folds</span>.</li><li>Changes to the <span class="tt">request-target</span> and <span class="tt">Host</span> header field that when applied together do not result in a change to the message’s effective request URI, as defined in Section 5.5 of <a href="#HTTP"><cite title="Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing">[HTTP]</cite></a>.</li></ul></div><div id="rfc.section.1.3.p.3"><p>Additionally, all changes to content not covered by the signature are considered safe.</p></div></section><section id="definitions"><h3 id="rfc.section.1.4"><a href="#rfc.section.1.4">1.4.</a> <a href="#definitions">Conventions and Terminology</a></h3><div id="rfc.section.1.4.p.1"><p>The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “NOT RECOMMENDED”, “MAY”, and “OPTIONAL” in this document are to be interpreted as described in BCP 14 <a href="#RFC2119"><cite title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</cite></a> <a href="#RFC8174"><cite title="Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words">[RFC8174]</cite></a> when, and only when, they appear in all capitals, as shown here.</p></div><div id="rfc.section.1.4.p.2"><p>The terms “HTTP message”, “HTTP method”, “HTTP request”, “HTTP response”, <span class="tt">absolute-form</span>, <span class="tt">absolute-path</span>, “effective request URI”, “gateway”, “header field”, “intermediary”, <span class="tt">request-target</span>, “sender”, and “recipient” are used as defined in <a href="#RFC7230"><cite title="Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing">[RFC7230]</cite></a>.</p></div><div id="rfc.section.1.4.p.3"><p>For brevity, the term “signature” on its own is used in this document to refer to both digital signatures and keyed MACs. Similarly, the verb “sign” refers to the generation of either a digital signature or keyed MAC over a given input string. The qualified term “digital signature” refers specifically to the output of an asymmetric cryptographic signing operation.</p></div><div id="rfc.section.1.4.p.4" class="avoidbreakafter"><p>In addition to those listed above, this document uses the following terms:</p></div><div id="rfc.section.1.4.p.5"><dl class="compact"><dt>Decimal String</dt><dd> </dd><dd>An Integer String optionally concatenated with a period “.” followed by a second Integer String, representing a positive real number expressed in base 10. The first Integer String represents the integral portion of the number, while the optional second Integer String represents the fractional portion of the number. (( Editor’s note: There’s got to be a definition for this that we can reference. ))</dd><dt>Integer String</dt><dd> </dd><dd>A US-ASCII string of one or more digits “0-9”, representing a positive integer in base 10. (( Editor’s note: There’s got to be a definition for this that we can reference. ))</dd><dt>Signer</dt><dd> </dd><dd>The entity that is generating or has generated an HTTP Message Signature.</dd><dt>Verifier</dt><dd> </dd><dd>An entity that is verifying or has verified an HTTP Message Signature against an HTTP Message. Note that an HTTP Message Signature may be verified multiple times, potentially by different entities.</dd></dl></div><div id="rfc.section.1.4.p.6"><p>This document contains non-normative examples of partial and complete HTTP messages. To improve readability, header fields may be split into multiple lines, using the <span class="tt">obs-fold</span> syntax. This syntax is deprecated in <a href="#RFC7230"><cite title="Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing">[RFC7230]</cite></a>, and senders MUST NOT generate messages that include it.</p></div></section></section><section id="content-identifiers"><h2 id="rfc.section.2"><a href="#rfc.section.2">2.</a> <a href="#content-identifiers">Identifying and Canonicalizing Content</a></h2><div id="rfc.section.2.p.1"><p>In order to allow signers and verifiers to establish which content is covered by a signature, this document defines content identifiers for signature metadata and discrete pieces of message content that may be covered by an HTTP Message Signature.</p></div><div id="rfc.section.2.p.2"><p>Some content within HTTP messages may undergo transformations that change the bitwise value without altering meaning of the content (for example, the merging together of header fields with the same name). Message content must therefore be canonicalized before it is signed, to ensure that a signature can be verified despite such innocuous transformations. This document defines rules for each content identifier that transform the identifier’s associated content into such a canonical form.</p></div><div id="rfc.section.2.p.3"><p>The following sections define content identifiers, their associated content, and their canonicalization rules.</p></div><section id="http-header-fields"><h3 id="rfc.section.2.1"><a href="#rfc.section.2.1">2.1.</a> <a href="#http-header-fields">HTTP Header Fields</a></h3><div id="rfc.section.2.1.p.1"><p>An HTTP header field is identified by its header field name. While HTTP header field names are case-insensitive, implementations MUST use lowercased field names (e.g., <span class="tt">content-type</span>, <span class="tt">date</span>, <span class="tt">etag</span>) when using them as content identifiers.</p></div><div id="rfc.section.2.1.p.2" class="avoidbreakafter"><p>An HTTP header field value is canonicalized as follows:</p></div><div id="rfc.section.2.1.p.3"><ol><li>Create an ordered list of the field values of each instance of the header field in the message, in the order that they occur (or will occur) in the message.</li><li>Strip leading and trailing whitespace from each item in the list.</li><li>Concatenate the list items together, with a comma “,” and space “ “ between each item. The resulting string is the canonicalized value.</li></ol></div><section id="canonicalization-examples"><h4 id="rfc.section.2.1.1"><a href="#rfc.section.2.1.1">2.1.1.</a> <a href="#canonicalization-examples">Canonicalization Examples</a></h4><div id="rfc.section.2.1.1.p.1" class="avoidbreakafter"><p>This section contains non-normative examples of canonicalized values for header fields, given the following example HTTP message:</p></div><div id="rfc.figure.u.1"><div><pre>
HTTP/1.1 200 OK
Server: www.example.com
Date: Tue, 07 Jun 2014 20:51:35 GMT
X-OWS-Header:   Leading and trailing whitespace.   
X-Obs-Fold-Header: Obsolete  
    line folding.
X-Empty-Header: 
Cache-Control: max-age=60
Cache-Control:    must-revalidate
</pre></div></div><div id="rfc.section.2.1.1.p.2" class="avoidbreakafter"><p>The following table shows example canonicalized values for header fields, given that message:</p></div><div id="rfc.table.u.1" class="tt"><table class="tt full tcenter"><caption>Non-normative examples of header field canonicalization.</caption><thead><tr><th class="left">Header Field</th><th class="left">Canonicalized Value</th></tr></thead><tbody><tr><td class="left"><span class="tt">(cache-control)</span></td><td class="left">max-age=60, must-revalidate</td></tr><tr><td class="left"><span class="tt">(date)</span></td><td class="left">Tue, 07 Jun 2014 20:51:35 GMT</td></tr><tr><td class="left"><span class="tt">(server)</span></td><td class="left">www.example.com</td></tr><tr><td class="left"><span class="tt">(x-empty-header)</span></td><td class="left"> </td></tr><tr><td class="left"><span class="tt">(x-obs-fold-header)</span></td><td class="left">Obsolete line folding.</td></tr><tr><td class="left"><span class="tt">(x-ows-header)</span></td><td class="left">Leading and trailing whitespace.</td></tr></tbody></table></div></section></section><section id="signature-creation-time"><h3 id="rfc.section.2.2"><a href="#rfc.section.2.2">2.2.</a> <a href="#signature-creation-time">Signature Creation Time</a></h3><div id="rfc.section.2.2.p.1"><p>The signature’s Creation Time (<a href="#signature-metadata" title="Signature Metadata">Section 3.1</a>) is identified by the <span class="tt">(created)</span> identifier.</p></div><div id="rfc.section.2.2.p.2"><p>Its canonicalized value is an Integer String containing the signature’s Creation Time expressed as the number of seconds since the Epoch, as defined in <a href="https://pubs.opengroup.org/onlinepubs/9699919799/basedefs/V1_chap04.html#tag_04_16">Section 4.16</a> of <a href="#POSIX.1"><cite title="The Open Group Base Specifications Issue 7, 2018 edition">[POSIX.1]</cite></a>.</p></div><div id="rfc.section.2.2.p.3"><ul class="empty"><li>The use of seconds since the Epoch to canonicalize a timestamp simplifies processing and avoids timezone management required by specifications such as <a href="#RFC3339"><cite title="Date and Time on the Internet: Timestamps">[RFC3339]</cite></a>.</li></ul></div></section><section id="signature-expiration-time"><h3 id="rfc.section.2.3"><a href="#rfc.section.2.3">2.3.</a> <a href="#signature-expiration-time">Signature Expiration Time</a></h3><div id="rfc.section.2.3.p.1"><p>The signature’s Expiration Time (<a href="#signature-metadata" title="Signature Metadata">Section 3.1</a>) is identified by the <span class="tt">(expired)</span> identifier.</p></div><div id="rfc.section.2.3.p.2"><p>Its canonicalized value is a Decimal String containing the signature’s Expiration Time expressed as the number of seconds since the Epoch, as defined in <a href="https://pubs.opengroup.org/onlinepubs/9699919799/basedefs/V1_chap04.html#tag_04_16">Section 4.16</a> of <a href="#POSIX.1"><cite title="The Open Group Base Specifications Issue 7, 2018 edition">[POSIX.1]</cite></a>.</p></div></section><section id="target-endpoint"><h3 id="rfc.section.2.4"><a href="#rfc.section.2.4">2.4.</a> <a href="#target-endpoint">Target Endpoint</a></h3><div id="rfc.section.2.4.p.1"><p>The request target endpoint, consisting of the request method and the path and query of the effective request URI, is identified by the <span class="tt">(request-target)</span> identifier.</p></div><div id="rfc.section.2.4.p.2" class="avoidbreakafter"><p>Its value is canonicalized as follows:</p></div><div id="rfc.section.2.4.p.3"><ol><li>Take the lowercased HTTP method of the message.</li><li>Append a space “ “.</li><li>Append the path and query of the request target of the message, formatted according to the rules defined for the :path pseudo-header in <a href="#HTTP2"><cite title="Hypertext Transfer Protocol Version 2 (HTTP/2)">[HTTP2]</cite></a>, Section 8.1.2.3. The resulting string is the canonicalized value.</li></ol></div><section id="canonicalization-examples-1"><h4 id="rfc.section.2.4.1"><a href="#rfc.section.2.4.1">2.4.1.</a> <a href="#canonicalization-examples-1">Canonicalization Examples</a></h4><div id="rfc.section.2.4.1.p.1"><p>The following table contains non-normative example HTTP messages and their canonicalized <span class="tt">(request-target)</span> values.</p></div><div class="tt"><table class="v3 tcenter"><caption>Table 1: Non-normative examples of <span class="tt">(request-target)</span> canonicalization.</caption><thead><tr><th class="left">HTTP Message</th><th class="left">(request-target)</th></tr></thead><tbody><tr><td class="left"><div id="rfc.section.2.4.1.p.1"><pre class="text">
POST /?param=value HTTP/1.1
Host: www.example.com</pre></div> </td><td class="left"><span class="tt">post /?param=value</span> </td></tr><tr><td class="left"><div id="rfc.section.2.4.1.p.1"><pre class="text">
POST /a/b HTTP/1.1
Host: www.example.com</pre></div> </td><td class="left"><span class="tt">post /a/b</span> </td></tr><tr><td class="left"><div id="rfc.section.2.4.1.p.1"><pre class="text">
GET http://www.example.com/a/ HTTP/1.1</pre></div> </td><td class="left"><span class="tt">get /a/</span> </td></tr><tr><td class="left"><div id="rfc.section.2.4.1.p.1"><pre class="text">
GET http://www.example.com HTTP/1.1</pre></div> </td><td class="left"><span class="tt">get /</span> </td></tr><tr><td class="left"><div id="rfc.section.2.4.1.p.1"><pre class="text">
CONNECT server.example.com:80 HTTP/1.1
Host: server.example.com</pre></div> </td><td class="left"><span class="tt">connect /</span> </td></tr><tr><td class="left"><div id="rfc.section.2.4.1.p.1"><pre class="text">
OPTIONS * HTTP/1.1
Host: server.example.com</pre></div> </td><td class="left"><span class="tt">options *</span> </td></tr></tbody></table></div></section></section></section><section id="message-signatures"><h2 id="rfc.section.3"><a href="#rfc.section.3">3.</a> <a href="#message-signatures">HTTP Message Signatures</a></h2><div id="rfc.section.3.p.1"><p>An HTTP Message Signature is a signature over a string generated from a subset of the content in an HTTP message and metadata about the signature itself. When successfully verified against an HTTP message, it provides cryptographic proof that with respect to the subset of content that was signed, the message is semantically equivalent to the message for which the signature was generated.</p></div><section id="signature-metadata"><h3 id="rfc.section.3.1"><a href="#rfc.section.3.1">3.1.</a> <a href="#signature-metadata">Signature Metadata</a></h3><div id="rfc.section.3.1.p.1" class="avoidbreakafter"><p>HTTP Message Signatures have metadata properties that provide information regarding the signature’s generation and/or verification. The following metadata properties are defined:</p></div><div id="rfc.section.3.1.p.2"><dl class="compact"><dt>Algorithm</dt><dd> </dd><dd>An HTTP Signature Algorithm defined in the HTTP Signature Algorithms Registry defined in this document. It describes the signing and verification algorithms for the signature.</dd><dt>Creation Time</dt><dd> </dd><dd>A timestamp representing the point in time that the signature was generated. Sub-second precision is not supported. A signature’s Creation Time MAY be undefined, indicating that it is unknown.</dd><dt>Covered Content</dt><dd> </dd><dd>An ordered list of content identifiers (Section 2) that indicates the metadata and message content that is covered by the signature. The order of identifiers in this list affects signature generation and verification, and therefore MUST be preserved.</dd><dt>Expiration Time</dt><dd> </dd><dd>A timestamp representing the point in time at which the signature expires. An expired signature always fails verification. A signature’s Expiration Time MAY be undefined, indicating that the signature does not expire.</dd><dt>Verification Key Material</dt><dd> </dd><dd>The key material required to verify the signature.</dd></dl></div></section><section id="create"><h3 id="rfc.section.3.2"><a href="#rfc.section.3.2">3.2.</a> <a href="#create">Creating a Signature</a></h3><div id="rfc.section.3.2.p.1" class="avoidbreakafter"><p>In order to create a signature, a signer completes the following process:</p></div><div id="rfc.section.3.2.p.2"><ol><li>Choose key material and algorithm, and set metadata properties <a href="#choose-metadata" title="Choose and Set Signature Metadata Properties">Section 3.2.1</a></li><li>Create the Signature Input <a href="#canonicalization" title="Create the Signature Input">Section 3.2.2</a></li><li>Sign the Signature Input <a href="#sign-sig-input" title="Sign the Signature Input">Section 3.2.3</a></li></ol></div><div id="rfc.section.3.2.p.3"><p>The following sections describe each of these steps in detail.</p></div><section id="choose-metadata"><h4 id="rfc.section.3.2.1"><a href="#rfc.section.3.2.1">3.2.1.</a> <a href="#choose-metadata">Choose and Set Signature Metadata Properties</a></h4><div id="rfc.section.3.2.1.p.1"><ol><li>The signer chooses an HTTP Signature Algorithm from those registered in the HTTP Signature Algorithms Registry defined by this document, and sets the signature’s Algorithm property to that value. The signer MUST NOT choose an algorithm marked “Deprecated”. The mechanism by which the signer chooses an algorithm is out of scope for this document.</li><li>The signer chooses key material to use for signing and verification, and sets the signature’s Verification Key Material property to the key material required for verification. The signer MUST choose key material that is appropriate for the signature’s Algorithm, and that conforms to any requirements defined by the Algorithm, such as key size or format. The mechanism by which the signer chooses key material is out of scope for this document.</li><li>The signer sets the signature’s Creation Time property to the current time.</li><li>The signer sets the signature’s Expiration Time property to the time at which the signature is to expire, or to undefined if the signature will not expire.</li><li>The signer creates an ordered list of content identifiers representing the message content and signature metadata to be covered by the signature, and assigns this list as the signature’s Covered Content. <ul><li>Each identifier MUST be one of those defined in Section 2.</li><li>This list MUST NOT be empty, as this would result in creating a signature over the empty string.</li><li>If the signature’s Algorithm name does not start with rsa, hmac, or ecdsa, signers SHOULD include (created) and (request-target) in the list.</li><li>If the signature’s Algorithm starts with rsa, hmac, or ecdsa, signers SHOULD include date and (request-target) in the list.</li><li>Further guidance on what to include in this list and in what order is out of scope for this document. However, the list order is significant and once established for a given signature it MUST be preserved for that signature.</li></ul></li></ol></div><div id="rfc.section.3.2.1.p.2" class="avoidbreakafter"><p>For example, given the following HTTP message:</p></div><div id="rfc.figure.u.2"><div><pre>
GET /foo HTTP/1.1
Host: example.org
Date: Sat, 07 Jun 2014 20:51:35 GMT
X-Example: Example header
        with some whitespace.
X-EmptyHeader:
Cache-Control: max-age=60
Cache-Control: must-revalidate
</pre></div></div><div id="rfc.section.3.2.1.p.3" class="avoidbreakafter"><p>The following table presents a non-normative example of metadata values that a signer may choose:</p></div><div id="rfc.table.2" class="tt"><div id="example-metadata"></div><table class="tt full tcenter"><caption>Table 2: Non-normative example metadata values</caption><thead><tr><th class="left">Property</th><th class="left">Value</th></tr></thead><tbody><tr><td class="left">Algorithm</td><td class="left"><span class="tt">rsa-256</span></td></tr><tr><td class="left">Covered Content</td><td class="left"><span class="tt">(request-target)</span>, <span class="tt">(created)</span>, <span class="tt">host</span>, <span class="tt">date</span>, <span class="tt">cache-contol</span>, <span class="tt">x-emptyheader</span>, <span class="tt">x-example</span></td></tr><tr><td class="left">Creation Time</td><td class="left"><span class="tt">1402174295</span></td></tr><tr><td class="left">Expiration Time</td><td class="left"><span class="tt">1402174595</span></td></tr><tr><td class="left">Verification Key Material</td><td class="left">The public key provided in and identified by the <span class="tt">keyId</span> value “test-key-b”.</td></tr></tbody></table></div></section><section id="canonicalization"><h4 id="rfc.section.3.2.2"><a href="#rfc.section.3.2.2">3.2.2.</a> <a href="#canonicalization">Create the Signature Input</a></h4><div id="rfc.section.3.2.2.p.1"><p>The Signature Input is a US-ASCII string containing the content that will be signed. To create it, the signer concatenates together entries for each identifier in the signature’s Covered Content in the order it occurs in the list, with each entry separated by a newline <span class="tt">"\n"</span>. An identifier’s entry is a US-ASCII string consisting of the lowercased identifier followed with a colon <span class="tt">":"</span>, a space <span class="tt">" "</span>, and the identifier’s canonicalized value (described below).</p></div><div id="rfc.section.3.2.2.p.2"><p>If Covered Content contains <span class="tt">(created)</span> and the signature’s Creation Time is undefined or the signature’s Algorithm name starts with <span class="tt">rsa</span>, <span class="tt">hmac</span>, or <span class="tt">ecdsa</span> an implementation MUST produce an error.</p></div><div id="rfc.section.3.2.2.p.3"><p>If Covered Content contains <span class="tt">(expires)</span> and the signature does not have an Expiration Time or the signature’s Algorithm name starts with <span class="tt">rsa</span>, <span class="tt">hmac</span>, or <span class="tt">ecdsa</span> an implementation MUST produce an error.</p></div><div id="rfc.section.3.2.2.p.4"><p>If Covered Content contains an identifier for a header field that is not present or malformed in the message, the implementation MUST produce an error.</p></div><div id="rfc.section.3.2.2.p.5" class="avoidbreakafter"><p>For the non-normative example Signature metadata in <a href="#example-metadata" title="Non-normative example metadata values">Table 2</a>, the corresponding Signature Input is:</p></div><div id="example-sig-input"></div><div id="rfc.figure.1"><div><pre>
(request-target): get /foo
(created): 1402170695
host: example.org
date: Tue, 07 Jun 2014 20:51:35 GMT
cache-control: max-age=60, must-revalidate
x-emptyheader:
x-example: Example header with some whitespace.
</pre></div></div><p class="figure">Figure 1: Non-normative example Signature Input</p></section><section id="sign-sig-input"><h4 id="rfc.section.3.2.3"><a href="#rfc.section.3.2.3">3.2.3.</a> <a href="#sign-sig-input">Sign the Signature Input</a></h4><div id="rfc.section.3.2.3.p.1"><p>The signer signs the Signature Input using the signing algorithm described by the signature’s Algorithm property, and the key material chosen by the signer. The signer then encodes the result of that operation as a base 64-encoded string <a href="#RFC4648"><cite title="The Base16, Base32, and Base64 Data Encodings">[RFC4648]</cite></a>. This string is the signature value.</p></div><div id="rfc.section.3.2.3.p.2" class="avoidbreakafter"><p>For the non-normative example Signature metadata in <a href="#choose-metadata" title="Choose and Set Signature Metadata Properties">Section 3.2.1</a> and Signature Input in <a href="#example-sig-input" title="Non-normative example Signature Input">Figure 1</a>, the corresponding signature value is:</p></div><div id="example-sig-value"></div><div id="rfc.figure.2"><div><pre>
T1l3tWH2cSP31nfuvc3nVaHQ6IAu9YLEXg2pCeEOJETXnlWbgKtBTaXV6LNQWtf4O42V2
DZwDZbmVZ8xW3TFW80RrfrY0+fyjD4OLN7/zV6L6d2v7uBpuWZ8QzKuHYFaRNVXgFBXN3
VJnsIOUjv20pqZMKO3phLCKX2/zQzJLCBQvF/5UKtnJiMp1ACNhG8LF0Q0FPWfe86YZBB
xqrQr5WfjMu0LOO52ZAxi9KTWSlceJ2U361gDb7S5Deub8MaDrjUEpluphQeo8xyvHBoN
Xsqeax/WaHyRYOgaW6krxEGVaBQAfA2czYZhEA05Tb38ahq/gwDQ1bagd9rGnCHtAg==
</pre></div></div><p class="figure">Figure 2: Non-normative example signature value</p></section></section><section id="verify"><h3 id="rfc.section.3.3"><a href="#rfc.section.3.3">3.3.</a> <a href="#verify">Verifying a Signature</a></h3><div id="rfc.section.3.3.p.1" class="avoidbreakafter"><p>In order to verify a signature, a verifier MUST:</p></div><div id="rfc.section.3.3.p.2"><ol><li>Examine the signature’s metadata to confirm that the signature meets the requirements described in this document, as well as any additional requirements defined by the application such as which header fields or other content are required to be covered by the signature.</li><li>Use the received HTTP message and the signature’s metadata to recreate the Signature Input, using the process described in <a href="#canonicalization" title="Create the Signature Input">Section 3.2.2</a>.</li><li>Use the signature’s Algorithm and Verification Key Material with the recreated Signing Input to verify the signature value.</li></ol></div><div id="rfc.section.3.3.p.3"><p>A signature with a Creation Time that is in the future or an Expiration Time that is in the past MUST NOT be processed.</p></div><div id="rfc.section.3.3.p.4"><p>The verifier MUST ensure that a signature’s Algorithm is appropriate for the key material the verifier will use to verify the signature. If the Algorithm is not appropriate for the key material (for example, if it is the wrong size, or in the wrong format), the signature MUST NOT be processed.</p></div><section id="enforcing-application-requirements"><h4 id="rfc.section.3.3.1"><a href="#rfc.section.3.3.1">3.3.1.</a> <a href="#enforcing-application-requirements">Enforcing Application Requirements</a></h4><div id="rfc.section.3.3.1.p.1"><p>The verification requirements specified in this document are intended as a baseline set of restrictions that are generally applicable to all use cases. Applications using HTTP Message Signatures MAY impose requirements above and beyond those specified by this document, as appropriate for their use case.</p></div><div id="rfc.section.3.3.1.p.2" class="avoidbreakafter"><p>Some non-normative examples of additional requirements an application might define are:</p></div><div id="rfc.section.3.3.1.p.3"><ul><li>Requiring a specific set of header fields to be signed (e.g., Authorization, Digest).</li><li>Enforcing a maximum signature age.</li><li>Prohibiting the use of certain algorithms, or mandating the use of an algorithm.</li><li>Requiring keys to be of a certain size (e.g., 2048 bits vs. 1024 bits).</li></ul></div><div id="rfc.section.3.3.1.p.4"><p>Application-specific requirements are expected and encouraged. When an application defines additional requirements, it MUST enforce them during the signature verification process, and signature verification MUST fail if the signature does not conform to the application’s requirements.</p></div><div id="rfc.section.3.3.1.p.5"><p>Applications MUST enforce the requirements defined in this document. Regardless of use case, applications MUST NOT accept signatures that do not conform to these requirements.</p></div></section></section></section><section id="sig"><h2 id="rfc.section.4"><a href="#rfc.section.4">4.</a> <a href="#sig">The ‘Signature’ HTTP Header</a></h2><div id="rfc.section.4.p.1"><p>The “Signature” HTTP header provides a mechanism to attach a signature to the HTTP message from which it was generated. The header field name is “Signature” and its value is a list of parameters and values, formatted according to the <span class="tt">signature</span> syntax defined below, using the Augmented Backus-Naur Form (ABNF) notation defined in <a href="#RFC5234"><cite title="Augmented BNF for Syntax Specifications: ABNF">[RFC5234]</cite></a> notation, with extensions defined in <a href="#HTTP"><cite title="Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing">[HTTP]</cite></a>.</p></div><div id="rfc.figure.u.3"><div><pre class="inline">
signature    = #( sig-param )
sig-param    = token BWS "=" BWS ( token / quoted-string )
</pre></div></div><div id="rfc.section.4.p.2"><p>Each <span class="tt">sig-param</span> is the name of a parameter defined in the <a href="#param-registry" title="HTTP Signature Parameters Registry">Section 5.2</a> defined in this document. The initial contents of this registry are described in <a href="#params" title="Signature Header Parameters">Section 4.1</a>.</p></div><section id="params"><h3 id="rfc.section.4.1"><a href="#rfc.section.4.1">4.1.</a> <a href="#params">Signature Header Parameters</a></h3><div id="rfc.section.4.1.p.1"><dl class="compact"><dt>algorithm</dt><dd> </dd><dd>RECOMMENDED. The algorithm parameter contains the name of the signature’s Algorithm, as registered in the HTTP Signature Algorithms Registry defined by this document. Verifiers MUST determine the signature’s Algorithm from the <span class="tt">keyId</span> parameter rather than from <span class="tt">algorithm</span>. If <span class="tt">algorithm</span> is provided and differs from or is incompatible with the algorithm or key material identified by <span class="tt">keyId</span> (for example, <span class="tt">algorithm</span> has a value of <span class="tt">rsa-sha256</span> but <span class="tt">keyId</span> identifies an EdDSA key), then implementations MUST produce an error. Implementers should note that previous versions of this specification determined the signature’s Algorithm using the algorithm parameter only, and thus could be utilized by attackers to expose security vulnerabilities. The default value for this parameter is “hs2019”.</dd><dt>created</dt><dd> </dd><dd>RECOMMENDED. The created parameter contains the signature’s Creation Time, expressed as the canonicalized value of the <span class="tt">(created)</span> content identifier, as defined in Section 2. If not specified, the signature’s Creation Time is undefined. This parameter is useful when signers are not capable of controlling the Date HTTP Header such as when operating in certain web browser environments.</dd><dt>expires</dt><dd> </dd><dd>OPTIONAL. The expires parameter contains the signature’s Expiration Time, expressed as the canonicalized value of the <span class="tt">(expires)</span> content identifier, as defined in Section 2. If the signature does not have an Expiration Time, this parameter MUST be omitted. If not specified, the signature’s Expiration Time is undefined.</dd><dt>headers</dt><dd> </dd><dd>OPTIONAL. The headers parameter contains the signature’s Covered Content, expressed as a string containing a quoted list of the identifiers in the list, in the order they occur in the list, with a space “ “ between each identifier. If specified, identifiers for header fields SHOULD be lowercased and all others MUST be lowercased. The default value for this parameter is “(created)”.</dd><dt>keyId</dt><dd> </dd><dd>REQUIRED. The <span class="tt">keyId</span> parameter is a US-ASCII string whose value can be used by a verifier to identify and/or obtain the signature’s Verification Key Material. The format and semantics of this value are out of scope for this document.</dd><dt>signature</dt><dd> </dd><dd>REQUIRED. The signature parameter contains the signature value, as described in <a href="#sign-sig-input" title="Sign the Signature Input">Section 3.2.3</a>.</dd></dl></div></section><section id="example"><h3 id="rfc.section.4.2"><a href="#rfc.section.4.2">4.2.</a> <a href="#example">Example</a></h3><div id="rfc.section.4.2.p.1" class="avoidbreakafter"><p>The following is a non-normative example Signature header field representing the signature in <a href="#example-sig-value" title="Non-normative example signature value">Figure 2</a>:</p></div><div id="rfc.figure.u.4"><div><pre>
Signature: keyId="test-key-b", algorithm="rsa-sha256",
    created=1402170695, expires=1402170995,
    headers="(request-target) (created) host date cache-control
        x-emptyheader x-example",
    signature="T1l3tWH2cSP31nfuvc3nVaHQ6IAu9YLEXg2pCeEOJETXnlWbgKtBTa
        XV6LNQWtf4O42V2DZwDZbmVZ8xW3TFW80RrfrY0+fyjD4OLN7/zV6L6d2v7uB
        puWZ8QzKuHYFaRNVXgFBXN3VJnsIOUjv20pqZMKO3phLCKX2/zQzJLCBQvF/5
        UKtnJiMp1ACNhG8LF0Q0FPWfe86YZBBxqrQr5WfjMu0LOO52ZAxi9KTWSlceJ
        2U361gDb7S5Deub8MaDrjUEpluphQeo8xyvHBoNXsqeax/WaHyRYOgaW6krxE
        GVaBQAfA2czYZhEA05Tb38ahq/gwDQ1bagd9rGnCHtAg=="
</pre></div></div></section></section><section id="iana"><h2 id="rfc.section.5"><a href="#rfc.section.5">5.</a> <a href="#iana">IANA Considerations</a></h2><section id="hsa-registry"><h3 id="rfc.section.5.1"><a href="#rfc.section.5.1">5.1.</a> <a href="#hsa-registry">HTTP Signature Algorithms Registry</a></h3><div id="rfc.section.5.1.p.1"><p>This document defines HTTP Signature Algorithms, for which IANA is asked to create and maintain a new registry titled “HTTP Signature Algorithms”. Initial values for this registry are given in <a href="#iana-hsa-contents" title="Initial Contents">Section 5.1.2</a>. Future assignments and modifications to existing assignment are to be made through the Expert Review registration policy <a href="#RFC8126"><cite title="Guidelines for Writing an IANA Considerations Section in RFCs">[RFC8126]</cite></a> and shall follow the template presented in <a href="#iana-hsa-template" title="Registration Template">Section 5.1.1</a>.</p></div><section id="iana-hsa-template"><h4 id="rfc.section.5.1.1"><a href="#rfc.section.5.1.1">5.1.1.</a> <a href="#iana-hsa-template">Registration Template</a></h4><div id="rfc.section.5.1.1.p.1"><dl class="compact"><dt>Algorithm Name</dt><dd> </dd><dd>An identifier for the HTTP Signature Algorithm. The name MUST be an ASCII string consisting only of lower-case characters (<span class="tt">"a"</span> - <span class="tt">"z"</span>), digits (<span class="tt">"0"</span> - <span class="tt">"9"</span>), and hyphens (<span class="tt">"-"</span>), and SHOULD NOT exceed 20 characters in length. The identifier MUST be unique within the context of the registry.</dd><dt>Status</dt><dd> </dd><dd>A brief text description of the status of the algorithm. The description MUST begin with one of “Active” or “Deprecated”, and MAY provide further context or explanation as to the reason for the status.</dd><dt>Description</dt><dd> </dd><dd>A description of the algorithm used to sign the signing string when generating an HTTP Message Signature, or instructions on how to determine that algorithm. When the description specifies an algorithm, it MUST include a reference to the document or documents that define the algorithm.</dd></dl></div></section><section id="iana-hsa-contents"><h4 id="rfc.section.5.1.2"><a href="#rfc.section.5.1.2">5.1.2.</a> <a href="#iana-hsa-contents">Initial Contents</a></h4><div id="rfc.section.5.1.2.p.1"><p>(( MS: The references in this section are problematic as many of the specifications that they refer to are too implementation specific, rather than just pointing to the proper signature and hashing specifications. A better approach might be just specifying the signature and hashing function specifications, leaving implementers to connect the dots (which are not that hard to connect). ))</p></div><section id="hs2019"><h5 id="rfc.section.5.1.2.1"><a href="#rfc.section.5.1.2.1">5.1.2.1.</a> <a href="#hs2019">hs2019</a></h5><div id="rfc.section.5.1.2.1.p.1"><dl class="compact"><dt>Algorithm Name</dt><dd> </dd><dd><span class="tt">hs2019</span></dd><dt>Status</dt><dd> </dd><dd>active</dd><dt>Description</dt><dd> </dd><dd>Derived from metadata associated with keyId. Recommend support for:</dd><dd><ul><li>RSASSA-PSS <a href="#RFC8017"><cite title="PKCS #1: RSA Cryptography Specifications Version 2.2">[RFC8017]</cite></a> using SHA-512 <a href="#RFC6234"><cite title="US Secure Hash Algorithms (SHA and SHA-based HMAC and HKDF)">[RFC6234]</cite></a></li></ul> </dd><dd><ul><li>HMAC <a href="#RFC2104"><cite title="HMAC: Keyed-Hashing for Message Authentication">[RFC2104]</cite></a> using SHA-512 <a href="#RFC6234"><cite title="US Secure Hash Algorithms (SHA and SHA-based HMAC and HKDF)">[RFC6234]</cite></a></li></ul> </dd><dd><ul><li>ECDSA using curve P-256 DSS <a href="#FIPS186-4"><cite title="Digital Signature Standard (DSS)">[FIPS186-4]</cite></a> and SHA-512 <a href="#RFC6234"><cite title="US Secure Hash Algorithms (SHA and SHA-based HMAC and HKDF)">[RFC6234]</cite></a></li></ul> </dd><dd><ul><li>Ed25519ph, Ed25519ctx, and Ed25519 <a href="#RFC8032"><cite title="Edwards-Curve Digital Signature Algorithm (EdDSA)">[RFC8032]</cite></a></li></ul> </dd></dl></div></section><section id="rsa-sha1"><h5 id="rfc.section.5.1.2.2"><a href="#rfc.section.5.1.2.2">5.1.2.2.</a> <a href="#rsa-sha1">rsa-sha1</a></h5><div id="rfc.section.5.1.2.2.p.1"><dl class="compact"><dt>Algorithm Name</dt><dd> </dd><dd><span class="tt">rsa-sha1</span></dd><dt>Status</dt><dd> </dd><dd>Deprecated; SHA-1 not secure.</dd><dt>Description</dt><dd> </dd><dd>RSASSA-PKCS1-v1_5 <a href="#RFC8017"><cite title="PKCS #1: RSA Cryptography Specifications Version 2.2">[RFC8017]</cite></a> using SHA-1 <a href="#RFC6234"><cite title="US Secure Hash Algorithms (SHA and SHA-based HMAC and HKDF)">[RFC6234]</cite></a></dd></dl></div></section><section id="rsa-sha256"><h5 id="rfc.section.5.1.2.3"><a href="#rfc.section.5.1.2.3">5.1.2.3.</a> <a href="#rsa-sha256">rsa-sha256</a></h5><div id="rfc.section.5.1.2.3.p.1"><dl class="compact"><dt>Algorithm Name</dt><dd> </dd><dd><span class="tt">rsa-sha256</span></dd><dt>Status</dt><dd> </dd><dd>Deprecated; specifying signature algorithm enables attack vector.</dd><dt>Description</dt><dd> </dd><dd>RSASSA-PKCS1-v1_5 <a href="#RFC8017"><cite title="PKCS #1: RSA Cryptography Specifications Version 2.2">[RFC8017]</cite></a> using SHA-256 <a href="#RFC6234"><cite title="US Secure Hash Algorithms (SHA and SHA-based HMAC and HKDF)">[RFC6234]</cite></a></dd></dl></div></section><section id="hmac-sha256"><h5 id="rfc.section.5.1.2.4"><a href="#rfc.section.5.1.2.4">5.1.2.4.</a> <a href="#hmac-sha256">hmac-sha256</a></h5><div id="rfc.section.5.1.2.4.p.1"><dl class="compact"><dt>Algorithm Name</dt><dd> </dd><dd><span class="tt">hmac-sha256</span></dd><dt>Status</dt><dd> </dd><dd>Deprecated; specifying signature algorithm enables attack vector.</dd><dt>Description</dt><dd> </dd><dd>HMAC <a href="#RFC2104"><cite title="HMAC: Keyed-Hashing for Message Authentication">[RFC2104]</cite></a> using SHA-256 <a href="#RFC6234"><cite title="US Secure Hash Algorithms (SHA and SHA-based HMAC and HKDF)">[RFC6234]</cite></a></dd></dl></div></section><section id="ecdsa-sha256"><h5 id="rfc.section.5.1.2.5"><a href="#rfc.section.5.1.2.5">5.1.2.5.</a> <a href="#ecdsa-sha256">ecdsa-sha256</a></h5><div id="rfc.section.5.1.2.5.p.1"><dl class="compact"><dt>Algorithm Name</dt><dd> </dd><dd><span class="tt">ecdsa-sha256</span></dd><dt>Status</dt><dd> </dd><dd>Deprecated; specifying signature algorithm enables attack vector.</dd><dt>Description</dt><dd> </dd><dd>ECDSA using curve P-256 DSS <a href="#FIPS186-4"><cite title="Digital Signature Standard (DSS)">[FIPS186-4]</cite></a> and SHA-256 <a href="#RFC6234"><cite title="US Secure Hash Algorithms (SHA and SHA-based HMAC and HKDF)">[RFC6234]</cite></a></dd></dl></div></section></section></section><section id="param-registry"><h3 id="rfc.section.5.2"><a href="#rfc.section.5.2">5.2.</a> <a href="#param-registry">HTTP Signature Parameters Registry</a></h3><div id="rfc.section.5.2.p.1"><p>This document defines the Signature header field, whose value contains a list of named parameters. IANA is asked to create and maintain a new registry titled “HTTP Signature Parameters” to record and maintain the set of named parameters defined for use within the Signature header field. Initial values for this registry are given in <a href="#iana-param-contents" title="Initial Contents">Section 5.2.2</a>. Future assignments and modifications to existing assignment are to be made through the Expert Review registration policy <a href="#RFC8126"><cite title="Guidelines for Writing an IANA Considerations Section in RFCs">[RFC8126]</cite></a> and shall follow the template presented in <a href="#iana-param-template" title="Registration Template">Section 5.2.1</a>.</p></div><section id="iana-param-template"><h4 id="rfc.section.5.2.1"><a href="#rfc.section.5.2.1">5.2.1.</a> <a href="#iana-param-template">Registration Template</a></h4></section><section id="iana-param-contents"><h4 id="rfc.section.5.2.2"><a href="#rfc.section.5.2.2">5.2.2.</a> <a href="#iana-param-contents">Initial Contents</a></h4><div id="rfc.section.5.2.2.p.1"><p>The table below contains the initial contents of the HTTP Signature Parameters Registry. Each row in the table represents a distinct entry in the registry.</p></div><div id="rfc.table.u.2" class="tt"><table class="tt full tcenter"><caption>Initial contents of the HTTP Signature Parameters Registry.</caption><thead><tr><th class="left">Name</th><th class="left">Status</th><th class="left">Reference(s)</th></tr></thead><tbody><tr><td class="left"><span class="tt">algorithm</span></td><td class="left">Active</td><td class="left"><a href="#params" title="Signature Header Parameters">Section 4.1</a> of this document</td></tr><tr><td class="left"><span class="tt">created</span></td><td class="left">Active</td><td class="left"><a href="#params" title="Signature Header Parameters">Section 4.1</a> of this document</td></tr><tr><td class="left"><span class="tt">expires</span></td><td class="left">Active</td><td class="left"><a href="#params" title="Signature Header Parameters">Section 4.1</a> of this document</td></tr><tr><td class="left"><span class="tt">headers</span></td><td class="left">Active</td><td class="left"><a href="#params" title="Signature Header Parameters">Section 4.1</a> of this document</td></tr><tr><td class="left"><span class="tt">keyId</span></td><td class="left">Active</td><td class="left"><a href="#params" title="Signature Header Parameters">Section 4.1</a> of this document</td></tr><tr><td class="left"><span class="tt">signature</span></td><td class="left">Active</td><td class="left"><a href="#params" title="Signature Header Parameters">Section 4.1</a> of this document</td></tr></tbody></table></div></section></section></section><section id="security"><h2 id="rfc.section.6"><a href="#rfc.section.6">6.</a> <a href="#security">Security Considerations</a></h2><div id="rfc.section.6.p.1"><p>(( TODO: need to dive deeper on this section; not sure how much of what’s referenced below is actually applicable, or if it covers everything we need to worry about. ))</p></div><div id="rfc.section.6.p.2"><p>(( TODO: Should provide some recommendations on how to determine what content needs to be signed for a given use case. ))</p></div><div id="rfc.section.6.p.3"><p>There are a number of security considerations to take into account when implementing or utilizing this specification. A thorough security analysis of this protocol, including its strengths and weaknesses, can be found in <a href="#WP-HTTP-Sig-Audit"><cite title="Security Considerations for HTTP Signatures">[WP-HTTP-Sig-Audit]</cite></a>.</p></div></section><section id="rfc.references"><h2 id="rfc.section.7"><a href="#rfc.section.7">7.</a> References</h2><section><div id="rfc.references.1"><h3 id="rfc.section.7.1"><a href="#rfc.section.7.1">7.1.</a> Normative References</h3><dl class="reference"><dt id="FIPS186-4">[FIPS186-4]</dt><dd>“<a href="https://csrc.nist.gov/publications/detail/fips/186/4/final">Digital Signature Standard (DSS)</a>”, 2013, &lt;<a href="https://csrc.nist.gov/publications/detail/fips/186/4/final">https://csrc.nist.gov/publications/detail/fips/186/4/final</a>&gt;.</dd><dt id="HTTP">[HTTP]</dt><dd>Fielding, R., Ed. and J. Reschke, Ed., “<a href="https://www.rfc-editor.org/rfc/rfc7230.html">Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing</a>”, RFC 7230, <a href="https://dx.doi.org/10.17487/RFC7230">DOI 10.17487/RFC7230</a>, June 2014, &lt;<a href="https://www.rfc-editor.org/info/rfc7230">https://www.rfc-editor.org/info/rfc7230</a>&gt;.</dd><dt id="HTTP2">[HTTP2]</dt><dd>Belshe, M., Peon, R., and M. Thomson, Ed., “<a href="https://www.rfc-editor.org/rfc/rfc7540.html">Hypertext Transfer Protocol Version 2 (HTTP/2)</a>”, RFC 7540, <a href="https://dx.doi.org/10.17487/RFC7540">DOI 10.17487/RFC7540</a>, May 2015, &lt;<a href="https://www.rfc-editor.org/info/rfc7540">https://www.rfc-editor.org/info/rfc7540</a>&gt;.</dd><dt id="POSIX.1">[POSIX.1]</dt><dd>“<a href="https://pubs.opengroup.org/onlinepubs/9699919799/">The Open Group Base Specifications Issue 7, 2018 edition</a>”, 2018, &lt;<a href="https://pubs.opengroup.org/onlinepubs/9699919799/">https://pubs.opengroup.org/onlinepubs/9699919799/</a>&gt;.</dd><dt id="RFC2104">[RFC2104]</dt><dd>Krawczyk, H., Bellare, M., and R. Canetti, “<a href="https://www.rfc-editor.org/rfc/rfc2104.html">HMAC: Keyed-Hashing for Message Authentication</a>”, RFC 2104, <a href="https://dx.doi.org/10.17487/RFC2104">DOI 10.17487/RFC2104</a>, February 1997, &lt;<a href="https://www.rfc-editor.org/info/rfc2104">https://www.rfc-editor.org/info/rfc2104</a>&gt;.</dd><dt id="RFC2119">[RFC2119]</dt><dd>Bradner, S., “<a href="https://www.rfc-editor.org/rfc/rfc2119.html">Key words for use in RFCs to Indicate Requirement Levels</a>”, BCP 14, RFC 2119, <a href="https://dx.doi.org/10.17487/RFC2119">DOI 10.17487/RFC2119</a>, March 1997, &lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;.</dd><dt id="RFC5234">[RFC5234]</dt><dd>Crocker, D., Ed. and P. Overell, “<a href="https://www.rfc-editor.org/rfc/rfc5234.html">Augmented BNF for Syntax Specifications: ABNF</a>”, STD 68, RFC 5234, <a href="https://dx.doi.org/10.17487/RFC5234">DOI 10.17487/RFC5234</a>, January 2008, &lt;<a href="https://www.rfc-editor.org/info/rfc5234">https://www.rfc-editor.org/info/rfc5234</a>&gt;.</dd><dt id="RFC7230">[RFC7230]</dt><dd>Fielding, R., Ed. and J. Reschke, Ed., “<a href="https://www.rfc-editor.org/rfc/rfc7230.html">Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing</a>”, RFC 7230, <a href="https://dx.doi.org/10.17487/RFC7230">DOI 10.17487/RFC7230</a>, June 2014, &lt;<a href="https://www.rfc-editor.org/info/rfc7230">https://www.rfc-editor.org/info/rfc7230</a>&gt;.</dd><dt id="RFC8174">[RFC8174]</dt><dd>Leiba, B., “<a href="https://www.rfc-editor.org/rfc/rfc8174.html">Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words</a>”, BCP 14, RFC 8174, <a href="https://dx.doi.org/10.17487/RFC8174">DOI 10.17487/RFC8174</a>, May 2017, &lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;.</dd></dl></div></section><section><div id="rfc.references.2"><h3 id="rfc.section.7.2"><a href="#rfc.section.7.2">7.2.</a> Informative References</h3><dl class="reference"><dt id="RFC3230">[RFC3230]</dt><dd>Mogul, J. and A. Van Hoff, “<a href="https://www.rfc-editor.org/rfc/rfc3230.html">Instance Digests in HTTP</a>”, RFC 3230, <a href="https://dx.doi.org/10.17487/RFC3230">DOI 10.17487/RFC3230</a>, January 2002, &lt;<a href="https://www.rfc-editor.org/info/rfc3230">https://www.rfc-editor.org/info/rfc3230</a>&gt;.</dd><dt id="RFC3339">[RFC3339]</dt><dd>Klyne, G. and C. Newman, “<a href="https://www.rfc-editor.org/rfc/rfc3339.html">Date and Time on the Internet: Timestamps</a>”, RFC 3339, <a href="https://dx.doi.org/10.17487/RFC3339">DOI 10.17487/RFC3339</a>, July 2002, &lt;<a href="https://www.rfc-editor.org/info/rfc3339">https://www.rfc-editor.org/info/rfc3339</a>&gt;.</dd><dt id="RFC3986">[RFC3986]</dt><dd>Berners-Lee, T., Fielding, R., and L. Masinter, “<a href="https://www.rfc-editor.org/rfc/rfc3986.html">Uniform Resource Identifier (URI): Generic Syntax</a>”, STD 66, RFC 3986, <a href="https://dx.doi.org/10.17487/RFC3986">DOI 10.17487/RFC3986</a>, January 2005, &lt;<a href="https://www.rfc-editor.org/info/rfc3986">https://www.rfc-editor.org/info/rfc3986</a>&gt;.</dd><dt id="RFC4648">[RFC4648]</dt><dd>Josefsson, S., “<a href="https://www.rfc-editor.org/rfc/rfc4648.html">The Base16, Base32, and Base64 Data Encodings</a>”, RFC 4648, <a href="https://dx.doi.org/10.17487/RFC4648">DOI 10.17487/RFC4648</a>, October 2006, &lt;<a href="https://www.rfc-editor.org/info/rfc4648">https://www.rfc-editor.org/info/rfc4648</a>&gt;.</dd><dt id="RFC6234">[RFC6234]</dt><dd>Eastlake 3rd, D. and T. Hansen, “<a href="https://www.rfc-editor.org/rfc/rfc6234.html">US Secure Hash Algorithms (SHA and SHA-based HMAC and HKDF)</a>”, RFC 6234, <a href="https://dx.doi.org/10.17487/RFC6234">DOI 10.17487/RFC6234</a>, May 2011, &lt;<a href="https://www.rfc-editor.org/info/rfc6234">https://www.rfc-editor.org/info/rfc6234</a>&gt;.</dd><dt id="RFC7239">[RFC7239]</dt><dd>Petersson, A. and M. Nilsson, “<a href="https://www.rfc-editor.org/rfc/rfc7239.html">Forwarded HTTP Extension</a>”, RFC 7239, <a href="https://dx.doi.org/10.17487/RFC7239">DOI 10.17487/RFC7239</a>, June 2014, &lt;<a href="https://www.rfc-editor.org/info/rfc7239">https://www.rfc-editor.org/info/rfc7239</a>&gt;.</dd><dt id="RFC7518">[RFC7518]</dt><dd>Jones, M., “<a href="https://www.rfc-editor.org/rfc/rfc7518.html">JSON Web Algorithms (JWA)</a>”, RFC 7518, <a href="https://dx.doi.org/10.17487/RFC7518">DOI 10.17487/RFC7518</a>, May 2015, &lt;<a href="https://www.rfc-editor.org/info/rfc7518">https://www.rfc-editor.org/info/rfc7518</a>&gt;.</dd><dt id="RFC7541">[RFC7541]</dt><dd>Peon, R. and H. Ruellan, “<a href="https://www.rfc-editor.org/rfc/rfc7541.html">HPACK: Header Compression for HTTP/2</a>”, RFC 7541, <a href="https://dx.doi.org/10.17487/RFC7541">DOI 10.17487/RFC7541</a>, May 2015, &lt;<a href="https://www.rfc-editor.org/info/rfc7541">https://www.rfc-editor.org/info/rfc7541</a>&gt;.</dd><dt id="RFC8017">[RFC8017]</dt><dd>Moriarty, K., Ed., Kaliski, B., Jonsson, J., and A. Rusch, “<a href="https://www.rfc-editor.org/rfc/rfc8017.html">PKCS #1: RSA Cryptography Specifications Version 2.2</a>”, RFC 8017, <a href="https://dx.doi.org/10.17487/RFC8017">DOI 10.17487/RFC8017</a>, November 2016, &lt;<a href="https://www.rfc-editor.org/info/rfc8017">https://www.rfc-editor.org/info/rfc8017</a>&gt;.</dd><dt id="RFC8032">[RFC8032]</dt><dd>Josefsson, S. and I. Liusvaara, “<a href="https://www.rfc-editor.org/rfc/rfc8032.html">Edwards-Curve Digital Signature Algorithm (EdDSA)</a>”, RFC 8032, <a href="https://dx.doi.org/10.17487/RFC8032">DOI 10.17487/RFC8032</a>, January 2017, &lt;<a href="https://www.rfc-editor.org/info/rfc8032">https://www.rfc-editor.org/info/rfc8032</a>&gt;.</dd><dt id="RFC8126">[RFC8126]</dt><dd>Cotton, M., Leiba, B., and T. Narten, “<a href="https://www.rfc-editor.org/rfc/rfc8126.html">Guidelines for Writing an IANA Considerations Section in RFCs</a>”, BCP 26, RFC 8126, <a href="https://dx.doi.org/10.17487/RFC8126">DOI 10.17487/RFC8126</a>, June 2017, &lt;<a href="https://www.rfc-editor.org/info/rfc8126">https://www.rfc-editor.org/info/rfc8126</a>&gt;.</dd><dt id="TLS">[TLS]</dt><dd>Rescorla, E., “<a href="https://www.rfc-editor.org/rfc/rfc8446.html">The Transport Layer Security (TLS) Protocol Version 1.3</a>”, RFC 8446, <a href="https://dx.doi.org/10.17487/RFC8446">DOI 10.17487/RFC8446</a>, August 2018, &lt;<a href="https://www.rfc-editor.org/info/rfc8446">https://www.rfc-editor.org/info/rfc8446</a>&gt;.</dd><dt id="WP-HTTP-Sig-Audit">[WP-HTTP-Sig-Audit]</dt><dd>“<a href="https://web-payments.org/specs/source/http-signatures-audit/">Security Considerations for HTTP Signatures</a>”, 2013, &lt;<a href="https://web-payments.org/specs/source/http-signatures-audit/">https://web-payments.org/specs/source/http-signatures-audit/</a>&gt;.</dd></dl></div></section></section><section id="examples"><h2 id="rfc.section.A" class="np"><a href="#rfc.section.A">Appendix A.</a> <a href="#examples">Examples</a></h2><section id="example-keys"><h3 id="rfc.section.A.1"><a href="#rfc.section.A.1">A.1.</a> <a href="#example-keys">Example Keys</a></h3><div id="rfc.section.A.1.p.1"><p>This section provides cryptographic keys that are referenced in example signatures throughout this document. These keys MUST NOT be used for any purpose other than testing.</p></div><section id="example-key-rsa-test"><h4 id="rfc.section.A.1.1"><a href="#rfc.section.A.1.1">A.1.1.</a> <a href="#example-key-rsa-test">Example Key RSA test</a></h4><div id="rfc.section.A.1.1.p.1" class="avoidbreakafter"><p>The following key is a 2048-bit RSA public and private key pair:</p></div><div id="rfc.figure.u.5"><div><pre>
-----BEGIN RSA PUBLIC KEY-----
MIIBCgKCAQEAhAKYdtoeoy8zcAcR874L8cnZxKzAGwd7v36APp7Pv6Q2jdsPBRrw
WEBnez6d0UDKDwGbc6nxfEXAy5mbhgajzrw3MOEt8uA5txSKobBpKDeBLOsdJKFq
MGmXCQvEG7YemcxDTRPxAleIAgYYRjTSd/QBwVW9OwNFhekro3RtlinV0a75jfZg
kne/YiktSvLG34lw2zqXBDTC5NHROUqGTlML4PlNZS5Ri2U4aCNx2rUPRcKIlE0P
uKxI4T+HIaFpv8+rdV6eUgOrB2xeI1dSFFn/nnv5OoZJEIB+VmuKn3DCUcCZSFlQ
PSXSfBDiUGhwOw76WuSSsf1D4b/vLoJ10wIDAQAB
-----END RSA PUBLIC KEY-----

-----BEGIN RSA PRIVATE KEY-----
MIIEqAIBAAKCAQEAhAKYdtoeoy8zcAcR874L8cnZxKzAGwd7v36APp7Pv6Q2jdsP
BRrwWEBnez6d0UDKDwGbc6nxfEXAy5mbhgajzrw3MOEt8uA5txSKobBpKDeBLOsd
JKFqMGmXCQvEG7YemcxDTRPxAleIAgYYRjTSd/QBwVW9OwNFhekro3RtlinV0a75
jfZgkne/YiktSvLG34lw2zqXBDTC5NHROUqGTlML4PlNZS5Ri2U4aCNx2rUPRcKI
lE0PuKxI4T+HIaFpv8+rdV6eUgOrB2xeI1dSFFn/nnv5OoZJEIB+VmuKn3DCUcCZ
SFlQPSXSfBDiUGhwOw76WuSSsf1D4b/vLoJ10wIDAQABAoIBAG/JZuSWdoVHbi56
vjgCgkjg3lkO1KrO3nrdm6nrgA9P9qaPjxuKoWaKO1cBQlE1pSWp/cKncYgD5WxE
CpAnRUXG2pG4zdkzCYzAh1i+c34L6oZoHsirK6oNcEnHveydfzJL5934egm6p8DW
+m1RQ70yUt4uRc0YSor+q1LGJvGQHReF0WmJBZHrhz5e63Pq7lE0gIwuBqL8SMaA
yRXtK+JGxZpImTq+NHvEWWCu09SCq0r838ceQI55SvzmTkwqtC+8AT2zFviMZkKR
Qo6SPsrqItxZWRty2izawTF0Bf5S2VAx7O+6t3wBsQ1sLptoSgX3QblELY5asI0J
YFz7LJECgYkAsqeUJmqXE3LP8tYoIjMIAKiTm9o6psPlc8CrLI9CH0UbuaA2JCOM
cCNq8SyYbTqgnWlB9ZfcAm/cFpA8tYci9m5vYK8HNxQr+8FS3Qo8N9RJ8d0U5Csw
DzMYfRghAfUGwmlWj5hp1pQzAuhwbOXFtxKHVsMPhz1IBtF9Y8jvgqgYHLbmyiu1
mwJ5AL0pYF0G7x81prlARURwHo0Yf52kEw1dxpx+JXER7hQRWQki5/NsUEtv+8RT
qn2m6qte5DXLyn83b1qRscSdnCCwKtKWUug5q2ZbwVOCJCtmRwmnP131lWRYfj67
B/xJ1ZA6X3GEf4sNReNAtaucPEelgR2nsN0gKQKBiGoqHWbK1qYvBxX2X3kbPDkv
9C+celgZd2PW7aGYLCHq7nPbmfDV0yHcWjOhXZ8jRMjmANVR/eLQ2EfsRLdW69bn
f3ZD7JS1fwGnO3exGmHO3HZG+6AvberKYVYNHahNFEw5TsAcQWDLRpkGybBcxqZo
81YCqlqidwfeO5YtlO7etx1xLyqa2NsCeG9A86UjG+aeNnXEIDk1PDK+EuiThIUa
/2IxKzJKWl1BKr2d4xAfR0ZnEYuRrbeDQYgTImOlfW6/GuYIxKYgEKCFHFqJATAG
IxHrq1PDOiSwXd2GmVVYyEmhZnbcp8CxaEMQoevxAta0ssMK3w6UsDtvUvYvF22m
qQKBiD5GwESzsFPy3Ga0MvZpn3D6EJQLgsnrtUPZx+z2Ep2x0xc5orneB5fGyF1P
WtP+fG5Q6Dpdz3LRfm+KwBCWFKQjg7uTxcjerhBWEYPmEMKYwTJF5PBG9/ddvHLQ
EQeNC8fHGg4UXU8mhHnSBt3EA10qQJfRDs15M38eG2cYwB1PZpDHScDnDA0=
-----END RSA PRIVATE KEY-----
</pre></div></div></section></section><section id="example-keyid-values"><h3 id="rfc.section.A.2"><a href="#rfc.section.A.2">A.2.</a> <a href="#example-keyid-values">Example keyId Values</a></h3><div id="rfc.section.A.2.p.1"><p>The table below maps example <span class="tt">keyId</span> values to associated algorithms and/or keys. These are example mappings that are valid only within the context of examples in examples within this and future documents that reference this section. Unless otherwise specified, within the context of examples it should be assumed that the signer and verifier understand these <span class="tt">keyId</span> mappings. These <span class="tt">keyId</span> values are not reserved, and deployments are free to use them, with these associations or others.</p></div><div id="rfc.table.u.3" class="tt"><table class="tt full tcenter"><thead><tr><th class="left">keyId</th><th class="left">Algorithm</th><th class="left">Verification Key</th></tr></thead><tbody><tr><td class="left"><span class="tt">test-key-a</span></td><td class="left"><span class="tt">hs2019</span>, using RSASSA-PSS <a href="#RFC8017"><cite title="PKCS #1: RSA Cryptography Specifications Version 2.2">[RFC8017]</cite></a> and SHA-512 <a href="#RFC6234"><cite title="US Secure Hash Algorithms (SHA and SHA-based HMAC and HKDF)">[RFC6234]</cite></a></td><td class="left">The public key specified in <a href="#example-key-rsa-test" title="Example Key RSA test">Appendix A.1.1</a></td></tr><tr><td class="left"><span class="tt">test-key-b</span></td><td class="left"><span class="tt">rsa-256</span></td><td class="left">The public key specified in <a href="#example-key-rsa-test" title="Example Key RSA test">Appendix A.1.1</a></td></tr></tbody></table></div></section><section id="test-cases"><h3 id="rfc.section.A.3"><a href="#rfc.section.A.3">A.3.</a> <a href="#test-cases">Test Cases</a></h3><div id="rfc.section.A.3.p.1" class="avoidbreakafter"><p>This section provides non-normative examples that may be used as test cases to validate implementation correctness. These examples are based on the following HTTP message:</p></div><div id="rfc.figure.u.6"><div><pre>
POST /foo?param=value&amp;pet=dog HTTP/1.1
Host: example.com
Date: Tue, 07 Jun 2014 20:51:35 GMT
Content-Type: application/json
Digest: SHA-256=X48E9qOokqqrvdts8nOJRJN3OWDUoyWxBf7kbu9DBPE=
Content-Length: 18

{"hello": "world"}
</pre></div></div><section id="signature-generation"><h4 id="rfc.section.A.3.1"><a href="#rfc.section.A.3.1">A.3.1.</a> <a href="#signature-generation">Signature Generation</a></h4><section id="hs2019-signature-over-minimal-recommended-content"><h5 id="rfc.section.A.3.1.1"><a href="#rfc.section.A.3.1.1">A.3.1.1.</a> <a href="#hs2019-signature-over-minimal-recommended-content">hs2019 signature over minimal recommended content</a></h5><div id="rfc.section.A.3.1.1.p.1" class="avoidbreakafter"><p>This presents metadata for a Signature using <span class="tt">hs2019</span>, over minimum recommended data to sign:</p></div><div id="rfc.table.u.4" class="tt"><table class="tt full tcenter"><thead><tr><th class="left">Property</th><th class="left">Value</th></tr></thead><tbody><tr><td class="left">Algorithm</td><td class="left"><span class="tt">hs2019</span>, using RSASSA-PSS <a href="#RFC8017"><cite title="PKCS #1: RSA Cryptography Specifications Version 2.2">[RFC8017]</cite></a> using SHA-512 <a href="#RFC6234"><cite title="US Secure Hash Algorithms (SHA and SHA-based HMAC and HKDF)">[RFC6234]</cite></a></td></tr><tr><td class="left">Covered Content</td><td class="left"><span class="tt">(created) (request-target)</span></td></tr><tr><td class="left">Creation Time</td><td class="left">8:51:35 PM GMT, June 7th, 2014</td></tr><tr><td class="left">Expiration Time</td><td class="left">Undefined</td></tr><tr><td class="left">Verification Key Material</td><td class="left">The public key specified in <a href="#example-key-rsa-test" title="Example Key RSA test">Appendix A.1.1</a>.</td></tr></tbody></table></div><div id="rfc.section.A.3.1.1.p.2" class="avoidbreakafter"><p>The Signature Input is:</p></div><div id="rfc.figure.u.7"><div><pre>
(created): 1402170695
(request-target): post /foo?param=value&amp;pet=dog
</pre></div></div><div id="rfc.section.A.3.1.1.p.3" class="avoidbreakafter"><p>The signature value is:</p></div><div id="rfc.figure.u.8"><div><pre>
e3y37nxAoeuXw2KbaIxE2d9jpE7Z9okgizg6QbD2Z7fUVUvog+ZTKKLRBnhNglVIY6fAa
YlHwx7ZAXXdBVF8gjWBPL6U9zRrB4PFzjoLSxHaqsvS0ZK9FRxpenptgukaVQ1aeva3PE
1aD6zZ93df2lFIFXGDefYCQ+M/SrDGQOFvaVykEkte5mO6zQZ/HpokjMKvilfSMJS+vbv
C1GJItQpjs636Db+7zB2W1BurkGxtQdCLDXuIDg4S8pPSDihkch/dUzL2BpML3PXGKVXw
HOUkVG6Q2ge07IYdzya6N1fIVA9eKI1Y47HT35QliVAxZgE0EZLo8mxq19ReIVvuFg==
</pre></div></div><div id="rfc.section.A.3.1.1.p.4" class="avoidbreakafter"><p>A possible Signature header for this signature is:</p></div><div id="rfc.figure.u.9"><div><pre>
Signature: keyId="test-key-a", created=1402170695,
    headers="(created) (request-target)",
    signature="e3y37nxAoeuXw2KbaIxE2d9jpE7Z9okgizg6QbD2Z7fUVUvog+ZTKK
        LRBnhNglVIY6fAaYlHwx7ZAXXdBVF8gjWBPL6U9zRrB4PFzjoLSxHaqsvS0ZK
        9FRxpenptgukaVQ1aeva3PE1aD6zZ93df2lFIFXGDefYCQ+M/SrDGQOFvaVyk
        Ekte5mO6zQZ/HpokjMKvilfSMJS+vbvC1GJItQpjs636Db+7zB2W1BurkGxtQ
        dCLDXuIDg4S8pPSDihkch/dUzL2BpML3PXGKVXwHOUkVG6Q2ge07IYdzya6N1
        fIVA9eKI1Y47HT35QliVAxZgE0EZLo8mxq19ReIVvuFg=="
</pre></div></div></section><section id="hs2019-signature-covering-all-header-fields"><h5 id="rfc.section.A.3.1.2"><a href="#rfc.section.A.3.1.2">A.3.1.2.</a> <a href="#hs2019-signature-covering-all-header-fields">hs2019 signature covering all header fields</a></h5><div id="rfc.section.A.3.1.2.p.1" class="avoidbreakafter"><p>This presents metadata for a Signature using <span class="tt">hs2019</span> that covers all header fields in the request:</p></div><div id="rfc.table.u.5" class="tt"><table class="tt full tcenter"><thead><tr><th class="left">Property</th><th class="left">Value</th></tr></thead><tbody><tr><td class="left">Algorithm</td><td class="left"><span class="tt">hs2019</span>, using RSASSA-PSS <a href="#RFC8017"><cite title="PKCS #1: RSA Cryptography Specifications Version 2.2">[RFC8017]</cite></a> using SHA-512 <a href="#RFC6234"><cite title="US Secure Hash Algorithms (SHA and SHA-based HMAC and HKDF)">[RFC6234]</cite></a></td></tr><tr><td class="left">Covered Content</td><td class="left"><span class="tt">(created), (request-target), host, date, content-type, digest, content-length</span></td></tr><tr><td class="left">Creation Time</td><td class="left">8:51:35 PM GMT, June 7th, 2014</td></tr><tr><td class="left">Expiration Time</td><td class="left">Undefined</td></tr><tr><td class="left">Verification Key Material</td><td class="left">The public key specified in <a href="#example-key-rsa-test" title="Example Key RSA test">Appendix A.1.1</a>.</td></tr></tbody></table></div><div id="rfc.section.A.3.1.2.p.2" class="avoidbreakafter"><p>The Signature Input is:</p></div><div id="rfc.figure.u.10"><div><pre>
(created): 1402170695
(request-target): post /foo?param=value&amp;pet=dog
host: example.com
date: Tue, 07 Jun 2014 20:51:35 GMT
content-type: application/json
digest: SHA-256=X48E9qOokqqrvdts8nOJRJN3OWDUoyWxBf7kbu9DBPE=
content-length: 18
</pre></div></div><div id="rfc.section.A.3.1.2.p.3" class="avoidbreakafter"><p>The signature value is:</p></div><div id="rfc.figure.u.11"><div><pre>
KXUj1H3ZOhv3Nk4xlRLTn4bOMlMOmFiud3VXrMa9MaLCxnVmrqOX5BulRvB65YW/wQp0o
T/nNQpXgOYeY8ovmHlpkRyz5buNDqoOpRsCpLGxsIJ9cX8XVsM9jy+Q1+RIlD9wfWoPHh
qhoXt35ZkasuIDPF/AETuObs9QydlsqONwbK+TdQguDK/8Va1Pocl6wK1uLwqcXlxhPEb
55EmdYB9pddDyHTADING7K4qMwof2mC3t8Pb0yoLZoZX5a4Or4FrCCKK/9BHAhq/RsVk0
dTENMbTB4i7cHvKQu+o9xuYWuxyvBa0Z6NdOb0di70cdrSDEsL5Gz7LBY5J2N9KdGg==
</pre></div></div><div id="rfc.section.A.3.1.2.p.4" class="avoidbreakafter"><p>A possible Signature header for this signature is:</p></div><div id="rfc.figure.u.12"><div><pre>
Signature: keyId="test-key-a", algorithm="hs2019",
    created=1402170695,
    headers="(request-target) (created) host date content-type digest
        content-length",
    signature="KXUj1H3ZOhv3Nk4xlRLTn4bOMlMOmFiud3VXrMa9MaLCxnVmrqOX5B
        ulRvB65YW/wQp0oT/nNQpXgOYeY8ovmHlpkRyz5buNDqoOpRsCpLGxsIJ9cX8
        XVsM9jy+Q1+RIlD9wfWoPHhqhoXt35ZkasuIDPF/AETuObs9QydlsqONwbK+T
        dQguDK/8Va1Pocl6wK1uLwqcXlxhPEb55EmdYB9pddDyHTADING7K4qMwof2m
        C3t8Pb0yoLZoZX5a4Or4FrCCKK/9BHAhq/RsVk0dTENMbTB4i7cHvKQu+o9xu
        YWuxyvBa0Z6NdOb0di70cdrSDEsL5Gz7LBY5J2N9KdGg=="
</pre></div></div></section></section><section id="signature-verification"><h4 id="rfc.section.A.3.2"><a href="#rfc.section.A.3.2">A.3.2.</a> <a href="#signature-verification">Signature Verification</a></h4><section id="minimal-required-signature-header"><h5 id="rfc.section.A.3.2.1"><a href="#rfc.section.A.3.2.1">A.3.2.1.</a> <a href="#minimal-required-signature-header">Minimal Required Signature Header</a></h5><div id="rfc.section.A.3.2.1.p.1" class="avoidbreakafter"><p>This presents a Signature header containing only the minimal required parameters:</p></div><div id="rfc.figure.u.13"><div><pre>
Signature: keyId="test-key-a", (created): 1402170695,
    signature="V3SijFpJOvDUT8t1/EnYli/4TbF2AGqwBGiGUGrgClCkiOAIlOxxY7
        2Mr13DccFkYzg3gX1jIOpKXzH70C5bru4b71SBG+ShiJLu34gHCG33iw44NLG
        UvT5+F+LCKbbHberyk8eyYsZ+TLwtZAYKafxfNOWQXF4o3QaWslDMm8Tcgrd8
        onM45ayFyR4nXRlcGad4PISYGz8PmO4Y+K8RYOyDkgsmRxKtftFQUYG41anyE
        lccNLfEfLBKsyV6kxr36U1Q7FdUopLv8kqluQySrWD6kesvFxNvbEOi+1uZqT
        uFlK8ZldITQiqtNYaabRjQFZio63gma2y+UAaTGLdM9A=="
</pre></div></div><div id="rfc.section.A.3.2.1.p.2" class="avoidbreakafter"><p>The corresponding signature metadata derived from this header field is:</p></div><div id="rfc.table.u.6" class="tt"><table class="tt full tcenter"><thead><tr><th class="left">Property</th><th class="left">Value</th></tr></thead><tbody><tr><td class="left">Algorithm</td><td class="left"><span class="tt">hs2019</span>, using RSASSA-PSS using SHA-256</td></tr><tr><td class="left">Covered Content</td><td class="left"><span class="tt">(created)</span></td></tr><tr><td class="left">Creation Time</td><td class="left">8:51:35 PM GMT, June 7th, 2014</td></tr><tr><td class="left">Expiration Time</td><td class="left">Undefined</td></tr><tr><td class="left">Verification Key Material</td><td class="left">The public key specified in <a href="#example-key-rsa-test" title="Example Key RSA test">Appendix A.1.1</a>.</td></tr></tbody></table></div><div id="rfc.section.A.3.2.1.p.3" class="avoidbreakafter"><p>The corresponding Signature Input is:</p></div><div id="rfc.figure.u.14"><div><pre>
(created): 1402170695
</pre></div></div></section><section id="minimal-recommended-signature-header"><h5 id="rfc.section.A.3.2.2"><a href="#rfc.section.A.3.2.2">A.3.2.2.</a> <a href="#minimal-recommended-signature-header">Minimal Recommended Signature Header</a></h5><div id="rfc.section.A.3.2.2.p.1" class="avoidbreakafter"><p>This presents a Signature header containing only the minimal required and recommended parameters:</p></div><div id="rfc.figure.u.15"><div><pre>
Signature: algorithm="hs2019", keyId="test-key-a",
    (created): 1402170695,
    signature="V3SijFpJOvDUT8t1/EnYli/4TbF2AGqwBGiGUGrgClCkiOAIlOxxY7
        2Mr13DccFkYzg3gX1jIOpKXzH70C5bru4b71SBG+ShiJLu34gHCG33iw44NLG
        UvT5+F+LCKbbHberyk8eyYsZ+TLwtZAYKafxfNOWQXF4o3QaWslDMm8Tcgrd8
        onM45ayFyR4nXRlcGad4PISYGz8PmO4Y+K8RYOyDkgsmRxKtftFQUYG41anyE
        lccNLfEfLBKsyV6kxr36U1Q7FdUopLv8kqluQySrWD6kesvFxNvbEOi+1uZqT
        uFlK8ZldITQiqtNYaabRjQFZio63gma2y+UAaTGLdM9A=="
</pre></div></div><div id="rfc.section.A.3.2.2.p.2" class="avoidbreakafter"><p>The corresponding signature metadata derived from this header field is:</p></div><div id="rfc.table.u.7" class="tt"><table class="tt full tcenter"><thead><tr><th class="left">Property</th><th class="left">Value</th></tr></thead><tbody><tr><td class="left">Algorithm</td><td class="left"><span class="tt">hs2019</span>, using RSASSA-PSS using SHA-512</td></tr><tr><td class="left">Covered Content</td><td class="left"><span class="tt">(created)</span></td></tr><tr><td class="left">Creation Time</td><td class="left">8:51:35 PM GMT, June 7th, 2014</td></tr><tr><td class="left">Expiration Time</td><td class="left">Undefined</td></tr><tr><td class="left">Verification Key Material</td><td class="left">The public key specified in <a href="#example-key-rsa-test" title="Example Key RSA test">Appendix A.1.1</a>.</td></tr></tbody></table></div><div id="rfc.section.A.3.2.2.p.3" class="avoidbreakafter"><p>The corresponding Signature Input is:</p></div><div id="rfc.figure.u.16"><div><pre>
(created): 1402170695
</pre></div></div></section><section id="minimal-signature-header-using-rsa-256"><h5 id="rfc.section.A.3.2.3"><a href="#rfc.section.A.3.2.3">A.3.2.3.</a> <a href="#minimal-signature-header-using-rsa-256">Minimal Signature Header using rsa-256</a></h5><div id="rfc.section.A.3.2.3.p.1" class="avoidbreakafter"><p>This presents a minimal Signature header for a signature using the <span class="tt">rsa-256</span> algorithm:</p></div><div id="rfc.figure.u.17"><div><pre>
Signature: algorithm="rsa-256", keyId="test-key-b",
    headers="date",
    signature="HtXycCl97RBVkZi66ADKnC9c5eSSlb57GnQ4KFqNZplOpNfxqk62Jz
        Z484jXgLvoOTRaKfR4hwyxlcyb+BWkVasApQovBSdit9Ml/YmN2IvJDPncrlh
        PDVDv36Z9/DiSO+RNHD7iLXugdXo1+MGRimW1RmYdenl/ITeb7rjfLZ4b9VNn
        LFtVWwrjhAiwIqeLjodVImzVc5srrk19HMZNuUejK6I3/MyN3+3U8tIRW4LWz
        x6ZgGZUaEEP0aBlBkt7Fj0Tt5/P5HNW/Sa/m8smxbOHnwzAJDa10PyjzdIbyw
        lnWIIWtZKPPsoVoKVopUWEU3TNhpWmaVhFrUL/O6SN3w=="
</pre></div></div><div id="rfc.section.A.3.2.3.p.2" class="avoidbreakafter"><p>The corresponding signature metadata derived from this header field is:</p></div><div id="rfc.table.u.8" class="tt"><table class="tt full tcenter"><thead><tr><th class="left">Property</th><th class="left">Value</th></tr></thead><tbody><tr><td class="left">Algorithm</td><td class="left"><span class="tt">rsa-256</span></td></tr><tr><td class="left">Covered Content</td><td class="left"><span class="tt">date</span></td></tr><tr><td class="left">Creation Time</td><td class="left">Undefined</td></tr><tr><td class="left">Expiration Time</td><td class="left">Undefined</td></tr><tr><td class="left">Verification Key Material</td><td class="left">The public key specified in <a href="#example-key-rsa-test" title="Example Key RSA test">Appendix A.1.1</a>.</td></tr></tbody></table></div><div id="rfc.section.A.3.2.3.p.3" class="avoidbreakafter"><p>The corresponding Signature Input is:</p></div><div id="rfc.figure.u.18"><div><pre>
date: Tue, 07 Jun 2014 20:51:35 GMT
</pre></div></div></section></section></section></section><section id="wg-discuss"><h2 id="rfc.section.B"><a href="#rfc.section.B">Appendix B.</a> <a href="#wg-discuss">Topics for Working Group Discussion</a></h2><div id="rfc.section.B.p.1"><p><em>RFC EDITOR: please remove this section before publication</em></p></div><div id="rfc.section.B.p.2"><p>The goal of this draft document is to provide a starting point at feature parity and compatible with the cavage-12 draft. The draft has known issues that will need to be addressed during development, and in the spirit of keeping compatibility, these issues have been enumerated but not addressed in this version. The editor recommends the working group discuss the issues and features described in this section after adoption of the document by the working group. Topics are not listed in any particular order.</p></div><section id="issues"><h3 id="rfc.section.B.1"><a href="#rfc.section.B.1">B.1.</a> <a href="#issues">Issues</a></h3><section id="issue-alg-keyid"><h4 id="rfc.section.B.1.1"><a href="#rfc.section.B.1.1">B.1.1.</a> <a href="#issue-alg-keyid">Confusing guidance on algorithm and key identification</a></h4><div id="rfc.section.B.1.1.p.1"><p>The current draft encourages determining the Algorithm metadata property from the <span class="tt">keyId</span> field, both in the guidance for the use of <span class="tt">algorithm</span> and <span class="tt">keyId</span>, and the definition for the <span class="tt">hs2019</span> algorithm and deprecation of the other algorithms in the registry. The current state arose from concern that a malicious party could change the value of the <span class="tt">algorithm</span> parameter, potentially tricking the verifier into accepting a signature that would not have been verified under the actual parameter.</p></div><div id="rfc.section.B.1.1.p.2"><p>Punting algorithm identification into <span class="tt">keyId</span> hurts interoperability, since we aren’t defining the syntax or semantics of <span class="tt">keyId</span>. It actually goes against that claim, as we are dictating that the signing algorithm must be specified by <span class="tt">keyId</span> or derivable from it. It also renders the algorithm registry essentially useless. Instead of this approach, we can protect against manipulation of the Signature header field by adding support for (and possibly mandating) including Signature metadata within the Signature Input.</p></div></section><section id="lack-of-definition-of-keyid-hurts-interoperability"><h4 id="rfc.section.B.1.2"><a href="#rfc.section.B.1.2">B.1.2.</a> <a href="#lack-of-definition-of-keyid-hurts-interoperability">Lack of definition of keyId hurts interoperability</a></h4><div id="rfc.section.B.1.2.p.1"><p>The current text leaves the format and semantics of <span class="tt">keyId</span> completely up to the implementation. This is primarily due to the fact that most implementers of Cavage have extensive investment in key distribution and management, and just need to plug an identifier into the header. We should support those cases, but we also need to provide guidance for the developer that doesn’t have that and just wants to know how to identify a key. It may be enough to punt this to profiling specs, but this needs to be explored more.</p></div></section><section id="algorithm-registry-duplicates-work-of-jwa"><h4 id="rfc.section.B.1.3"><a href="#rfc.section.B.1.3">B.1.3.</a> <a href="#algorithm-registry-duplicates-work-of-jwa">Algorithm Registry duplicates work of JWA</a></h4><div id="rfc.section.B.1.3.p.1"><p><a href="#RFC7518"><cite title="JSON Web Algorithms (JWA)">[RFC7518]</cite></a> already defines an IANA registry for cryptographic algorithms. This wasn’t used by Cavage out of concerns about complexity of JOSE, and issues with JWE and JWS being too flexible, leading to insecure combinations of options. Using JWA’s definitions does not need to mean we’re using JOSE, however. We should look at if/how we can leverage JWA’s work without introducing too many sharp edges for implementers.</p></div><div id="rfc.section.B.1.3.p.2"><p>In any use of JWS algorithms, this spec would define a way to create the JWS Signing Input string to be applied to the algorithm. It should be noted that this is incompatible with JWS itself, which requires the inclusion of a structured header in the signature input.</p></div><div id="rfc.section.B.1.3.p.3"><p>A possible approach is to incorporate all elements of the JWA signature algorithm registry into this spec using a prefix or other marker, such as <span class="tt">jws-RS256</span> for the RSA 256 JSON Web Signature algorithm.</p></div></section><section id="algorithm-registry-should-not-be-initialized-with-deprecated-entries"><h4 id="rfc.section.B.1.4"><a href="#rfc.section.B.1.4">B.1.4.</a> <a href="#algorithm-registry-should-not-be-initialized-with-deprecated-entries">Algorithm Registry should not be initialized with deprecated entries</a></h4><div id="rfc.section.B.1.4.p.1"><p>The initial entries in this document reflect those in Cavage. The ones that are marked deprecated were done so because of the issue explained in <a href="#issue-alg-keyid" title="Confusing guidance on algorithm and key identification">Appendix B.1.1</a>, with the possible exception of <span class="tt">rsa-sha1</span>. We should probably just remove that one.</p></div></section><section id="no-percent-encoding-normalization-of-pathquery"><h4 id="rfc.section.B.1.5"><a href="#rfc.section.B.1.5">B.1.5.</a> <a href="#no-percent-encoding-normalization-of-pathquery">No percent-encoding normalization of path/query</a></h4><div id="rfc.section.B.1.5.p.1"><p>See: <a href="https://github.com/w3c-dvcg/http-signatures/issues/26">issue #26</a></p></div><div id="rfc.section.B.1.5.p.2"><p>The canonicalization rules for <span class="tt">(request-target)</span> do not perform handle minor, semantically meaningless differences in percent-encoding, such that verification could fail if an intermediary normalizes the effective request URI prior to forwarding the message.</p></div><div id="rfc.section.B.1.5.p.3"><p>At a minimum, they should be case and percent-encoding normalized as described in sections 6.2.2.1 and 6.2.2.2 of <a href="#RFC3986"><cite title="Uniform Resource Identifier (URI): Generic Syntax">[RFC3986]</cite></a>.</p></div></section><section id="misleading-name-for-headers-parameter"><h4 id="rfc.section.B.1.6"><a href="#rfc.section.B.1.6">B.1.6.</a> <a href="#misleading-name-for-headers-parameter">Misleading name for headers parameter</a></h4><div id="rfc.section.B.1.6.p.1"><p>The Covered Content list contains identifiers for more than just headers, so the <span class="tt">header</span> parameter name is no longer appropriate. Some alternatives: “content”, “signed-content”, “covered-content”.</p></div></section><section id="changes-to-whitespace-in-header-field-values-break-verification"><h4 id="rfc.section.B.1.7"><a href="#rfc.section.B.1.7">B.1.7.</a> <a href="#changes-to-whitespace-in-header-field-values-break-verification">Changes to whitespace in header field values break verification</a></h4><div id="rfc.section.B.1.7.p.1"><p>Some header field values contain RWS, OWS, and/or BWS. Since the header field value canonicalization rules do not address whitespace, changes to it (e.g., removing OWS or BWS or replacing strings of RWS with a single space) can cause verification to fail.</p></div></section><section id="multiple-set-cookie-headers-are-not-well-supported"><h4 id="rfc.section.B.1.8"><a href="#rfc.section.B.1.8">B.1.8.</a> <a href="#multiple-set-cookie-headers-are-not-well-supported">Multiple Set-Cookie headers are not well supported</a></h4><div id="rfc.section.B.1.8.p.1"><p>The Set-Cookie header can occur multiple times but does not adhere to the list syntax, and thus is not well supported by the header field value concatenation rules.</p></div></section><section id="covered-content-list-is-not-signed"><h4 id="rfc.section.B.1.9"><a href="#rfc.section.B.1.9">B.1.9.</a> <a href="#covered-content-list-is-not-signed">Covered Content list is not signed</a></h4><div id="rfc.section.B.1.9.p.1"><p>The Covered Content list should be part of the Signature Input, to protect against malicious changes.</p></div></section><section id="algorithm-is-not-signed"><h4 id="rfc.section.B.1.10"><a href="#rfc.section.B.1.10">B.1.10.</a> <a href="#algorithm-is-not-signed">Algorithm is not signed</a></h4><div id="rfc.section.B.1.10.p.1"><p>The Algorithm should be part of the Signature Input, to protect against malicious changes.</p></div></section><section id="verification-key-identifier-is-not-signed"><h4 id="rfc.section.B.1.11"><a href="#rfc.section.B.1.11">B.1.11.</a> <a href="#verification-key-identifier-is-not-signed">Verification key identifier is not signed</a></h4><div id="rfc.section.B.1.11.p.1"><p>The Verification key identifier (e.g., the value used for the <span class="tt">keyId</span> parameter) should be part of the Signature Input, to protect against malicious changes.</p></div></section><section id="max-values-precision-for-integer-string-and-decimal-string-not-defined"><h4 id="rfc.section.B.1.12"><a href="#rfc.section.B.1.12">B.1.12.</a> <a href="#max-values-precision-for-integer-string-and-decimal-string-not-defined">Max values, precision for Integer String and Decimal String not defined</a></h4><div id="rfc.section.B.1.12.p.1"><p>The definitions for Integer String and Decimal String do not specify a maximum value. The definition for Decimal String (used to provide sub-second precision for Expiration Time) does not define minimum or maximum precision requirements. It should set a sane requirement here (e.g., MUST support up to 3 decimal places and no more).</p></div></section><section id="keyid-parameter-value-could-break-list-syntax"><h4 id="rfc.section.B.1.13"><a href="#rfc.section.B.1.13">B.1.13.</a> <a href="#keyid-parameter-value-could-break-list-syntax">keyId parameter value could break list syntax</a></h4><div id="rfc.section.B.1.13.p.1"><p>The <span class="tt">keyId</span> parameter value needs to be constrained so as to not break list syntax (e.g., by containing a comma).</p></div></section><section id="creation-time-and-expiration-time-do-not-allow-for-clock-skew"><h4 id="rfc.section.B.1.14"><a href="#rfc.section.B.1.14">B.1.14.</a> <a href="#creation-time-and-expiration-time-do-not-allow-for-clock-skew">Creation Time and Expiration Time do not allow for clock skew</a></h4><div id="rfc.section.B.1.14.p.1"><p>The processing instructions for Creation Time and Expiration Time imply that verifiers are not permitted to account for clock skew during signature verification.</p></div></section><section id="should-require-lowercased-header-field-names-as-identifiers"><h4 id="rfc.section.B.1.15"><a href="#rfc.section.B.1.15">B.1.15.</a> <a href="#should-require-lowercased-header-field-names-as-identifiers">Should require lowercased header field names as identifiers</a></h4><div id="rfc.section.B.1.15.p.1"><p>The current text allows mixed-case header field names when they are being used as content identifiers. This is unnecessary, as header field names are case-insensitive, and creates opportunity for incompatibility. Instead, content identifiers should always be lowercase.</p></div></section><section id="reconcile-date-header-and-creation-time"><h4 id="rfc.section.B.1.16"><a href="#rfc.section.B.1.16">B.1.16.</a> <a href="#reconcile-date-header-and-creation-time">Reconcile Date header and Creation Time</a></h4><div id="rfc.section.B.1.16.p.1"><p>The draft is missing guidance on if/how the Date header relates to signature Creation Time. There are cases where they may be different, such as if a signature was pre-created. Should Creation Time default to the value in the Date header if the <span class="tt">created</span> parameter is not specified?</p></div></section><section id="remove-algorithm-specific-rules-for-content-identifiers"><h4 id="rfc.section.B.1.17"><a href="#rfc.section.B.1.17">B.1.17.</a> <a href="#remove-algorithm-specific-rules-for-content-identifiers">Remove algorithm-specific rules for content identifiers</a></h4><div id="rfc.section.B.1.17.p.1"><p>The rules that restrict when the signer can or must include certain identifiers appear to be related to the pseudo-revving of the Cavage draft that happened when the <span class="tt">hs2019</span> algorithm was introduced. We should drop these rules, as it can be expected that anyone implementing this draft will support all content identifiers.</p></div></section><section id="add-guidance-for-signing-compressed-headers"><h4 id="rfc.section.B.1.18"><a href="#rfc.section.B.1.18">B.1.18.</a> <a href="#add-guidance-for-signing-compressed-headers">Add guidance for signing compressed headers</a></h4><div id="rfc.section.B.1.18.p.1"><p>The draft should provide guidance on how to sign headers when <a href="#RFC7541"><cite title="HPACK: Header Compression for HTTP/2">[RFC7541]</cite></a> is used. This guidance might be as simple as “sign the uncompressed header field value.”</p></div></section><section id="transformations-to-via-header-field-value-break-verification"><h4 id="rfc.section.B.1.19"><a href="#rfc.section.B.1.19">B.1.19.</a> <a href="#transformations-to-via-header-field-value-break-verification">Transformations to Via header field value break verification</a></h4><div id="rfc.section.B.1.19.p.1"><p>Intermediaries are permitted to strip comments from the <span class="tt">Via</span> header field value, and consolidate related sequences of entries. The canonicalization rules do not account for these changes, and thus they cause signature verification to fail if the <span class="tt">Via</span> header is signed. At the very least, guidance on signing or not signing <span class="tt">Via</span> headers needs to be included.</p></div></section><section id="case-changes-to-case-insensitive-header-field-values-break-verification"><h4 id="rfc.section.B.1.20"><a href="#rfc.section.B.1.20">B.1.20.</a> <a href="#case-changes-to-case-insensitive-header-field-values-break-verification">Case changes to case-insensitive header field values break verification</a></h4><div id="rfc.section.B.1.20.p.1"><p>Some header field values are case-insensitive, in whole or in part. The canonicalization rules do not account for this, thus a case change to a covered header field value causes verification to fail.</p></div></section><section id="need-more-examples-for-signature-header"><h4 id="rfc.section.B.1.21"><a href="#rfc.section.B.1.21">B.1.21.</a> <a href="#need-more-examples-for-signature-header">Need more examples for Signature header</a></h4><div id="rfc.section.B.1.21.p.1"><p>Add more examples showing different cases e.g, where <span class="tt">created</span> or <span class="tt">expires</span> are not present.</p></div></section><section id="expiration-not-needed"><h4 id="rfc.section.B.1.22"><a href="#rfc.section.B.1.22">B.1.22.</a> <a href="#expiration-not-needed">Expiration not needed</a></h4><div id="rfc.section.B.1.22.p.1"><p>In many cases, putting the expiration of the signature into the hands of the signer opens up more options for failures than necessary. Instead of the <span class="tt">expires</span>, any verifier can use the <span class="tt">created</span> field and an internal lifetime or offset to calculate expiration. We should consider dropping the <span class="tt">expires</span> field.</p></div></section></section><section id="features"><h3 id="rfc.section.B.2"><a href="#rfc.section.B.2">B.2.</a> <a href="#features">Features</a></h3><section id="define-more-content-identifiers"><h4 id="rfc.section.B.2.1"><a href="#rfc.section.B.2.1">B.2.1.</a> <a href="#define-more-content-identifiers">Define more content identifiers</a></h4><div id="rfc.section.B.2.1.p.1" class="avoidbreakafter"><p>It should be possible to independently include the following content and metadata properties in Covered Content:</p></div><div id="rfc.section.B.2.1.p.2"><ul><li>The signature’s Algorithm</li><li>The signature’s Covered Content</li><li>The value used for the <span class="tt">keyId</span> parameter</li><li>Request method</li><li>Individual components of the effective request URI: scheme, authority, path, query</li><li>Status code</li><li>Request body (currently supported via Digest header <a href="#RFC3230"><cite title="Instance Digests in HTTP">[RFC3230]</cite></a> )</li></ul></div></section><section id="multiple-signature-support"><h4 id="rfc.section.B.2.2"><a href="#rfc.section.B.2.2">B.2.2.</a> <a href="#multiple-signature-support">Multiple signature support</a></h4><div id="rfc.section.B.2.2.p.1"><p>(( Editor’s note: I believe this use case is theoretical. Please let me know if this is a use case you have. ))</p></div><div id="rfc.section.B.2.2.p.2" class="avoidbreakafter"><p>There may be scenarios where attaching multiple signatures to a single message is useful:</p></div><div id="rfc.section.B.2.2.p.3"><ul><li>A gateway attaches a signature over headers it adds (e.g., <span class="tt">Forwarded</span>) to messages already signed by the user agent.</li><li>A signer attaches two signatures signed by different keys, to be verified by different entities.</li></ul></div><div id="rfc.section.B.2.2.p.4"><p>This could be addressed by changing the Signature header syntax to accept a list of parameter sets for a single signature, e.g., by separating parameters with <span class="tt">";"</span> instead of <span class="tt">","</span>. It may also be necessary to include a signature identifier parameter.</p></div></section><section id="support-for-incremental-signing-of-header-field-value-list-items"><h4 id="rfc.section.B.2.3"><a href="#rfc.section.B.2.3">B.2.3.</a> <a href="#support-for-incremental-signing-of-header-field-value-list-items">Support for incremental signing of header field value list items</a></h4><div id="rfc.section.B.2.3.p.1"><p>(( Editor’s note: I believe this use case is theoretical. Please let me know if this is a use case you have. ))</p></div><div id="rfc.section.B.2.3.p.2"><p>Currently, signing a header field value is all-or-nothing: either the entire value is signed, or none of it is. For header fields that use list syntax, it would be useful to be able to specify which items in the list are signed.</p></div><div id="rfc.section.B.2.3.p.3"><p>A simple approach that allowed the signer to indicate the list size at signing time would allow a signer to sign header fields that are may be appended to by intermediaries as the message makes its way to the recipient. Specifying list size in terms of number of items could introduce risks of list syntax is not strictly adhered to (e.g., a malicious party crafts a value that gets parsed by the application as 5 items, but by the verifier as 4). Specifying list size in number of octets might address this, but more exploration is required.</p></div></section><section id="support-expected-authority-changes"><h4 id="rfc.section.B.2.4"><a href="#rfc.section.B.2.4">B.2.4.</a> <a href="#support-expected-authority-changes">Support expected authority changes</a></h4><div id="rfc.section.B.2.4.p.1"><p>In some cases, the authority of the effective request URI may be expected to change, for example from “public-service-name.example.com” to “service-host-1.public-service-name.example.com”. This is commonly the case for services that are hosted behind a load-balancing gateway, where the client sends requests to a publicly known domain name for the service, and these requests are transformed by the gateway into requests to specific hosts in the service fleet.</p></div><div id="rfc.section.B.2.4.p.2"><p>One possible way to handle this would be to special-case the Host header field to allow verifier to substitute a known expected value, or a value provided in another header field (e.g., <span class="tt">Via</span>) when generating the Signature Input, provided that the verifier also recognizes the real value in the <span class="tt">Host</span> header. Alternatively, this logic could apply to an <span class="tt">(audience)</span> content identifier.</p></div></section><section id="support-for-signing-specific-cookies"><h4 id="rfc.section.B.2.5"><a href="#rfc.section.B.2.5">B.2.5.</a> <a href="#support-for-signing-specific-cookies">Support for signing specific cookies</a></h4><div id="rfc.section.B.2.5.p.1"><p>A signer may only wish to sign one or a few cookies, for example if the website requires its authentication state cookie to be signed, but also sets other cookies (e.g., for analytics, ad tracking, etc.)</p></div></section></section></section><section id="acknowledgements"><h2 id="rfc.section.unnumbered-1"><a href="#acknowledgements">Acknowledgements</a></h2><div id="rfc.section.unnumbered-1.p.1"><p>This specification is based on the draft-cavage-http-signatures draft. The editor would like to thank the authors of that draft, Mark Cavage and Manu Sporny, for their work on that draft and their continuing contributions.</p></div><div id="rfc.section.unnumbered-1.p.2"><p>The editor would also like to thank the following individuals for feedback on and implementations of the draft-cavage-http-signatures draft (in alphabetical order): Mark Adamcin, Mark Allen, Paul Annesley, Karl Böhlmark, Stéphane Bortzmeyer, Sarven Capadisli, Liam Dennehy, ductm54, Stephen Farrell, Phillip Hallam-Baker, Eric Holmes, Andrey Kislyuk, Adam Knight, Dave Lehn, Dave Longley, James H. Manger, Ilari Liusvaara, Mark Nottingham, Yoav Nir, Adrian Palmer, Lucas Pardue, Roberto Polli, Julian Reschke, Michael Richardson, Wojciech Rygielski, Adam Scarr, Cory J. Slep, Dirk Stein, Henry Story, Lukasz Szewc, Chris Webber, and Jeffrey Yasskin</p></div></section><section id="document-history"><h2 id="rfc.section.unnumbered-2"><a href="#document-history">Document History</a></h2><div id="rfc.section.unnumbered-2.p.1"><p><em>RFC EDITOR: please remove this section before publication</em></p></div><div id="rfc.section.unnumbered-2.p.2"><ul><li>draft-ietf-httpbis-message-signatures <ul><li>-01 <ul><li>Strengthened requirement for content identifiers for header fields to be lower-case (changed from SHOULD to MUST).</li><li>Relaxed guidance on processing Creation Time and Expiration Time to only require verifiers to examine them and test against the verifier’s requirements.</li><li>Minor editorial corrections and readability improvements.</li></ul></li><li>-00 <ul><li>Initialized from draft-richanna-http-message-signatures-00, following adoption by the working group.</li></ul></li></ul></li><li>draft-richanna-http-message-signatures <ul><li>-00 <ul><li>Converted to xml2rfc v3 and reformatted to comply with RFC style guides.</li><li>Removed Signature auth-scheme definition and related content.</li><li>Removed conflicting normative requirements for use of algorithm parameter. Now MUST NOT be relied upon.</li><li>Removed Extensions appendix.</li><li>Rewrote abstract and introduction to explain context and need, and challenges inherent in signing HTTP messages.</li><li>Rewrote and heavily expanded algorithm definition, retaining normative requirements.</li><li>Added definitions for key terms, referenced RFC 7230 for HTTP terms.</li><li>Added examples for canonicalization and signature generation steps.</li><li>Rewrote Signature header definition, retaining normative requirements.</li><li>Added default values for algorithm and expires parameters.</li><li>Rewrote HTTP Signature Algorithms registry definition. Added change control policy and registry template. Removed suggested URI.</li><li>Added IANA HTTP Signature Parameter registry.</li><li>Added additional normative and informative references.</li><li>Added Topics for Working Group Discussion section, to be removed prior to publication as an RFC.</li></ul></li></ul></li></ul></div></section><section id="rfc.authors" class="avoidbreakinside"><h2><a href="#rfc.authors">Authors' Addresses</a></h2><address><b>Annabelle Backman</b><br>Amazon<br>P.O. Box 81226<br>Seattle, WA 98108-1226<br>United States of America<br>EMail: <a href="mailto:richanna@amazon.com">richanna@amazon.com</a><br>URI: <a href="https://www.amazon.com/">https://www.amazon.com/</a></address><address><b>Justin Richer</b><br>Bespoke Engineering<br>EMail: <a href="mailto:ietf@justin.richer.org">ietf@justin.richer.org</a><br>URI: <a href="https://bspk.io/">https://bspk.io/</a></address><address><b>Manu Sporny</b><br>Digital Bazaar<br>203 Roanoke Street W.<br>Blacksburg, VA 24060<br>United States of America<br>EMail: <a href="mailto:msporny@digitalbazaar.com">msporny@digitalbazaar.com</a><br>URI: <a href="https://manu.sporny.org/">https://manu.sporny.org/</a></address></section></body></html>
