<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Expect-CT Extension for HTTP</title><script type="application/javascript">
function anchorRewrite() {
  map = { };
  if (window.location.hash.length >= 1) {
    var fragid = window.location.hash.substr(1);
    if (fragid) {
      if (! document.getElementById(fragid)) {
        var prefix = "rfc.";
        var mapped = map[fragid];
        if (mapped) {
          window.location.hash = mapped;
        } else if (fragid.indexOf("section-") == 0) {
          window.location.hash = prefix + "section." + fragid.substring(8);
        } else if (fragid.indexOf("appendix-") == 0) {
          window.location.hash = prefix + "section." + fragid.substring(9);
        } else if (fragid.indexOf("s-") == 0) {
          var postfix = fragid.substring(2);
          if (postfix.startsWith("abstract")) {
            window.location.hash = prefix + postfix;
          } else if (postfix.startsWith("note-")) {
            window.location.hash = prefix + "note." + postfix.substring(5);
          } else {
            window.location.hash = prefix + "section." + postfix;
          }
        } else if (fragid.indexOf("p-") == 0) {
          var r = fragid.substring(2);
          var p = r.indexOf("-");
          if (p >= 0) {
            window.location.hash = prefix + "section." + r.substring(0, p) + ".p." + r.substring(p + 1);
          }
        }
      }
    }  
  }
}
window.addEventListener('hashchange', anchorRewrite);
window.addEventListener('DOMContentLoaded', anchorRewrite);
</script><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css"><style type="text/css">
      body {
        padding-top: 80px;
        padding-bottom: 80px;
        position: relative;
      }
      .table.header th, .table.header td {
        border-top: none;
        padding: 0;
      }
      #rfc\.meta {
        width: 40%;
        float: right
      }
      #rfc\.toc > ul ul {
        list-style: none;
      }
      #sidebar {
        position: fixed;
        height: 90%;
        overflow-y: auto;
        font-size: 90%;
      }
      .container .nav-sublist {
        padding-left: 20px;
        padding-right: 10px;
        font-size: 90%;
      }
      .container .navbar-brand {
        padding-top: 0;
      }
      .container .nav > li > a {
        padding: 10px 7px 5px 15px;
        display: inline-block;
      }
      .container .nav > li > a + a {
        padding: 10px 15px 5px 7px;
        display: inline-block;
      }
      .container .nav > li > a {
        padding: 5px 10px;
      }
      .filename {
        color: rgb(119, 119, 119);
        font-size: 23px;
        font-weight: normal;
        height: auto;
        line-height: 23px;
      }
      dl {
        margin-left: 1em;
      }
      dl.dl-horizontal: {
        margin-left: 0;
      }
      dl > dt {
        float: left;
        margin-right: 1em;
      }
      dl.nohang > dt {
        float: none;
      }
      dl > dd {
        margin-bottom: .5em;
      }
      dl.compact > dd {
        margin-bottom: 0em;
      }
      dl > dd > dl {
        margin-top: 0.5em;
        margin-bottom: 0em;
      }
      ul.empty {
        list-style-type: none;
      }
      ul.empty li {
        margin-top: .5em;
      }
      td.reference {
        padding-right: 1em;
        vertical-align: top;
      }
      .feedback {
        position: fixed;
        bottom: 5px;
        right: 5px;
      }
      .fbbutton {
        margin-left: 5px;
      }
      h1 a, h2 a, h3 a, h4 a, h5 a, h6 a {
        color: rgb(51, 51, 51);
      }
      span.tt {
        font: 11pt consolas, monospace;
        font-size-adjust: none;
      }
    </style><link rel="Author" href="#rfc.authors"><link rel="Copyright" href="#rfc.copyrightnotice"><link rel="Chapter" title="1 Introduction" href="#rfc.section.1"><link rel="Chapter" title="2 Server and Client Behavior" href="#rfc.section.2"><link rel="Chapter" title="3 Reporting Expect-CT Failure" href="#rfc.section.3"><link rel="Chapter" title="4 Security Considerations" href="#rfc.section.4"><link rel="Chapter" title="5 Privacy Considerations" href="#rfc.section.5"><link rel="Chapter" title="6 IANA Considerations" href="#rfc.section.6"><link rel="Chapter" title="7 Usability Considerations" href="#rfc.section.7"><link rel="Chapter" title="8 Authoring Considerations" href="#rfc.section.8"><link rel="Chapter" title="9 Changes" href="#rfc.section.9"><link rel="Chapter" href="#rfc.section.10" title="10 Normative References"><meta name="generator" content="https://github.com/mnot/RFCBootstrap XSLT vendor: SAXON 9.1.0.8 from Saxonica http://www.saxonica.com/"><link rel="schema.dcterms" href="http://purl.org/dc/terms/"><meta name="dcterms.creator" content="Stark, E."><meta name="dcterms.identifier" content="urn:ietf:id:draft-ietf-httpbis-expect-ct-latest"><meta name="dcterms.issued" content="2017-10-23"><meta name="dcterms.abstract" content="This document defines a new HTTP header, named Expect-CT, that allows web host operators to instruct user agents to expect valid Signed Certificate Timestamps (SCTs) to be served on connections to these hosts. When configured in enforcement mode, user agents (UAs) will remember that hosts expect SCTs and will refuse connections that do not conform to the UA’s Certificate Transparency policy. When configured in report-only mode, UAs will report the lack of valid SCTs to a URI configured by the host, but will allow the connection. By turning on Expect-CT, web host operators can discover misconfigurations in their Certificate Transparency deployments and ensure that misissued certificates accepted by UAs are discoverable in Certificate Transparency logs."><meta name="description" content="This document defines a new HTTP header, named Expect-CT, that allows web host operators to instruct user agents to expect valid Signed Certificate Timestamps (SCTs) to be served on connections to these hosts. When configured in enforcement mode, user agents (UAs) will remember that hosts expect SCTs and will refuse connections that do not conform to the UA’s Certificate Transparency policy. When configured in report-only mode, UAs will report the lack of valid SCTs to a URI configured by the host, but will allow the connection. By turning on Expect-CT, web host operators can discover misconfigurations in their Certificate Transparency deployments and ensure that misissued certificates accepted by UAs are discoverable in Certificate Transparency logs."></head><body><div class="container" id="top"><div class="row"><div class="col-md-4 col-md-push-8 hidden-sm hidden-xs" id="sidebar" role="navigation"><div class="navbar"><div class="navbar-brand"><a href="#top">draft-ietf-httpbis-expect-ct-latest</a></div><br clear="all"><div class=""><div id="rfc.toc"><ul class="nav"><li><a href="#rfc.section.1">1.</a>&nbsp;&nbsp;&nbsp;<a href="#introduction">Introduction</a><ul><li><a href="#rfc.section.1.1">1.1.</a>&nbsp;&nbsp;&nbsp;<a href="#requirements-language">Requirements Language</a></li><li><a href="#rfc.section.1.2">1.2.</a>&nbsp;&nbsp;&nbsp;<a href="#terminology">Terminology</a></li></ul></li><li><a href="#rfc.section.2">2.</a>&nbsp;&nbsp;&nbsp;<a href="#server-and-client-behavior">Server and Client Behavior</a><ul><li><a href="#rfc.section.2.1">2.1.</a>&nbsp;&nbsp;&nbsp;<a href="#response-header-field-syntax">Response Header Field Syntax</a><ul><li><a href="#rfc.section.2.1.1">2.1.1.</a>&nbsp;&nbsp;&nbsp;<a href="#the-report-uri-directive">The report-uri Directive</a></li><li><a href="#rfc.section.2.1.2">2.1.2.</a>&nbsp;&nbsp;&nbsp;<a href="#the-enforce-directive">The enforce Directive</a></li><li><a href="#rfc.section.2.1.3">2.1.3.</a>&nbsp;&nbsp;&nbsp;<a href="#the-max-age-directive">The max-age Directive</a></li><li><a href="#rfc.section.2.1.4">2.1.4.</a>&nbsp;&nbsp;&nbsp;<a href="#examples">Examples</a></li></ul></li><li><a href="#rfc.section.2.2">2.2.</a>&nbsp;&nbsp;&nbsp;<a href="#server-processing-model">Server Processing Model</a><ul><li><a href="#rfc.section.2.2.1">2.2.1.</a>&nbsp;&nbsp;&nbsp;<a href="#http-over-secure-transport-request-type">HTTP-over-Secure-Transport Request Type</a></li><li><a href="#rfc.section.2.2.2">2.2.2.</a>&nbsp;&nbsp;&nbsp;<a href="#http-request-type">HTTP Request Type</a></li></ul></li><li><a href="#rfc.section.2.3">2.3.</a>&nbsp;&nbsp;&nbsp;<a href="#user-agent-processing-model">User Agent Processing Model</a><ul><li><a href="#rfc.section.2.3.1">2.3.1.</a>&nbsp;&nbsp;&nbsp;<a href="#expect-ct-header-field-processing">Expect-CT Header Field Processing</a></li><li><a href="#rfc.section.2.3.2">2.3.2.</a>&nbsp;&nbsp;&nbsp;<a href="#http-equiv-meta-element-attribute">HTTP-Equiv &lt;meta&gt; Element Attribute</a></li><li><a href="#rfc.section.2.3.3">2.3.3.</a>&nbsp;&nbsp;&nbsp;<a href="#noting-expect-ct">Noting Expect-CT</a></li><li><a href="#rfc.section.2.3.4">2.3.4.</a>&nbsp;&nbsp;&nbsp;<a href="#storage-model">Storage Model</a></li></ul></li><li><a href="#rfc.section.2.4">2.4.</a>&nbsp;&nbsp;&nbsp;<a href="#expect-ct-compliance">Evaluating Expect-CT Connections for CT Compliance</a></li></ul></li><li><a href="#rfc.section.3">3.</a>&nbsp;&nbsp;&nbsp;<a href="#reporting-expect-ct-failure">Reporting Expect-CT Failure</a><ul><li><a href="#rfc.section.3.1">3.1.</a>&nbsp;&nbsp;&nbsp;<a href="#generating-a-violation-report">Generating a violation report</a></li><li><a href="#rfc.section.3.2">3.2.</a>&nbsp;&nbsp;&nbsp;<a href="#sending-a-violation-report">Sending a violation report</a></li></ul></li><li><a href="#rfc.section.4">4.</a>&nbsp;&nbsp;&nbsp;<a href="#security-considerations">Security Considerations</a><ul><li><a href="#rfc.section.4.1">4.1.</a>&nbsp;&nbsp;&nbsp;<a href="#maximum-max-age">Maximum max-age</a></li><li><a href="#rfc.section.4.2">4.2.</a>&nbsp;&nbsp;&nbsp;<a href="#avoiding-amplification-attacks">Avoiding amplification attacks</a></li></ul></li><li><a href="#rfc.section.5">5.</a>&nbsp;&nbsp;&nbsp;<a href="#privacy-considerations">Privacy Considerations</a></li><li><a href="#rfc.section.6">6.</a>&nbsp;&nbsp;&nbsp;<a href="#iana-considerations">IANA Considerations</a></li><li><a href="#rfc.section.7">7.</a>&nbsp;&nbsp;&nbsp;<a href="#usability-considerations">Usability Considerations</a></li><li><a href="#rfc.section.8">8.</a>&nbsp;&nbsp;&nbsp;<a href="#authoring-considerations">Authoring Considerations</a><ul><li><a href="#rfc.section.8.1">8.1.</a>&nbsp;&nbsp;&nbsp;<a href="#http-header">HTTP Header</a></li></ul></li><li><a href="#rfc.section.9">9.</a>&nbsp;&nbsp;&nbsp;<a href="#changes">Changes</a><ul><li><a href="#rfc.section.9.1">9.1.</a>&nbsp;&nbsp;&nbsp;<a href="#since-01">Since -01</a></li><li><a href="#rfc.section.9.2">9.2.</a>&nbsp;&nbsp;&nbsp;<a href="#since-00">Since -00</a></li></ul></li><li><a href="#rfc.section.10">10.</a>&nbsp;&nbsp;&nbsp;<a href="#rfc.references">Normative References</a></li><li><a href="#rfc.authors">Author's Address</a></li></ul></div></div></div></div><div class="col-md-8 main" role="main"><header><table class="table table-condensed header" id="rfc.headerblock"><tbody><tr><td class="text-left">HTTP Working Group</td><td class="text-right">E. Stark</td></tr><tr><td class="text-left">Internet-Draft</td><td class="text-right">Google</td></tr><tr><td class="text-left">Intended status: Experimental</td><td class="text-right">October 23, 2017</td></tr><tr><td class="text-left">Expires: April 26, 2018</td><td class="text-right"></td></tr></tbody></table><div id="rfc.title"><h1>Expect-CT Extension for HTTP</h1><div class="filename">draft-ietf-httpbis-expect-ct-latest</div></div></header><hr><h2 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h2><div class="lead"><div id="rfc.abstract.p.1"><p>This document defines a new HTTP header, named Expect-CT, that allows web host operators to instruct user agents to expect valid Signed Certificate Timestamps (SCTs) to be served on connections to these hosts. When configured in enforcement mode, user agents (UAs) will remember that hosts expect SCTs and will refuse connections that do not conform to the UA’s Certificate Transparency policy. When configured in report-only mode, UAs will report the lack of valid SCTs to a URI configured by the host, but will allow the connection. By turning on Expect-CT, web host operators can discover misconfigurations in their Certificate Transparency deployments and ensure that misissued certificates accepted by UAs are discoverable in Certificate Transparency logs.</p></div></div><section id="rfc.note.1" class="note"><h2><a href="#rfc.note.1">Note to Readers</a></h2><div id="rfc.note.1.p.1"><p>Discussion of this draft takes place on the HTTP working group mailing list (ietf-http-wg@w3.org), which is archived at <a href="https://lists.w3.org/Archives/Public/ietf-http-wg/">https://lists.w3.org/Archives/Public/ietf-http-wg/</a>.</p></div><div id="rfc.note.1.p.2"><p>Working Group information can be found at <a href="http://httpwg.github.io/">http://httpwg.github.io/</a>; source code and issues list for this draft can be found at <a href="https://github.com/httpwg/http-extensions/labels/expect-ct">https://github.com/httpwg/http-extensions/labels/expect-ct</a>.</p></div></section><section id="rfc.status"><h2><a href="#rfc.status">Status of this Memo</a></h2><div id="rfc.boilerplate.1.p.1"><p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p></div><div id="rfc.boilerplate.1.p.2"><p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF). Note that other groups may also distribute working documents as Internet-Drafts. The list of current Internet-Drafts is at <a href="http://datatracker.ietf.org/drafts/current/">http://datatracker.ietf.org/drafts/current/</a>.</p></div><div id="rfc.boilerplate.1.p.3"><p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time. It is inappropriate to use Internet-Drafts as reference material or to cite them other than as “work in progress”.</p></div><div id="rfc.boilerplate.1.p.4"><p>This Internet-Draft will expire on April 26, 2018.</p></div></section><section id="rfc.copyrightnotice"><h2><a href="#rfc.copyrightnotice">Copyright Notice</a></h2><div id="rfc.boilerplate.2.p.1"><p>Copyright © 2017 IETF Trust and the persons identified as the document authors. All rights reserved.</p></div><div id="rfc.boilerplate.2.p.2"><p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of publication of this document. Please review these documents carefully, as they describe your rights and restrictions with respect to this document. Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p></div></section><hr class="hidden-print"><section id="introduction"><h2 id="rfc.section.1" class="np"><a href="#rfc.section.1">1.</a>&nbsp;<a href="#introduction">Introduction</a></h2><div id="rfc.section.1.p.1"><p>This document defines a new HTTP header that enables UAs to identify web hosts that expect the presence of Signed Certificate Timestamps (SCTs) <a href="#I-D.ietf-trans-rfc6962-bis"><cite title="Certificate Transparency Version 2.0">[I-D.ietf-trans-rfc6962-bis]</cite></a> in future Transport Layer Security (TLS) <a href="#RFC5246"><cite title="The Transport Layer Security (TLS) Protocol Version 1.2">[RFC5246]</cite></a> connections.</p></div><div id="rfc.section.1.p.2"><p>Web hosts that serve the Expect-CT HTTP header are noted by the UA as Known Expect-CT Hosts. The UA evaluates each connection to a Known Expect-CT Host for compliance with the UA’s Certificate Transparency (CT) Policy. If the connection violates the CT Policy, the UA sends a report to a URI configured by the Expect-CT Host and/or fails the connection, depending on the configuration that the Expect-CT Host has chosen.</p></div><div id="rfc.section.1.p.3"><p>If misconfigured, Expect-CT can cause unwanted connection failures (for example, if a host deploys Expect-CT but then switches to a legitimate certificate that is not logged in Certificate Transparency logs, or if a web host operator believes their certificate to conform to all UAs’ CT policies but is mistaken). Web host operators are advised to deploy Expect-CT with caution, by using the reporting feature and gradually increasing the interval where the UA remembers the host as a Known Expect-CT Host. These precautions can help web host operators gain confidence that their Expect-CT deployment is not causing unwanted connection failures.</p></div><div id="rfc.section.1.p.4"><p>Expect-CT is a trust-on-first-use (TOFU) mechanism. The first time a UA connects to a host, it lacks the information necessary to require SCTs for the connection. Thus, the UA will not be able to detect and thwart an attack on the UA’s first connection to the host. Still, Expect-CT provides value by 1) allowing UAs to detect the use of unlogged certificates after the initial communication, and 2) allowing web hosts to be confident that UAs are only trusting publicly-auditable certificates.</p></div><section id="requirements-language"><h3 id="rfc.section.1.1"><a href="#rfc.section.1.1">1.1.</a>&nbsp;<a href="#requirements-language">Requirements Language</a></h3><div id="rfc.section.1.1.p.1"><p>The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “NOT RECOMMENDED”, “MAY”, and “OPTIONAL” in this document are to be interpreted as described in RFC 2119 <a href="#RFC2119"><cite title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</cite></a>.</p></div></section><section id="terminology"><h3 id="rfc.section.1.2"><a href="#rfc.section.1.2">1.2.</a>&nbsp;<a href="#terminology">Terminology</a></h3><div id="rfc.section.1.2.p.1"><p>Terminology is defined in this section.</p></div><div id="rfc.section.1.2.p.2"><dl><dt>Certificate Transparency Policy</dt><dd>is a policy defined by the UA concerning the number, sources, and delivery mechanisms of Signed Certificate Timestamps that are served on TLS connections. The policy defines the properties of a connection that must be met in order for the UA to consider it CT-qualified.</dd><dt>Certificate Transparency Qualified</dt><dd>describes a TLS connection for which the UA has determined that a sufficient quantity and quality of Signed Certificate Timestamps have been provided.</dd><dt>CT-qualified</dt><dd>See Certificate Transparency Qualified.</dd><dt>CT Policy</dt><dd>See Certificate Transparency Policy.</dd><dt>Effective Expect-CT Date</dt><dd>is the time at which a UA observed a valid Expect-CT header for a given host.</dd><dt>Expect-CT Host</dt><dd>See HTTP Expect-CT Host.</dd><dt>HTTP Expect-CT</dt><dd>is the overall name for the combined UA- and server-side security policy defined by this specification.</dd><dt>HTTP Expect-CT Host</dt><dd>is a conformant host implementing the HTTP server aspects of HTTP Expect-CT. This means that an Expect-CT Host returns the “Expect-CT” HTTP response header field in its HTTP response messages sent over secure transport.</dd><dt>Known Expect-CT Host</dt><dd>is an Expect-CT Host that the UA has noted as such. See <a href="#noting-expect-ct" title="Noting Expect-CT">Section&nbsp;2.3.3</a> for particulars.</dd><dt>UA</dt><dd>is an acronym for “user agent”. For the purposes of this specification, a UA is an HTTP client application typically actively manipulated by a user <a href="#RFC7230"><cite title="Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing">[RFC7230]</cite></a>.</dd><dt>Unknown Expect-CT Host</dt><dd>is an Expect-CT Host that the UA has not noted.</dd></dl></div></section></section><hr class="hidden-print"><section id="server-and-client-behavior"><h2 id="rfc.section.2" class="np"><a href="#rfc.section.2">2.</a>&nbsp;<a href="#server-and-client-behavior">Server and Client Behavior</a></h2><section id="response-header-field-syntax"><h3 id="rfc.section.2.1"><a href="#rfc.section.2.1">2.1.</a>&nbsp;<a href="#response-header-field-syntax">Response Header Field Syntax</a></h3><div id="rfc.section.2.1.p.1"><p>The “Expect-CT” header field is a new response header defined in this specification. It is used by a server to indicate that UAs should evaluate connections to the host emitting the header for CT compliance (<a href="#expect-ct-compliance" title="Evaluating Expect-CT Connections for CT Compliance">Section&nbsp;2.4</a>).</p></div><div id="rfc.section.2.1.p.2"><p><a href="#expect-ct-syntax">Figure&nbsp;1</a> describes the syntax (Augmented Backus-Naur Form) of the header field, using the grammar defined in <a href="#RFC5234"><cite title="Augmented BNF for Syntax Specifications: ABNF">[RFC5234]</cite></a> and the rules defined in Section 3.2 of <a href="#RFC7230"><cite title="Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing">[RFC7230]</cite></a>.</p></div><div id="expect-ct-syntax"></div><div id="rfc.figure.1"><pre class="inline">
Expect-CT           = #expect-ct-directive
expect-ct-directive = directive-name [ "=" directive-value ]
directive-name      = token
directive-value     = token / quoted-string
</pre></div><p class="figure">Figure 1: Syntax of the Expect-CT header field</p><div id="rfc.section.2.1.p.3"><p>Optional white space (<span class="tt">OWS</span>) is used as defined in Section 3.2.3 of <a href="#RFC7230"><cite title="Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing">[RFC7230]</cite></a>. <span class="tt">token</span> and <span class="tt">quoted-string</span> are used as defined in Section 3.2.6 of <a href="#RFC7230"><cite title="Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing">[RFC7230]</cite></a>.</p></div><div id="rfc.section.2.1.p.4" class="avoidbreakafter"><p>The directives defined in this specification are described below. The overall requirements for directives are:</p></div><div id="rfc.section.2.1.p.5"><ol><li>The order of appearance of directives is not significant.</li><li>A given directive MUST NOT appear more than once in a given header field. Directives are either optional or required, as stipulated in their definitions.</li><li>Directive names are case insensitive.</li><li>UAs MUST ignore any header fields containing directives, or other header field value data, that do not conform to the syntax defined in this specification. In particular, UAs must not attempt to fix malformed header fields.</li><li>If a header field contains any directive(s) the UA does not recognize, the UA MUST ignore those directives.</li><li>If the Expect-CT header field otherwise satisfies the above requirements (1 through 5), the UA MUST process the directives it recognizes.</li></ol></div><section id="the-report-uri-directive"><h4 id="rfc.section.2.1.1"><a href="#rfc.section.2.1.1">2.1.1.</a>&nbsp;<a href="#the-report-uri-directive">The report-uri Directive</a></h4><div id="rfc.section.2.1.1.p.1"><p>The OPTIONAL <span class="tt">report-uri</span> directive indicates the URI to which the UA SHOULD report Expect-CT failures (<a href="#expect-ct-compliance" title="Evaluating Expect-CT Connections for CT Compliance">Section&nbsp;2.4</a>). The UA POSTs the reports to the given URI as described in <a href="#reporting-expect-ct-failure" title="Reporting Expect-CT Failure">Section&nbsp;3</a>.</p></div><div id="rfc.section.2.1.1.p.2"><p>The <span class="tt">report-uri</span> directive is REQUIRED to have a directive value, for which the syntax is defined in <a href="#reporturi-syntax">Figure&nbsp;2</a>.</p></div><div id="reporturi-syntax"></div><div id="rfc.figure.2"><pre class="inline">
report-uri-value = absolute-URI
</pre></div><p class="figure">Figure 2: Syntax of the report-uri directive value</p><div id="rfc.section.2.1.1.p.3"><p><span class="tt">absolute-URI</span> is defined in Section 4.3 of <a href="#RFC3986"><cite title="Uniform Resource Identifier (URI): Generic Syntax">[RFC3986]</cite></a>.</p></div><div id="rfc.section.2.1.1.p.4"><p>Hosts may set <span class="tt">report-uri</span>s that use HTTP or HTTPS. If the scheme in the <span class="tt">report-uri</span> is one that uses TLS (e.g., HTTPS), UAs MUST check Expect-CT compliance when the host in the <span class="tt">report-uri</span> is a Known Expect-CT Host; similarly, UAs MUST apply HSTS if the host in the <span class="tt">report-uri</span> is a Known HSTS Host.</p></div><div id="rfc.section.2.1.1.p.5"><p>Note that the report-uri need not necessarily be in the same Internet domain or web origin as the host being reported about.</p></div><div id="rfc.section.2.1.1.p.6"><p>UAs SHOULD make their best effort to report Expect-CT failures to the <span class="tt">report-uri</span>, but they may fail to report in exceptional conditions. For example, if connecting the <span class="tt">report-uri</span> itself incurs an Expect-CT failure or other certificate validation failure, the UA MUST cancel the connection. Similarly, if Expect-CT Host A sets a <span class="tt">report-uri</span> referring to Expect-CT Host B, and if B sets a <span class="tt">report-uri</span> referring to A, and if both hosts fail to comply to the UA’s CT Policy, the UA SHOULD detect and break the loop by failing to send reports to and about those hosts.</p></div><div id="rfc.section.2.1.1.p.7"><p>UAs SHOULD limit the rate at which they send reports. For example, it is unnecessary to send the same report to the same <span class="tt">report-uri</span> more than once.</p></div></section><section id="the-enforce-directive"><h4 id="rfc.section.2.1.2"><a href="#rfc.section.2.1.2">2.1.2.</a>&nbsp;<a href="#the-enforce-directive">The enforce Directive</a></h4><div id="rfc.section.2.1.2.p.1"><p>The OPTIONAL <span class="tt">enforce</span> directive is a valueless directive that, if present (i.e., it is “asserted”), signals to the UA that compliance to the CT Policy should be enforced (rather than report-only) and that the UA should refuse future connections that violate its CT Policy. When both the <span class="tt">enforce</span> directive and <span class="tt">report-uri</span> directive (as defined in <a href="#reporturi-syntax">Figure&nbsp;2</a>) are present, the configuration is referred to as an “enforce-and-report” configuration, signalling to the UA both that compliance to the CT Policy should be enforced and that violations should be reported.</p></div></section><section id="the-max-age-directive"><h4 id="rfc.section.2.1.3"><a href="#rfc.section.2.1.3">2.1.3.</a>&nbsp;<a href="#the-max-age-directive">The max-age Directive</a></h4><div id="rfc.section.2.1.3.p.1"><p>The <span class="tt">max-age</span> directive specifies the number of seconds after the reception of the Expect-CT header field during which the UA SHOULD regard the host from whom the message was received as a Known Expect-CT Host.</p></div><div id="rfc.section.2.1.3.p.2"><p>The <span class="tt">max-age</span> directive is REQUIRED to be present within an “Expect-CT” header field. The <span class="tt">max-age</span> directive is REQUIRED to have a directive value, for which the syntax (after quoted-string unescaping, if necessary) is defined in <a href="#maxage-syntax">Figure&nbsp;3</a>.</p></div><div id="maxage-syntax"></div><div id="rfc.figure.3"><pre class="inline">
max-age-value = delta-seconds
delta-seconds = 1*DIGIT
</pre></div><p class="figure">Figure 3: Syntax of the max-age directive value</p><div id="rfc.section.2.1.3.p.3"><p><span class="tt">delta-seconds</span> is used as defined in Section 1.2.1 of <a href="#RFC7234"><cite title="Hypertext Transfer Protocol (HTTP/1.1): Caching">[RFC7234]</cite></a>.</p></div></section><section id="examples"><h4 id="rfc.section.2.1.4"><a href="#rfc.section.2.1.4">2.1.4.</a>&nbsp;<a href="#examples">Examples</a></h4><div id="rfc.section.2.1.4.p.1" class="avoidbreakafter"><p>The following examples demonstrate valid Expect-CT response header fields:</p></div><div id="example-header-fields"></div><div id="rfc.figure.4"><pre class="inline">
Expect-CT: max-age=86400,enforce

Expect-CT: max-age=86400, enforce, report-uri="https://foo.example/report"

Expect-CT: max-age=86400,report-uri="https://foo.example/report"
</pre></div><p class="figure">Figure 4: Examples of valid Expect-CT response header fields</p></section></section><section id="server-processing-model"><h3 id="rfc.section.2.2"><a href="#rfc.section.2.2">2.2.</a>&nbsp;<a href="#server-processing-model">Server Processing Model</a></h3><div id="rfc.section.2.2.p.1"><p>This section describes the processing model that Expect-CT Hosts implement. The model has 2 parts: (1) the processing rules for HTTP request messages received over a secure transport (e.g., authenticated, non-anonymous TLS); and (2) the processing rules for HTTP request messages received over non-secure transports, such as TCP.</p></div><section id="http-over-secure-transport-request-type"><h4 id="rfc.section.2.2.1"><a href="#rfc.section.2.2.1">2.2.1.</a>&nbsp;<a href="#http-over-secure-transport-request-type">HTTP-over-Secure-Transport Request Type</a></h4><div id="rfc.section.2.2.1.p.1"><p>When replying to an HTTP request that was conveyed over a secure transport, an Expect-CT Host SHOULD include in its response exactly one Expect-CT header field. The header field MUST satisfy the grammar specified in <a href="#response-header-field-syntax" title="Response Header Field Syntax">Section&nbsp;2.1</a>.</p></div><div id="rfc.section.2.2.1.p.2" class="avoidbreakafter"><p>Establishing a given host as an Expect-CT Host, in the context of a given UA, is accomplished as follows:</p></div><div id="rfc.section.2.2.1.p.3"><ol><li>Over the HTTP protocol running over secure transport, by correctly returning (per this specification) at least one valid Expect-CT header field to the UA.</li><li>Through other mechanisms, such as a client-side preloaded Expect-CT Host list.</li></ol></div></section><section id="http-request-type"><h4 id="rfc.section.2.2.2"><a href="#rfc.section.2.2.2">2.2.2.</a>&nbsp;<a href="#http-request-type">HTTP Request Type</a></h4><div id="rfc.section.2.2.2.p.1"><p>Expect-CT Hosts SHOULD NOT include the Expect-CT header field in HTTP responses conveyed over non-secure transport. UAs MUST ignore any Expect-CT header received in an HTTP response conveyed over non-secure transport.</p></div></section></section><section id="user-agent-processing-model"><h3 id="rfc.section.2.3"><a href="#rfc.section.2.3">2.3.</a>&nbsp;<a href="#user-agent-processing-model">User Agent Processing Model</a></h3><div id="rfc.section.2.3.p.1"><p>The UA processing model relies on parsing domain names. Note that internationalized domain names SHALL be canonicalized according to the scheme in Section 10 of <a href="#RFC6797"><cite title="HTTP Strict Transport Security (HSTS)">[RFC6797]</cite></a>.</p></div><section id="expect-ct-header-field-processing"><h4 id="rfc.section.2.3.1"><a href="#rfc.section.2.3.1">2.3.1.</a>&nbsp;<a href="#expect-ct-header-field-processing">Expect-CT Header Field Processing</a></h4><div id="rfc.section.2.3.1.p.1"><p>If the UA receives, over a secure transport, an HTTP response that includes an Expect-CT header field conforming to the grammar specified in <a href="#response-header-field-syntax" title="Response Header Field Syntax">Section&nbsp;2.1</a>, the UA MUST evaluate the connection on which the header was received for compliance with the UA’s CT Policy, and then process the Expect-CT header field as follows.</p></div><div id="rfc.section.2.3.1.p.2" class="avoidbreakafter"><p>If the connection complies with the UA’s CT Policy (i.e. the connection is CT-qualified), then the UA MUST either:</p></div><div id="rfc.section.2.3.1.p.3"><ul><li>Note the host as a Known Expect-CT Host if it is not already so noted (see <a href="#noting-expect-ct" title="Noting Expect-CT">Section&nbsp;2.3.3</a>), or</li><li>Update the UA’s cached information for the Known Expect-CT Host if the <span class="tt">enforce</span>, <span class="tt">max-age</span>, or <span class="tt">report-uri</span> header field value directives convey information different from that already maintained by the UA. If the <span class="tt">max-age</span> directive has a value of 0, the UA MUST remove its cached Expect-CT information if the host was previously noted as a Known Expect-CT Host, and MUST NOT note this host as a Known Expect-CT Host if it is not already noted.</li></ul></div><div id="rfc.section.2.3.1.p.4"><p>If the connection does not comply with the UA’s CT Policy (i.e. is not CT-qualified), then the UA MUST NOT note this host as a Known Expect-CT Host.</p></div><div id="rfc.section.2.3.1.p.5"><p>If the header field includes a <span class="tt">report-uri</span> directive, and the connection does not comply with the UA’s CT Policy (i.e. the connection is not CT-qualified), and the UA has not already sent an Expect-CT report for this connection, then the UA SHOULD send a report to the specified <span class="tt">report-uri</span> as specified in <a href="#reporting-expect-ct-failure" title="Reporting Expect-CT Failure">Section&nbsp;3</a>.</p></div><div id="rfc.section.2.3.1.p.6"><p>The UA MUST ignore any Expect-CT header field not conforming to the grammar specified in <a href="#response-header-field-syntax" title="Response Header Field Syntax">Section&nbsp;2.1</a>.</p></div></section><section id="http-equiv-meta-element-attribute"><h4 id="rfc.section.2.3.2"><a href="#rfc.section.2.3.2">2.3.2.</a>&nbsp;<a href="#http-equiv-meta-element-attribute">HTTP-Equiv &lt;meta&gt; Element Attribute</a></h4><div id="rfc.section.2.3.2.p.1"><p>UAs MUST NOT heed <span class="tt">http-equiv="Expect-CT"</span> attribute settings on <span class="tt">&lt;meta&gt;</span> elements <a href="#W3C.REC-html51-20161101"><cite title="HTML 5.1">[W3C.REC-html51-20161101]</cite></a> in received content.</p></div></section><section id="noting-expect-ct"><h4 id="rfc.section.2.3.3"><a href="#rfc.section.2.3.3">2.3.3.</a>&nbsp;<a href="#noting-expect-ct">Noting Expect-CT</a></h4><div id="rfc.section.2.3.3.p.1"><p>Upon receipt of the Expect-CT response header field over an error-free TLS connection (including the validation adding in <a href="#expect-ct-compliance" title="Evaluating Expect-CT Connections for CT Compliance">Section&nbsp;2.4</a>), the UA MUST note the host as a Known Expect-CT Host, storing the host’s domain name and its associated Expect-CT directives in non-volatile storage. The domain name and associated Expect-CT directives are collectively known as “Expect-CT metadata”.</p></div><div id="rfc.section.2.3.3.p.2"><p>To note a host as a Known Expect-CT Host, the UA MUST set its Expect-CT metadata given in the most recently received valid Expect-CT header, as specified in <a href="#storage-model" title="Storage Model">Section&nbsp;2.3.4</a>.</p></div><div id="rfc.section.2.3.3.p.3"><p>For forward compatibility, the UA MUST ignore any unrecognized Expect-CT header directives, while still processing those directives it does recognize. <a href="#response-header-field-syntax" title="Response Header Field Syntax">Section&nbsp;2.1</a> specifies the directives <span class="tt">enforce</span>, <span class="tt">max-age</span>, and <span class="tt">report-uri</span>, but future specifications and implementations might use additional directives.</p></div></section><section id="storage-model"><h4 id="rfc.section.2.3.4"><a href="#rfc.section.2.3.4">2.3.4.</a>&nbsp;<a href="#storage-model">Storage Model</a></h4><div id="rfc.section.2.3.4.p.1"><p>Known Expect-CT Hosts are identified only by domain names, and never IP addresses. If the substring matching the host production from the Request-URI (of the message to which the host responded) syntactically matches the IP-literal or IPv4address productions from Section 3.2.2 of <a href="#RFC3986"><cite title="Uniform Resource Identifier (URI): Generic Syntax">[RFC3986]</cite></a>, then the UA MUST NOT note this host as a Known Expect-CT Host.</p></div><div id="rfc.section.2.3.4.p.2" class="avoidbreakafter"><p>Otherwise, if the substring does not congruently match an existing Known Expect-CT Host’s domain name, per the matching procedure specified in Section 8.2 of <a href="#RFC6797"><cite title="HTTP Strict Transport Security (HSTS)">[RFC6797]</cite></a>, then the UA MUST add this host to the Known Expect-CT Host cache. The UA caches:</p></div><div id="rfc.section.2.3.4.p.3"><ul><li>the Expect-CT Host’s domain name,</li><li>whether the <span class="tt">enforce</span> directive is present</li><li>the Effective Expiration Date, which is the Effective Expect-CT Date plus the value of the <span class="tt">max-age</span> directive. Alternatively, the UA MAY cache enough information to calculate the Effective Expiration Date.</li><li>the value of the <span class="tt">report-uri</span> directive, if present.</li></ul></div><div id="rfc.section.2.3.4.p.4"><p>If any other metadata from optional or future Expect-CT header directives are present in the Expect-CT header, and the UA understands them, the UA MAY note them as well.</p></div><div id="rfc.section.2.3.4.p.5"><p>UAs MAY set an upper limit on the value of max-age, so that UAs that have noted erroneous Expect-CT hosts (whether by accident or due to attack) have some chance of recovering over time. If the server sets a max-age greater than the UA’s upper limit, the UA MAY behave as if the server set the max-age to the UA’s upper limit. For example, if the UA caps max-age at 5,184,000 seconds (60 days), and an Expect-CT Host sets a max- age directive of 90 days in its Expect-CT header, the UA MAY behave as if the max-age were effectively 60 days. (One way to achieve this behavior is for the UA to simply store a value of 60 days instead of the 90-day value provided by the Expect-CT host.)</p></div></section></section><section id="expect-ct-compliance"><h3 id="rfc.section.2.4"><a href="#rfc.section.2.4">2.4.</a>&nbsp;<a href="#expect-ct-compliance">Evaluating Expect-CT Connections for CT Compliance</a></h3><div id="rfc.section.2.4.p.1"><p>When a UA connects to a Known Expect-CT Host using a TLS connection, if the TLS connection has errors, the UA MUST terminate the connection without allowing the user to proceed anyway. (This behavior is the same as that required by <a href="#RFC6797"><cite title="HTTP Strict Transport Security (HSTS)">[RFC6797]</cite></a>.)</p></div><div id="rfc.section.2.4.p.2"><p>If the connection has no errors, then the UA will apply an additional correctness check: compliance with a CT Policy. A UA should evaluate compliance with its CT Policy whenever connecting to a Known Expect-CT Host, as soon as possible. It is acceptable to skip this CT compliance check for some hosts according to local policy. For example, a UA may disable CT compliance checks for hosts whose validated certificate chain terminates at a user-defined trust anchor, rather than a trust anchor built-in to the UA (or underlying platform).</p></div><div id="rfc.section.2.4.p.3"><p>An Expect-CT Host is “expired” if the effective expiration date refers to a date in the past. The UA MUST ignore any expired Expect-CT Hosts in its cache and not treat such hosts as Known Expect-CT hosts.</p></div><div id="rfc.section.2.4.p.4"><p>If a connection to a Known CT Host violates the UA’s CT policy (i.e. the connection is not CT-qualified), and if the Known Expect-CT Host’s Expect-CT metadata indicates an <span class="tt">enforce</span> configuration, the UA MUST treat the CT compliance failure as a non-recoverable error.</p></div><div id="rfc.section.2.4.p.5"><p>If a connection to a Known CT Host violates the UA’s CT policy, and if the Known Expect-CT Host’s Expect-CT metadata includes a <span class="tt">report-uri</span>, the UA SHOULD send an Expect-CT report to that <span class="tt">report-uri</span> (<a href="#reporting-expect-ct-failure" title="Reporting Expect-CT Failure">Section&nbsp;3</a>).</p></div><div id="rfc.section.2.4.p.6"><p>A UA that has previously noted a host as a Known Expect-CT Host MUST evaluate CT compliance when setting up the TLS session, before beginning an HTTP conversation over the TLS channel.</p></div><div id="rfc.section.2.4.p.7"><p>If the UA does not evaluate CT compliance, e.g. because the user has elected to disable it, or because a presented certificate chain chains up to a user-defined trust anchor, UAs SHOULD NOT send Expect-CT reports.</p></div></section></section><hr class="hidden-print"><section id="reporting-expect-ct-failure"><h2 id="rfc.section.3" class="np"><a href="#rfc.section.3">3.</a>&nbsp;<a href="#reporting-expect-ct-failure">Reporting Expect-CT Failure</a></h2><div id="rfc.section.3.p.1"><p>When the UA attempts to connect to a Known Expect-CT Host and the connection is not CT-qualified, the UA SHOULD report Expect-CT failures to the <span class="tt">report-uri</span>, if any, in the Known Expect-CT Host’s Expect-CT metadata.</p></div><div id="rfc.section.3.p.2"><p>When the UA receives an Expect-CT response header field over a connection that is not CT-qualified, if the UA has not already sent an Expect-CT report for this connection, then the UA SHOULD report Expect-CT failures to the configured <span class="tt">report-uri</span>, if any.</p></div><section id="generating-a-violation-report"><h3 id="rfc.section.3.1"><a href="#rfc.section.3.1">3.1.</a>&nbsp;<a href="#generating-a-violation-report">Generating a violation report</a></h3><div id="rfc.section.3.1.p.1" class="avoidbreakafter"><p>To generate a violation report object, the UA constructs a JSON object with the following keys and values:</p></div><div id="rfc.section.3.1.p.2"><ul><li>“date-time”: the value for this key indicates the time the UA observed the CT compliance failure. The value is a string formatted according to Section 5.6, “Internet Date/Time Format”, of <a href="#RFC3339"><cite title="Date and Time on the Internet: Timestamps">[RFC3339]</cite></a>.</li><li>“hostname”: the value is the hostname to which the UA made the original request that failed the CT compliance check. The value is provided as a string.</li><li>“port”: the value is the port to which the UA made the original request that failed the CT compliance check. The value is provided as an integer.</li><li>“effective-expiration-date”: the value indicates the Effective Expiration Date (see <a href="#storage-model" title="Storage Model">Section&nbsp;2.3.4</a>) for the Expect-CT Host that failed the CT compliance check. The value is provided as a string formatted according to Section 5.6 of <a href="#RFC3339"><cite title="Date and Time on the Internet: Timestamps">[RFC3339]</cite></a> (“Internet Date/Time Format”).</li><li>“served-certificate-chain”: the value is the certificate chain as served by the Expect-CT Host during TLS session setup. The value is provided as an array of strings, which MUST appear in the order that the certificates were served; each string in the array is the Privacy-Enhanced Mail (PEM) representation of each X.509 certificate as described in <a href="#RFC7468"><cite title="Textual Encodings of PKIX, PKCS, and CMS Structures">[RFC7468]</cite></a>.</li><li>“validated-certificate-chain”: the value is the certificate chain as constructed by the UA during certificate chain verification. (This may differ from the value of the “served-certificate-chain” key.) The value is provided as an array of strings, which MUST appear in the order matching the chain that the UA validated; each string in the array is the Privacy-Enhanced Mail (PEM) representation of each X.509 certificate as described in <a href="#RFC7468"><cite title="Textual Encodings of PKIX, PKCS, and CMS Structures">[RFC7468]</cite></a>.</li><li>“scts”: the value represents the SCTs (if any) that the UA received for the Expect-CT host and their validation statuses. The value is provided as an array of JSON objects. The SCTs may appear in any order. Each JSON object in the array has the following keys: <ul><li>A “version” key, with an integer value. The UA MUST set this value to <span class="tt">1</span> if the SCT is in the format defined in Section 3.2 of <a href="#RFC6962"><cite title="Certificate Transparency">[RFC6962]</cite></a> and <span class="tt">2</span> if it is in the format defined in Section 4.6 of <a href="#I-D.ietf-trans-rfc6962-bis"><cite title="Certificate Transparency Version 2.0">[I-D.ietf-trans-rfc6962-bis]</cite></a>.</li><li>The “status” key, with a string value that the UA MUST set to one of the following values: “unknown” (indicating that the UA does not have or does not trust the public key of the log from which the SCT was issued), “valid” (indicating that the UA successfully validated the SCT as described in Section 5.2 of <a href="#RFC6962"><cite title="Certificate Transparency">[RFC6962]</cite></a> or Section 8.2.3 of <a href="#I-D.ietf-trans-rfc6962-bis"><cite title="Certificate Transparency Version 2.0">[I-D.ietf-trans-rfc6962-bis]</cite></a>), or “invalid” (indicating that the SCT validation failed because of, e.g., a bad signature).</li><li>The “source” key, with a string value that indicates from where the UA obtained the SCT, as defined in Section 3 or <a href="#RFC6962"><cite title="Certificate Transparency">[RFC6962]</cite></a> and Section 6 of <a href="#I-D.ietf-trans-rfc6962-bis"><cite title="Certificate Transparency Version 2.0">[I-D.ietf-trans-rfc6962-bis]</cite></a>. The UA MUST set the value to one of “tls-extension”, “ocsp”, or “embedded”.</li><li>The “serialized_sct” key, with a string value. If the value of the “version” key is <span class="tt">1</span>, the UA MUST set this value to the base64 encoded <a href="#RFC4648"><cite title="The Base16, Base32, and Base64 Data Encodings">[RFC4648]</cite></a> serialized <span class="tt">SignedCertificateTimestamp</span> structure from Section 3.2 of <a href="#RFC6962"><cite title="Certificate Transparency">[RFC6962]</cite></a>. If the value of the “version” key is <span class="tt">2</span>, the UA MUST set this value to the base64 encoded <a href="#RFC4648"><cite title="The Base16, Base32, and Base64 Data Encodings">[RFC4648]</cite></a> serialized <span class="tt">TransItem</span> structure representing the SCT, as defined in Section 4.6 of <a href="#I-D.ietf-trans-rfc6962-bis"><cite title="Certificate Transparency Version 2.0">[I-D.ietf-trans-rfc6962-bis]</cite></a>.</li></ul></li></ul></div></section><section id="sending-a-violation-report"><h3 id="rfc.section.3.2"><a href="#rfc.section.3.2">3.2.</a>&nbsp;<a href="#sending-a-violation-report">Sending a violation report</a></h3><div id="rfc.section.3.2.p.1"><p>The UA SHOULD report an Expect-CT failure when a connection to a Known Expect-CT Host does not comply with the UA’s CT Policy and the host’s Expect-CT metadata contains a <span class="tt">report-uri</span>. Additionally, the UA SHOULD report an Expect-CT failure when it receives an Expect-CT header field which contains the <span class="tt">report-uri</span> directive over a connection that does not comply with the UA’s CT Policy.</p></div><div id="rfc.section.3.2.p.2"><p>The steps to report an Expect-CT failure are as follows.</p></div><div id="rfc.section.3.2.p.3"><ol><li>Prepare a JSON object <span class="tt">report object</span> with the single key <span class="tt">expect-ct-report</span>, whose value is the result of generating a violation report object as described in <a href="#generating-a-violation-report" title="Generating a violation report">Section&nbsp;3.1</a>.</li><li>Let <span class="tt">report body</span> by the JSON stringification of <span class="tt">report object</span>.</li><li>Let <span class="tt">report-uri</span> be the value of the <span class="tt">report-uri</span> directive in the Expect-CT header field.</li><li>Send an HTTP POST request to <span class="tt">report-uri</span> with a <span class="tt">Content-Type</span> header field of <span class="tt">application/expect-ct-report+json</span>, and an entity body consisting of <span class="tt">report body</span>.</li></ol></div><div id="rfc.section.3.2.p.4"><p>The UA MAY perform other operations as part of sending the HTTP POST request, for example sending a CORS preflight as part of <a href="#FETCH"><cite title="Fetch">[FETCH]</cite></a>.</p></div></section></section><hr class="hidden-print"><section id="security-considerations"><h2 id="rfc.section.4" class="np"><a href="#rfc.section.4">4.</a>&nbsp;<a href="#security-considerations">Security Considerations</a></h2><div id="rfc.section.4.p.1"><p>When UAs support the Expect-CT header, it becomes a potential vector for hostile header attacks against site owners. If a site owner uses a certificate issued by a certificate authority which does not embed SCTs nor serve SCTs via OCSP or TLS extension, a malicious server operator or attacker could temporarily reconfigure the host to comply with the UA’s CT policy, and add the Expect-CT header in enforcing mode with a long <span class="tt">max-age</span>. Implementing user agents would note this as an Expect-CT Host (see <a href="#noting-expect-ct" title="Noting Expect-CT">Section&nbsp;2.3.3</a>). After having done this, the configuration could then be reverted to not comply with the CT policy, prompting failures. Note this scenario would require the attacker to have substantial control over the infrastructure in question, being able to obtain different certificates, change server software, or act as a man-in-the-middle in connections.</p></div><div id="rfc.section.4.p.2"><p>Site operators could themselves only cure this situation by one of: reconfiguring their web server to transmit SCTs using the TLS extension defined in Section 6.5 of <a href="#I-D.ietf-trans-rfc6962-bis"><cite title="Certificate Transparency Version 2.0">[I-D.ietf-trans-rfc6962-bis]</cite></a>, obtaining a certificate from an alternative certificate authority which provides SCTs by one of the other methods, or by waiting for the user agents’ persisted notation of this as an Expect-CT host to reach its <span class="tt">max-age</span>. User agents may choose to implement mechanisms for users to cure this situation, as noted in <a href="#usability-considerations" title="Usability Considerations">Section&nbsp;7</a>.</p></div><section id="maximum-max-age"><h3 id="rfc.section.4.1"><a href="#rfc.section.4.1">4.1.</a>&nbsp;<a href="#maximum-max-age">Maximum max-age</a></h3><div id="rfc.section.4.1.p.1"><p>There is a security trade-off in that low maximum values provide a narrow window of protection for users that visit the Known Expect-CT Host only infrequently, while high maximum values might result in a denial of service to a UA in the event of a hostile header attack, or simply an error on the part of the site-owner.</p></div><div id="rfc.section.4.1.p.2"><p>There is probably no ideal maximum for the <span class="tt">max-age</span> directive. Since Expect-CT is primarily a policy-expansion and investigation technology rather than an end-user protection, a value on the order of 30 days (2,592,000 seconds) may be considered a balance between these competing security concerns.</p></div></section><section id="avoiding-amplification-attacks"><h3 id="rfc.section.4.2"><a href="#rfc.section.4.2">4.2.</a>&nbsp;<a href="#avoiding-amplification-attacks">Avoiding amplification attacks</a></h3><div id="rfc.section.4.2.p.1"><p>Another kind of hostile header attack uses the <span class="tt">report-uri</span> mechanism on many hosts not currently exposing SCTs as a method to cause a denial-of-service to the host receiving the reports. If some highly-trafficked websites emitted a non-enforcing Expect-CT header with a <span class="tt">report-uri</span>, implementing UAs’ reports could flood the reporting host. It is noted in <a href="#the-report-uri-directive" title="The report-uri Directive">Section&nbsp;2.1.1</a> that UAs should limit the rate at which they emit reports, but an attacker may alter the Expect-CT header’s fields to induce UAs to submit different reports to different URIs to still cause the same effect.</p></div></section></section><hr class="hidden-print"><section id="privacy-considerations"><h2 id="rfc.section.5" class="np"><a href="#rfc.section.5">5.</a>&nbsp;<a href="#privacy-considerations">Privacy Considerations</a></h2><div id="rfc.section.5.p.1"><p>Expect-CT can be used to infer what Certificate Transparency policy is in use, by attempting to retrieve specially-configured websites which pass one user agents’ policies but not another’s. Note that this consideration is true of UAs which enforce CT policies without Expect-CT as well.</p></div><div id="rfc.section.5.p.2"><p>Additionally, reports submitted to the <span class="tt">report-uri</span> could reveal information to a third party about which webpage is being accessed and by which IP address, by using individual <span class="tt">report-uri</span> values for individually-tracked pages. This information could be leaked even if client-side scripting were disabled.</p></div><div id="rfc.section.5.p.3"><p>Implementations must store state about Known Expect-CT Hosts, and hence which domains the UA has contacted.</p></div><div id="rfc.section.5.p.4"><p>Violation reports, as noted in <a href="#reporting-expect-ct-failure" title="Reporting Expect-CT Failure">Section&nbsp;3</a>, contain information about the certificate chain that has violated the CT policy. In some cases, such as organization-wide compromise of the end-to-end security of TLS, this may include information about the interception tools and design used by the organization that the organization would otherwise prefer not be disclosed.</p></div><div id="rfc.section.5.p.5"><p>Because Expect-CT causes remotely-detectable behavior, it’s advisable that UAs offer a way for privacy-sensitive users to clear currently noted Expect-CT hosts, and allow users to query the current state of Known Expect-CT Hosts.</p></div></section><hr class="hidden-print"><section id="iana-considerations"><h2 id="rfc.section.6" class="np"><a href="#rfc.section.6">6.</a>&nbsp;<a href="#iana-considerations">IANA Considerations</a></h2><div id="rfc.section.6.p.1"><p>TBD</p></div></section><hr class="hidden-print"><section id="usability-considerations"><h2 id="rfc.section.7" class="np"><a href="#rfc.section.7">7.</a>&nbsp;<a href="#usability-considerations">Usability Considerations</a></h2><div id="rfc.section.7.p.1"><p>When the UA detects a Known Expect-CT Host in violation of the UA’s CT Policy, users will experience denials of service. It is advisable for UAs to explain the reason why.</p></div></section><hr class="hidden-print"><section id="authoring-considerations"><h2 id="rfc.section.8" class="np"><a href="#rfc.section.8">8.</a>&nbsp;<a href="#authoring-considerations">Authoring Considerations</a></h2><section id="http-header"><h3 id="rfc.section.8.1"><a href="#rfc.section.8.1">8.1.</a>&nbsp;<a href="#http-header">HTTP Header</a></h3><div id="rfc.section.8.1.p.1"><p>Expect-CT could be specified as a TLS extension or X.509 certificate extension instead of an HTTP response header. Using an HTTP header as the mechanism for Expect-CT introduces a layering mismatch: for example, the software that terminates TLS and validates Certificate Transparency information might know nothing about HTTP. Nevertheless, an HTTP header was chosen primarily for ease of deployment. In practice, deploying new certificate extensions requires certificate authorities to support them, and new TLS extensions require server software updates, including possibly to servers outside of the site owner’s direct control (such as in the case of a third-party CDN). Ease of deployment is a high priority for Expect-CT because it is intended as a temporary transition mechanism for user agents that are transitioning to universal Certificate Transparency requirements.</p></div></section></section><hr class="hidden-print"><section id="changes"><h2 id="rfc.section.9" class="np"><a href="#rfc.section.9">9.</a>&nbsp;<a href="#changes">Changes</a></h2><section id="since-01"><h3 id="rfc.section.9.1"><a href="#rfc.section.9.1">9.1.</a>&nbsp;<a href="#since-01">Since -01</a></h3><div id="rfc.section.9.1.p.1"><ul><li>Change SCT reporting format to support both RFC 6962 and 6962-bis SCTs.</li></ul></div></section><section id="since-00"><h3 id="rfc.section.9.2"><a href="#rfc.section.9.2">9.2.</a>&nbsp;<a href="#since-00">Since -00</a></h3><div id="rfc.section.9.2.p.1"><ul><li>Editorial changes</li><li>Change Content-Type header of reports to ‘application/expect-ct-report+json’</li><li>Update header field syntax to match convention (issue #327)</li><li>Reference RFC 6962-bis instead of RFC 6962</li></ul></div></section></section><section id="rfc.references" class="np"><h2 id="rfc.section.10"><a href="#rfc.section.10">10.</a> Normative References</h2><dl class="dl-horizontal"><dt id="FETCH">[FETCH]</dt><dd>van Kesteren, A., “<a href="https://fetch.spec.whatwg.org/">Fetch</a>”, n.d., &lt;<a href="https://fetch.spec.whatwg.org/">https://fetch.spec.whatwg.org/</a>&gt;.</dd><dt id="HTML">[HTML]</dt><dd>Hickson, I., Pieters, S., van Kesteren, A., Jägenstedt, P., and D. Denicola, “<a href="https://html.spec.whatwg.org/">HTML</a>”, n.d., &lt;<a href="https://html.spec.whatwg.org/">https://html.spec.whatwg.org/</a>&gt;.</dd><dt id="I-D.ietf-trans-rfc6962-bis">[I-D.ietf-trans-rfc6962-bis]</dt><dd>Laurie, B., Langley, A., Kasper, E., Messeri, E., and R. Stradling, “<a href="https://tools.ietf.org/html/draft-ietf-trans-rfc6962-bis-26">Certificate Transparency Version 2.0</a>”, Internet-Draft&nbsp;draft-ietf-trans-rfc6962-bis-26 (work in progress), July&nbsp;2017.</dd><dt id="RFC2119">[RFC2119]</dt><dd>Bradner, S., “<a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>”, BCP&nbsp;14, RFC&nbsp;2119, <a href="http://dx.doi.org/10.17487/RFC2119">DOI&nbsp;10.17487/RFC2119</a>, March&nbsp;1997, &lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;.</dd><dt id="RFC3339">[RFC3339]</dt><dd>Klyne, G. and C. Newman, “<a href="https://tools.ietf.org/html/rfc3339">Date and Time on the Internet: Timestamps</a>”, RFC&nbsp;3339, <a href="http://dx.doi.org/10.17487/RFC3339">DOI&nbsp;10.17487/RFC3339</a>, July&nbsp;2002, &lt;<a href="https://www.rfc-editor.org/info/rfc3339">https://www.rfc-editor.org/info/rfc3339</a>&gt;.</dd><dt id="RFC3986">[RFC3986]</dt><dd>Berners-Lee, T., Fielding, R., and L. Masinter, “<a href="https://tools.ietf.org/html/rfc3986">Uniform Resource Identifier (URI): Generic Syntax</a>”, STD&nbsp;66, RFC&nbsp;3986, <a href="http://dx.doi.org/10.17487/RFC3986">DOI&nbsp;10.17487/RFC3986</a>, January&nbsp;2005, &lt;<a href="https://www.rfc-editor.org/info/rfc3986">https://www.rfc-editor.org/info/rfc3986</a>&gt;.</dd><dt id="RFC4648">[RFC4648]</dt><dd>Josefsson, S., “<a href="https://tools.ietf.org/html/rfc4648">The Base16, Base32, and Base64 Data Encodings</a>”, RFC&nbsp;4648, <a href="http://dx.doi.org/10.17487/RFC4648">DOI&nbsp;10.17487/RFC4648</a>, October&nbsp;2006, &lt;<a href="https://www.rfc-editor.org/info/rfc4648">https://www.rfc-editor.org/info/rfc4648</a>&gt;.</dd><dt id="RFC5234">[RFC5234]</dt><dd>Crocker, D., Ed. and P. Overell, “<a href="https://tools.ietf.org/html/rfc5234">Augmented BNF for Syntax Specifications: ABNF</a>”, STD&nbsp;68, RFC&nbsp;5234, <a href="http://dx.doi.org/10.17487/RFC5234">DOI&nbsp;10.17487/RFC5234</a>, January&nbsp;2008, &lt;<a href="https://www.rfc-editor.org/info/rfc5234">https://www.rfc-editor.org/info/rfc5234</a>&gt;.</dd><dt id="RFC5246">[RFC5246]</dt><dd>Dierks, T. and E. Rescorla, “<a href="https://tools.ietf.org/html/rfc5246">The Transport Layer Security (TLS) Protocol Version 1.2</a>”, RFC&nbsp;5246, <a href="http://dx.doi.org/10.17487/RFC5246">DOI&nbsp;10.17487/RFC5246</a>, August&nbsp;2008, &lt;<a href="https://www.rfc-editor.org/info/rfc5246">https://www.rfc-editor.org/info/rfc5246</a>&gt;.</dd><dt id="RFC6797">[RFC6797]</dt><dd>Hodges, J., Jackson, C., and A. Barth, “<a href="https://tools.ietf.org/html/rfc6797">HTTP Strict Transport Security (HSTS)</a>”, RFC&nbsp;6797, <a href="http://dx.doi.org/10.17487/RFC6797">DOI&nbsp;10.17487/RFC6797</a>, November&nbsp;2012, &lt;<a href="https://www.rfc-editor.org/info/rfc6797">https://www.rfc-editor.org/info/rfc6797</a>&gt;.</dd><dt id="RFC6962">[RFC6962]</dt><dd>Laurie, B., Langley, A., and E. Kasper, “<a href="https://tools.ietf.org/html/rfc6962">Certificate Transparency</a>”, RFC&nbsp;6962, <a href="http://dx.doi.org/10.17487/RFC6962">DOI&nbsp;10.17487/RFC6962</a>, June&nbsp;2013, &lt;<a href="https://www.rfc-editor.org/info/rfc6962">https://www.rfc-editor.org/info/rfc6962</a>&gt;.</dd><dt id="RFC7230">[RFC7230]</dt><dd>Fielding, R., Ed. and J. Reschke, Ed., “<a href="https://tools.ietf.org/html/rfc7230">Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing</a>”, RFC&nbsp;7230, <a href="http://dx.doi.org/10.17487/RFC7230">DOI&nbsp;10.17487/RFC7230</a>, June&nbsp;2014, &lt;<a href="https://www.rfc-editor.org/info/rfc7230">https://www.rfc-editor.org/info/rfc7230</a>&gt;.</dd><dt id="RFC7234">[RFC7234]</dt><dd>Fielding, R., Ed., Nottingham, M., Ed., and J. Reschke, Ed., “<a href="https://tools.ietf.org/html/rfc7234">Hypertext Transfer Protocol (HTTP/1.1): Caching</a>”, RFC&nbsp;7234, <a href="http://dx.doi.org/10.17487/RFC7234">DOI&nbsp;10.17487/RFC7234</a>, June&nbsp;2014, &lt;<a href="https://www.rfc-editor.org/info/rfc7234">https://www.rfc-editor.org/info/rfc7234</a>&gt;.</dd><dt id="RFC7468">[RFC7468]</dt><dd>Josefsson, S. and S. Leonard, “<a href="https://tools.ietf.org/html/rfc7468">Textual Encodings of PKIX, PKCS, and CMS Structures</a>”, RFC&nbsp;7468, <a href="http://dx.doi.org/10.17487/RFC7468">DOI&nbsp;10.17487/RFC7468</a>, April&nbsp;2015, &lt;<a href="https://www.rfc-editor.org/info/rfc7468">https://www.rfc-editor.org/info/rfc7468</a>&gt;.</dd><dt id="W3C.REC-html51-20161101">[W3C.REC-html51-20161101]</dt><dd>Faulkner, S., Eicholz, A., Leithead, T., and A. Danilo, “<a href="https://www.w3.org/TR/2016/REC-html51-20161101">HTML 5.1</a>”, World Wide Web Consortium Recommendation&nbsp;REC-html51-20161101, November&nbsp;2016, &lt;<a href="https://www.w3.org/TR/2016/REC-html51-20161101">https://www.w3.org/TR/2016/REC-html51-20161101</a>&gt;.</dd></dl></section><hr class="hidden-print"><section id="rfc.authors" class="np"><h2><a href="#rfc.authors">Author's Address</a></h2><address><b>Emily Stark</b><br>Google<br>EMail: <a href="mailto:estark@google.com">estark@google.com</a></address></section></div></div></div><script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script></body></html>