<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>HTTP Client Hints</title><script type="application/javascript">
function anchorRewrite() {
  map = { };
  if (window.location.hash.length >= 1) {
    var fragid = window.location.hash.substr(1);
    if (fragid) {
      if (! document.getElementById(fragid)) {
        var prefix = "rfc.";
        var mapped = map[fragid];
        if (mapped) {
          window.location.hash = mapped;
        } else if (fragid.indexOf("section-") == 0) {
          window.location.hash = prefix + "section." + fragid.substring(8);
        } else if (fragid.indexOf("appendix-") == 0) {
          window.location.hash = prefix + "section." + fragid.substring(9);
        } else if (fragid.indexOf("s-") == 0) {
          var postfix = fragid.substring(2);
          if (postfix.startsWith("abstract")) {
            window.location.hash = prefix + postfix;
          } else if (postfix.startsWith("note-")) {
            window.location.hash = prefix + "note." + postfix.substring(5);
          } else {
            window.location.hash = prefix + "section." + postfix;
          }
        } else if (fragid.indexOf("p-") == 0) {
          var r = fragid.substring(2);
          var p = r.indexOf("-");
          if (p >= 0) {
            window.location.hash = prefix + "section." + r.substring(0, p) + ".p." + r.substring(p + 1);
          }
        }
      }
    }  
  }
}
window.addEventListener('hashchange', anchorRewrite);
window.addEventListener('DOMContentLoaded', anchorRewrite);
</script><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css"><style type="text/css">
      body {
        padding-top: 80px;
        padding-bottom: 80px;
        position: relative;
      }
      .table.header th, .table.header td {
        border-top: none;
        padding: 0;
      }
      #rfc\.meta {
        width: 40%;
        float: right
      }
      #rfc\.toc > ul ul {
        list-style: none;
      }
      #sidebar {
        position: fixed;
        height: 90%;
        overflow-y: auto;
        font-size: 90%;
      }
      .container .nav-sublist {
        padding-left: 20px;
        padding-right: 10px;
        font-size: 90%;
      }
      .container .navbar-brand {
        padding-top: 0;
      }
      .container .nav > li > a {
        padding: 10px 7px 5px 15px;
        display: inline-block;
      }
      .container .nav > li > a + a {
        padding: 10px 15px 5px 7px;
        display: inline-block;
      }
      .container .nav > li > a {
        padding: 5px 10px;
      }
      .filename {
        color: rgb(119, 119, 119);
        font-size: 23px;
        font-weight: normal;
        height: auto;
        line-height: 23px;
      }
      dl {
        margin-left: 1em;
      }
      dl.dl-horizontal: {
        margin-left: 0;
      }
      dl > dt {
        float: left;
        margin-right: 1em;
      }
      dl.nohang > dt {
        float: none;
      }
      dl > dd {
        margin-bottom: .5em;
      }
      dl.compact > dd {
        margin-bottom: 0em;
      }
      dl > dd > dl {
        margin-top: 0.5em;
        margin-bottom: 0em;
      }
      ul.empty {
        list-style-type: none;
      }
      ul.empty li {
        margin-top: .5em;
      }
      td.reference {
        padding-right: 1em;
        vertical-align: top;
      }
      .feedback {
        position: fixed;
        bottom: 5px;
        right: 5px;
      }
      .fbbutton {
        margin-left: 5px;
      }
      h1 a, h2 a, h3 a, h4 a, h5 a, h6 a {
        color: rgb(51, 51, 51);
      }
      span.tt {
        font: 11pt consolas, monospace;
        font-size-adjust: none;
      }
    </style><link rel="Author" href="#rfc.authors"><link rel="Copyright" href="#rfc.copyrightnotice"><link rel="Chapter" title="1 Introduction" href="#rfc.section.1"><link rel="Chapter" title="2 Client Hint Request Header Fields" href="#rfc.section.2"><link rel="Chapter" title="3 Client Hints" href="#rfc.section.3"><link rel="Chapter" title="4 Examples" href="#rfc.section.4"><link rel="Chapter" title="5 Security Considerations" href="#rfc.section.5"><link rel="Chapter" title="6 IANA Considerations" href="#rfc.section.6"><link rel="Chapter" title="7 Acknowledgements" href="#rfc.section.7"><link rel="Chapter" href="#rfc.section.8" title="8 References"><link rel="Appendix" title="A Interaction with Key Response Header Field" href="#rfc.section.A"><link rel="Appendix" title="B Changes" href="#rfc.section.B"><meta name="generator" content="https://github.com/mnot/RFCBootstrap XSLT vendor: SAXON 9.1.0.8 from Saxonica http://www.saxonica.com/"><meta name="keywords" content="Content Negotiation"><link rel="schema.dcterms" href="http://purl.org/dc/terms/"><meta name="dcterms.creator" content="Grigorik, I."><meta name="dcterms.identifier" content="urn:ietf:id:draft-ietf-httpbis-client-hints-latest"><meta name="dcterms.issued" content="2017-10-23"><meta name="dcterms.abstract" content="An increasing diversity of Web-connected devices and software capabilities has created a need to deliver optimized content for each device.This specification defines a set of HTTP request header fields, colloquially known as Client Hints, to address this. They are intended to be used as input to proactive content negotiation; just as the Accept header field allows user agents to indicate what formats they prefer, Client Hints allow user agents to indicate device and agent specific preferences."><meta name="description" content="An increasing diversity of Web-connected devices and software capabilities has created a need to deliver optimized content for each device.This specification defines a set of HTTP request header fields, colloquially known as Client Hints, to address this. They are intended to be used as input to proactive content negotiation; just as the Accept header field allows user agents to indicate what formats they prefer, Client Hints allow user agents to indicate device and agent specific preferences."></head><body><div class="container" id="top"><div class="row"><div class="col-md-4 col-md-push-8 hidden-sm hidden-xs" id="sidebar" role="navigation"><div class="navbar"><div class="navbar-brand"><a href="#top">draft-ietf-httpbis-client-hints-latest</a></div><br clear="all"><div class=""><div id="rfc.toc"><ul class="nav"><li><a href="#rfc.section.1">1.</a>&nbsp;&nbsp;&nbsp;<a href="#introduction">Introduction</a><ul><li><a href="#rfc.section.1.1">1.1.</a>&nbsp;&nbsp;&nbsp;<a href="#notational-conventions">Notational Conventions</a></li></ul></li><li><a href="#rfc.section.2">2.</a>&nbsp;&nbsp;&nbsp;<a href="#client-hint-request-header-fields">Client Hint Request Header Fields</a><ul><li><a href="#rfc.section.2.1">2.1.</a>&nbsp;&nbsp;&nbsp;<a href="#sending-client-hints">Sending Client Hints</a></li><li><a href="#rfc.section.2.2">2.2.</a>&nbsp;&nbsp;&nbsp;<a href="#server-processing-of-client-hints">Server Processing of Client Hints</a><ul><li><a href="#rfc.section.2.2.1">2.2.1.</a>&nbsp;&nbsp;&nbsp;<a href="#accept-ch">Advertising Support via Accept-CH Header Field</a></li><li><a href="#rfc.section.2.2.2">2.2.2.</a>&nbsp;&nbsp;&nbsp;<a href="#accept-ch-lifetime">The Accept-CH-Lifetime Header Field</a></li><li><a href="#rfc.section.2.2.3">2.2.3.</a>&nbsp;&nbsp;&nbsp;<a href="#interaction-with-caches">Interaction with Caches</a></li></ul></li></ul></li><li><a href="#rfc.section.3">3.</a>&nbsp;&nbsp;&nbsp;<a href="#client-hints">Client Hints</a><ul><li><a href="#rfc.section.3.1">3.1.</a>&nbsp;&nbsp;&nbsp;<a href="#dpr">The DPR Header Field</a><ul><li><a href="#rfc.section.3.1.1">3.1.1.</a>&nbsp;&nbsp;&nbsp;<a href="#content-dpr">Confirming Selected DPR</a></li></ul></li><li><a href="#rfc.section.3.2">3.2.</a>&nbsp;&nbsp;&nbsp;<a href="#width">The Width Header Field</a></li><li><a href="#rfc.section.3.3">3.3.</a>&nbsp;&nbsp;&nbsp;<a href="#viewport-width">The Viewport-Width Header Field</a></li><li><a href="#rfc.section.3.4">3.4.</a>&nbsp;&nbsp;&nbsp;<a href="#save-data">The Save-Data Header Field</a></li></ul></li><li><a href="#rfc.section.4">4.</a>&nbsp;&nbsp;&nbsp;<a href="#examples">Examples</a></li><li><a href="#rfc.section.5">5.</a>&nbsp;&nbsp;&nbsp;<a href="#security-considerations">Security Considerations</a></li><li><a href="#rfc.section.6">6.</a>&nbsp;&nbsp;&nbsp;<a href="#iana-considerations">IANA Considerations</a><ul><li><a href="#rfc.section.6.1">6.1.</a>&nbsp;&nbsp;&nbsp;<a href="#iana-accept-ch">Accept-CH</a></li><li><a href="#rfc.section.6.2">6.2.</a>&nbsp;&nbsp;&nbsp;<a href="#iana-accept-ch-lifetime">Accept-CH-Lifetime</a></li><li><a href="#rfc.section.6.3">6.3.</a>&nbsp;&nbsp;&nbsp;<a href="#iana-content-dpr">Content-DPR</a></li><li><a href="#rfc.section.6.4">6.4.</a>&nbsp;&nbsp;&nbsp;<a href="#iana-dpr">DPR</a></li><li><a href="#rfc.section.6.5">6.5.</a>&nbsp;&nbsp;&nbsp;<a href="#iana-save-data">Save-Data</a></li><li><a href="#rfc.section.6.6">6.6.</a>&nbsp;&nbsp;&nbsp;<a href="#iana-viewport-width">Viewport-Width</a></li><li><a href="#rfc.section.6.7">6.7.</a>&nbsp;&nbsp;&nbsp;<a href="#iana-width">Width</a></li></ul></li><li><a href="#rfc.section.7">7.</a>&nbsp;&nbsp;&nbsp;<a href="#acknowledgements">Acknowledgements</a></li><li><a href="#rfc.section.8">8.</a>&nbsp;&nbsp;&nbsp;<a href="#rfc.references">References</a><ul><li><a href="#rfc.section.8.1">8.1.</a>&nbsp;&nbsp;&nbsp;<a href="#rfc.references.1">Normative References</a></li><li><a href="#rfc.section.8.2">8.2.</a>&nbsp;&nbsp;&nbsp;<a href="#rfc.references.2">Informative References</a></li></ul></li><li><a href="#rfc.section.A">A.</a>&nbsp;&nbsp;&nbsp;<a href="#interaction-with-key-response-header-field">Interaction with Key Response Header Field</a></li><li><a href="#rfc.section.B">B.</a>&nbsp;&nbsp;&nbsp;<a href="#changes">Changes</a><ul><li><a href="#rfc.section.B.1">B.1.</a>&nbsp;&nbsp;&nbsp;<a href="#since-00">Since -00</a></li><li><a href="#rfc.section.B.2">B.2.</a>&nbsp;&nbsp;&nbsp;<a href="#since-01">Since -01</a></li><li><a href="#rfc.section.B.3">B.3.</a>&nbsp;&nbsp;&nbsp;<a href="#since-02">Since -02</a></li><li><a href="#rfc.section.B.4">B.4.</a>&nbsp;&nbsp;&nbsp;<a href="#since-03">Since -03</a></li><li><a href="#rfc.section.B.5">B.5.</a>&nbsp;&nbsp;&nbsp;<a href="#since-04">Since -04</a></li><li><a href="#rfc.section.B.6">B.6.</a>&nbsp;&nbsp;&nbsp;<a href="#since-05">Since -05</a></li></ul></li><li><a href="#rfc.authors">Author's Address</a></li></ul></div></div></div></div><div class="col-md-8 main" role="main"><header><table class="table table-condensed header" id="rfc.headerblock"><tbody><tr><td class="text-left">HTTP Working Group</td><td class="text-right">I. Grigorik</td></tr><tr><td class="text-left">Internet-Draft</td><td class="text-right">Google</td></tr><tr><td class="text-left">Intended status: Experimental</td><td class="text-right">October 23, 2017</td></tr><tr><td class="text-left">Expires: April 26, 2018</td><td class="text-right"></td></tr></tbody></table><div id="rfc.title"><h1>HTTP Client Hints</h1><div class="filename">draft-ietf-httpbis-client-hints-latest</div></div></header><hr><h2 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h2><div class="lead"><div id="rfc.abstract.p.1"><p>An increasing diversity of Web-connected devices and software capabilities has created a need to deliver optimized content for each device.</p></div><div id="rfc.abstract.p.2"><p>This specification defines a set of HTTP request header fields, colloquially known as Client Hints, to address this. They are intended to be used as input to proactive content negotiation; just as the Accept header field allows user agents to indicate what formats they prefer, Client Hints allow user agents to indicate device and agent specific preferences.</p></div></div><section id="rfc.note.1" class="note"><h2><a href="#rfc.note.1">Note to Readers</a></h2><div id="rfc.note.1.p.1"><p>Discussion of this draft takes place on the HTTP working group mailing list (ietf-http-wg@w3.org), which is archived at <a href="https://lists.w3.org/Archives/Public/ietf-http-wg/">https://lists.w3.org/Archives/Public/ietf-http-wg/</a>.</p></div><div id="rfc.note.1.p.2"><p>Working Group information can be found at <a href="http://httpwg.github.io/">http://httpwg.github.io/</a>; source code and issues list for this draft can be found at <a href="https://github.com/httpwg/http-extensions/labels/client-hints">https://github.com/httpwg/http-extensions/labels/client-hints</a>.</p></div></section><section id="rfc.status"><h2><a href="#rfc.status">Status of this Memo</a></h2><div id="rfc.boilerplate.1.p.1"><p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p></div><div id="rfc.boilerplate.1.p.2"><p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF). Note that other groups may also distribute working documents as Internet-Drafts. The list of current Internet-Drafts is at <a href="http://datatracker.ietf.org/drafts/current/">http://datatracker.ietf.org/drafts/current/</a>.</p></div><div id="rfc.boilerplate.1.p.3"><p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time. It is inappropriate to use Internet-Drafts as reference material or to cite them other than as “work in progress”.</p></div><div id="rfc.boilerplate.1.p.4"><p>This Internet-Draft will expire on April 26, 2018.</p></div></section><section id="rfc.copyrightnotice"><h2><a href="#rfc.copyrightnotice">Copyright Notice</a></h2><div id="rfc.boilerplate.2.p.1"><p>Copyright © 2017 IETF Trust and the persons identified as the document authors. All rights reserved.</p></div><div id="rfc.boilerplate.2.p.2"><p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of publication of this document. Please review these documents carefully, as they describe your rights and restrictions with respect to this document. Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p></div></section><section id="introduction"><h2 id="rfc.section.1" class="np"><a href="#rfc.section.1">1.</a>&nbsp;<a href="#introduction">Introduction</a></h2><div id="rfc.section.1.p.1"><p>There are thousands of different devices accessing the web, each with different device capabilities and preference information. These device capabilities include hardware and software characteristics, as well as dynamic user and client preferences.</p></div><div id="rfc.section.1.p.2" class="avoidbreakafter"><p>One way to infer some of these capabilities is through User-Agent (Section 5.5.3 of <a href="#RFC7231"><cite title="Hypertext Transfer Protocol (HTTP/1.1): Semantics and Content">[RFC7231]</cite></a>) header field detection against an established database of client signatures. However, this technique requires acquiring such a database, integrating it into the serving path, and keeping it up to date. However, even once this infrastructure is deployed, user agent sniffing has numerous limitations:</p></div><div id="rfc.section.1.p.3"><ul><li>User agent detection cannot reliably identify all static variables</li><li>User agent detection cannot infer any dynamic client preferences</li><li>User agent detection requires an external device database</li><li>User agent detection is not cache friendly</li></ul></div><div id="rfc.section.1.p.4"><p>A popular alternative strategy is to use HTTP cookies (<a href="#RFC6265"><cite title="HTTP State Management Mechanism">[RFC6265]</cite></a>) to communicate some information about the user agent. However, this approach is also not cache friendly, bound by same origin policy, and imposes additional client-side latency by requiring JavaScript execution to create and manage HTTP cookies.</p></div><div id="rfc.section.1.p.5"><p>This document defines a set of new request header fields that allow user agent to perform proactive content negotiation (Section 3.4.1 of <a href="#RFC7231"><cite title="Hypertext Transfer Protocol (HTTP/1.1): Semantics and Content">[RFC7231]</cite></a>) by indicating device and agent specific preferences, through a mechanism similar to the Accept header field which is used to indicate preferred response formats.</p></div><div id="rfc.section.1.p.6"><p>Client Hints does not supersede or replace the User-Agent header field. Existing device detection mechanisms can continue to use both mechanisms if necessary. By advertising its capabilities within a request header field, Client Hints allows for cache friendly and proactive content negotiation.</p></div><section id="notational-conventions"><h3 id="rfc.section.1.1"><a href="#rfc.section.1.1">1.1.</a>&nbsp;<a href="#notational-conventions">Notational Conventions</a></h3><div id="rfc.section.1.1.p.1"><p>The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “NOT RECOMMENDED”, “MAY”, and “OPTIONAL” in this document are to be interpreted as described in BCP 14 [RFC2119] [RFC8174] when, and only when, they appear in all capitals, as shown here.</p></div><div id="rfc.section.1.1.p.2"><p>This document uses the Augmented Backus-Naur Form (ABNF) notation of <a href="#RFC5234"><cite title="Augmented BNF for Syntax Specifications: ABNF">[RFC5234]</cite></a> with the list rule extension defined in <a href="#RFC7230"><cite title="Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing">[RFC7230]</cite></a>, Appendix B. It includes by reference the DIGIT rule from <a href="#RFC5234"><cite title="Augmented BNF for Syntax Specifications: ABNF">[RFC5234]</cite></a> and the OWS and field-name rules from <a href="#RFC7230"><cite title="Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing">[RFC7230]</cite></a>.</p></div></section></section><section id="client-hint-request-header-fields"><h2 id="rfc.section.2"><a href="#rfc.section.2">2.</a>&nbsp;<a href="#client-hint-request-header-fields">Client Hint Request Header Fields</a></h2><div id="rfc.section.2.p.1"><p>A Client Hint request header field is a HTTP header field that is used by HTTP clients to indicate configuration data that can be used by the server to select an appropriate response. Each one conveys client preferences that the server can use to adapt and optimize the response.</p></div><section id="sending-client-hints"><h3 id="rfc.section.2.1"><a href="#rfc.section.2.1">2.1.</a>&nbsp;<a href="#sending-client-hints">Sending Client Hints</a></h3><div id="rfc.section.2.1.p.1"><p>Clients control which Client Hints are sent in requests, based on their default settings, user configuration and/or preferences. Implementers might provide user choice mechanisms so that users may balance privacy concerns with bandwidth limitations. Implementations specific to certain use cases or threat models might avoid transmitting these header fields altogether, or limit them to secure contexts or authenticated sessions. Implementers should be aware that explaining the privacy implications of passive fingerprinting or network information disclosure may be challenging.</p></div><div id="rfc.section.2.1.p.2"><p>The client and server, or an intermediate proxy, can use an opt-in mechanism to negotiate which fields should be reported to allow for efficient content adaption.</p></div></section><section id="server-processing-of-client-hints"><h3 id="rfc.section.2.2"><a href="#rfc.section.2.2">2.2.</a>&nbsp;<a href="#server-processing-of-client-hints">Server Processing of Client Hints</a></h3><div id="rfc.section.2.2.p.1"><p>When presented with a request that contains one or more client hint header fields, servers can optimize the response based upon the information in them. When doing so, and if the resource is cacheable, the server MUST also generate a Vary response header field (Section 7.1.4 of <a href="#RFC7231"><cite title="Hypertext Transfer Protocol (HTTP/1.1): Semantics and Content">[RFC7231]</cite></a>) to indicate which hints can affect the selected response and whether the selected response is appropriate for a later request.</p></div><div id="rfc.section.2.2.p.2"><p>Further, depending on the hint used, the server can generate additional response header fields to convey related values to aid client processing. For example, this specification defines the “Content-DPR” response header field that needs to be returned by the server when the “DPR” hint is used to select the response.</p></div><section id="accept-ch"><h4 id="rfc.section.2.2.1"><a href="#rfc.section.2.2.1">2.2.1.</a>&nbsp;<a href="#accept-ch">Advertising Support via Accept-CH Header Field</a></h4><div id="rfc.section.2.2.1.p.1"><p>Servers can advertise support for Client Hints using the Accept-CH header field or an equivalent HTML meta element with http-equiv attribute (<a href="#HTML5"><cite title="HTML5">[HTML5]</cite></a>).</p></div><div id="rfc.figure.u.1"><pre class="inline">
  Accept-CH = #field-name
</pre></div><div id="rfc.section.2.2.1.p.2" class="avoidbreakafter"><p>For example:</p></div><div id="rfc.figure.u.2"><pre class="text">
  Accept-CH: DPR, Width, Viewport-Width
</pre></div><div id="rfc.section.2.2.1.p.3"><p>When a client receives Accept-CH, or if it is capable of processing the HTML response and finds an equivalent HTML meta element, it can treat it as a signal that the application is interested in receiving specified request header fields that match the advertised field-values; subresource requests initiated as a result of processing the response from the server that includes the Accept-CH opt-in can include the request header fields that match the advertised field-values.</p></div><div id="rfc.section.2.2.1.p.4"><p>For example, based on Accept-CH example above, a user agent could append DPR, Width, and Viewport-Width header fields to all subresource requests initiated by the page constructed from the response.</p></div></section><section id="accept-ch-lifetime"><h4 id="rfc.section.2.2.2"><a href="#rfc.section.2.2.2">2.2.2.</a>&nbsp;<a href="#accept-ch-lifetime">The Accept-CH-Lifetime Header Field</a></h4><div id="rfc.section.2.2.2.p.1"><p>Servers can ask the client to remember an origin-wide Accept-CH preference for a specified period of time to enable delivery of Client Hints on all subsequent requests to the origin (<a href="#RFC6454"><cite title="The Web Origin Concept">[RFC6454]</cite></a>), and on any requests initiated as a result of processing a response from the origin.</p></div><div id="rfc.figure.u.3"><pre class="inline">
  Accept-CH-Lifetime = #delta-seconds
</pre></div><div id="rfc.section.2.2.2.p.2"><p>The field-value indicates that the Accept-CH preference SHOULD be considered stale after its age is greater than the specified number of seconds.</p></div><div id="rfc.figure.u.4"><pre class="text">
  Accept-CH: DPR, Width
  Accept-CH: Viewport-Width
  Accept-CH-Lifetime: 86400
</pre></div><div id="rfc.section.2.2.2.p.3"><p>For example, based on the Accept-CH and Accept-CH-Lifetime example above, a user agent could persist an origin-wide Accept-CH preference for up to 86400 seconds (1 day). Then, if a request is initiated to the same origin before the preference is stale (e.g. as a result of a navigation to the origin, or fetching a subresource from the origin) the client could append the requested header fields (DPR, Width, and Viewport-Width in this example) to the request and any subresource requests initiated as a result of processing a response from same origin.</p></div><div id="rfc.section.2.2.2.p.4"><p>If Accept-CH-Lifetime occurs in a message more than once, the last value overrides all previous occurrences.</p></div></section><section id="interaction-with-caches"><h4 id="rfc.section.2.2.3"><a href="#rfc.section.2.2.3">2.2.3.</a>&nbsp;<a href="#interaction-with-caches">Interaction with Caches</a></h4><div id="rfc.section.2.2.3.p.1"><p>When selecting an optimized response based on one or more Client Hints, and if the resource is cacheable, the server needs to generate a Vary response header field (<a href="#RFC7234"><cite title="Hypertext Transfer Protocol (HTTP/1.1): Caching">[RFC7234]</cite></a>) to indicate which hints can affect the selected response and whether the selected response is appropriate for a later request.</p></div><div id="rfc.figure.u.5"><pre class="text">
  Vary: DPR
</pre></div><div id="rfc.section.2.2.3.p.2"><p>Above example indicates that the cache key needs to include the DPR header field.</p></div><div id="rfc.figure.u.6"><pre class="text">
  Vary: DPR, Width
</pre></div><div id="rfc.section.2.2.3.p.3"><p>Above example indicates that the cache key needs to include the DPR and Width header fields.</p></div></section></section></section><section id="client-hints"><h2 id="rfc.section.3"><a href="#rfc.section.3">3.</a>&nbsp;<a href="#client-hints">Client Hints</a></h2><section id="dpr"><h3 id="rfc.section.3.1"><a href="#rfc.section.3.1">3.1.</a>&nbsp;<a href="#dpr">The DPR Header Field</a></h3><div id="rfc.section.3.1.p.1"><p>The “DPR” request header field is a number that indicates the client’s current Device Pixel Ratio (DPR), which is the ratio of physical pixels over CSS px (Section 5.2 of <a href="#CSSVAL"><cite title="CSS Values and Units Module Level 3">[CSSVAL]</cite></a>) of the layout viewport (Section 9.1.1 of <a href="#CSS2"><cite title="Cascading Style Sheets Level 2 Revision 1 (CSS 2.1) Specification">[CSS2]</cite></a>) on the device.</p></div><div id="rfc.figure.u.7"><pre class="inline">
  DPR = 1*DIGIT [ "." 1*DIGIT ]
</pre></div><div id="rfc.section.3.1.p.2"><p>If DPR occurs in a message more than once, the last value overrides all previous occurrences.</p></div><section id="content-dpr"><h4 id="rfc.section.3.1.1"><a href="#rfc.section.3.1.1">3.1.1.</a>&nbsp;<a href="#content-dpr">Confirming Selected DPR</a></h4><div id="rfc.section.3.1.1.p.1"><p>The “Content-DPR” response header field is a number that indicates the ratio between physical pixels over CSS px of the selected image response.</p></div><div id="rfc.figure.u.8"><pre class="inline">
  Content-DPR = 1*DIGIT [ "." 1*DIGIT ]
</pre></div><div id="rfc.section.3.1.1.p.2"><p>DPR ratio affects the calculation of intrinsic size of image resources on the client - i.e. typically, the client automatically scales the natural size of the image by the DPR ratio to derive its display dimensions. As a result, the server MUST explicitly indicate the DPR of the selected image response whenever the DPR hint is used, and the client MUST use the DPR value returned by the server to perform its calculations. In case the server returned Content-DPR value contradicts previous client-side DPR indication, the server returned value MUST take precedence.</p></div><div id="rfc.section.3.1.1.p.3"><p>Note that DPR confirmation is only required for image responses, and the server does not need to confirm the resource width as this value can be derived from the resource itself once it is decoded by the client.</p></div><div id="rfc.section.3.1.1.p.4"><p>If Content-DPR occurs in a message more than once, the last value overrides all previous occurrences.</p></div></section></section><section id="width"><h3 id="rfc.section.3.2"><a href="#rfc.section.3.2">3.2.</a>&nbsp;<a href="#width">The Width Header Field</a></h3><div id="rfc.section.3.2.p.1"><p>The “Width” request header field is a number that indicates the desired resource width in physical px (i.e. intrinsic size of an image). The provided physical px value is a number rounded to the smallest following integer (i.e. ceiling value).</p></div><div id="rfc.figure.u.9"><pre class="inline">
  Width = 1*DIGIT
</pre></div><div id="rfc.section.3.2.p.2"><p>If the desired resource width is not known at the time of the request or the resource does not have a display width, the Width header field can be omitted. If Width occurs in a message more than once, the last value overrides all previous occurrences.</p></div></section><section id="viewport-width"><h3 id="rfc.section.3.3"><a href="#rfc.section.3.3">3.3.</a>&nbsp;<a href="#viewport-width">The Viewport-Width Header Field</a></h3><div id="rfc.section.3.3.p.1"><p>The “Viewport-Width” request header field is a number that indicates the layout viewport width in CSS px. The provided CSS px value is a number rounded to the smallest following integer (i.e. ceiling value).</p></div><div id="rfc.figure.u.10"><pre class="inline">
  Viewport-Width = 1*DIGIT
</pre></div><div id="rfc.section.3.3.p.2"><p>If Viewport-Width occurs in a message more than once, the last value overrides all previous occurrences.</p></div></section><section id="save-data"><h3 id="rfc.section.3.4"><a href="#rfc.section.3.4">3.4.</a>&nbsp;<a href="#save-data">The Save-Data Header Field</a></h3><div id="rfc.section.3.4.p.1"><p>The “Save-Data” request header field consists of one or more tokens that indicate client’s preference for reduced data usage, due to high transfer costs, slow connection speeds, or other reasons.</p></div><div id="rfc.figure.u.11"><pre class="inline">
  Save-Data = sd-token *( OWS ";" OWS [sd-token] )
  sd-token = token
</pre></div><div id="rfc.section.3.4.p.2"><p>This document defines the “on” sd-token value, which is used as a signal indicating explicit user opt-in into a reduced data usage mode on the client, and when communicated to origins allows them to deliver alternate content honoring such preference - e.g. smaller image and video resources, alternate markup, and so on. New token and extension token values can be defined by updates to this specification.</p></div><div id="rfc.section.3.4.p.3"><p>If Save-Data occurs in a message more than once, the last value overrides all previous occurrences.</p></div></section></section><section id="examples"><h2 id="rfc.section.4"><a href="#rfc.section.4">4.</a>&nbsp;<a href="#examples">Examples</a></h2><div id="rfc.section.4.p.1" class="avoidbreakafter"><p>For example, given the following request header fields:</p></div><div id="rfc.figure.u.12"><pre class="text">
  DPR: 2.0
  Width: 320
  Viewport-Width: 320
</pre></div><div id="rfc.section.4.p.2"><p>The server knows that the device pixel ratio is 2.0, that the intended display width of the requested resource is 160 CSS px (320 physical pixels at 2x resolution), and that the viewport width is 320 CSS px.</p></div><div id="rfc.section.4.p.3" class="avoidbreakafter"><p>If the server uses above hints to perform resource selection for an image asset, it must confirm its selection via the Content-DPR response header to allow the client to calculate the appropriate intrinsic size of the image response. The server does not need to confirm resource width, only the ratio between physical pixels and CSS px of the selected image resource:</p></div><div id="rfc.figure.u.13"><pre class="text">
  Content-DPR: 1.0
</pre></div><div id="rfc.section.4.p.4"><p>The Content-DPR response header field indicates to the client that the server has selected resource with DPR ratio of 1.0. The client can use this information to perform additional processing on the resource - for example, calculate the appropriate intrinsic size of the image resource such that it is displayed at the correct resolution.</p></div></section><section id="security-considerations"><h2 id="rfc.section.5"><a href="#rfc.section.5">5.</a>&nbsp;<a href="#security-considerations">Security Considerations</a></h2><div id="rfc.section.5.p.1"><p>The request header fields defined in this specification expose information that is already available to Web applications in the browser runtime itself (e.g., using JavaScript and CSS). For example, the application can obtain viewport width, image display width, and device pixel ratio via JavaScript, or through the use of CSS media queries and unique resource URLs even if JavaScript is disabled. However, servers that gather this information through such mechanisms are typically observable (e.g., you can see that they’re using JavaScript to gather it), whereas servers’ use of the header fields introduced by this specification is not observable. Section 2.1 discusses potential mitigations.</p></div><div id="rfc.section.5.p.2"><p>For example, sending Client Hints on all requests can make information about the user’s environment available to origins that otherwise did not have access to this data, which may or may not be the desired outcome - e.g. this may enable an image optimization service to deliver a tailored asset, and it may reveal same information about the user to other origins that may not have had access to it before. Similarly, sending highly granular data, such as image and viewport width may help identify users across multiple requests. Restricting such field values to an enumerated range, where the user agent advertises a threshold value that is close but is not an exact representation of the current value, can help mitigate the risk of such fingerprinting.</p></div><div id="rfc.section.5.p.3"><p>Implementers ought to provide mechanisms and policies to control how and when such hints are advertised. For example, they could require origin opt-in via Accept-CH; clear remembered opt-in, as set by Accept-CH-Lifetime, when site data, browsing history, browsing cache, or similar, are cleared; restrict delivery to same origin subrequests; limit delivery to requests that already carry identifying information (e.g. cookies); modify delivery policy when in an “incognito” or a similar privacy mode; enable user configuration and opt in, and so on.</p></div></section><section id="iana-considerations"><h2 id="rfc.section.6"><a href="#rfc.section.6">6.</a>&nbsp;<a href="#iana-considerations">IANA Considerations</a></h2><div id="rfc.section.6.p.1"><p>This document defines the “Accept-CH”, “DPR”, “Save-Data”, “Viewport-Width”, and “Width” HTTP request fields, “Accept-CH”, “Accept-CH-Lifetime”, and “Content-DPR” HTTP response field, and registers them in the Permanent Message Header Fields registry.</p></div><section id="iana-accept-ch"><h3 id="rfc.section.6.1"><a href="#rfc.section.6.1">6.1.</a>&nbsp;<a href="#iana-accept-ch">Accept-CH</a></h3><div id="rfc.section.6.1.p.1"><ul><li>Header field name: Accept-CH</li><li>Applicable protocol: HTTP</li><li>Status: standard</li><li>Author/Change controller: IETF</li><li>Specification document(s): <a href="#accept-ch" title="Advertising Support via Accept-CH Header Field">Section&nbsp;2.2.1</a> of this document</li><li>Related information: for Client Hints</li></ul></div></section><section id="iana-accept-ch-lifetime"><h3 id="rfc.section.6.2"><a href="#rfc.section.6.2">6.2.</a>&nbsp;<a href="#iana-accept-ch-lifetime">Accept-CH-Lifetime</a></h3><div id="rfc.section.6.2.p.1"><ul><li>Header field name: Accept-CH-Lifetime</li><li>Applicable protocol: HTTP</li><li>Status: standard</li><li>Author/Change controller: IETF</li><li>Specification document(s): <a href="#accept-ch-lifetime" title="The Accept-CH-Lifetime Header Field">Section&nbsp;2.2.2</a> of this document</li><li>Related information: for Client Hints</li></ul></div></section><section id="iana-content-dpr"><h3 id="rfc.section.6.3"><a href="#rfc.section.6.3">6.3.</a>&nbsp;<a href="#iana-content-dpr">Content-DPR</a></h3><div id="rfc.section.6.3.p.1"><ul><li>Header field name: Content-DPR</li><li>Applicable protocol: HTTP</li><li>Status: standard</li><li>Author/Change controller: IETF</li><li>Specification document(s): <a href="#content-dpr" title="Confirming Selected DPR">Section&nbsp;3.1.1</a> of this document</li><li>Related information: for Client Hints</li></ul></div></section><section id="iana-dpr"><h3 id="rfc.section.6.4"><a href="#rfc.section.6.4">6.4.</a>&nbsp;<a href="#iana-dpr">DPR</a></h3><div id="rfc.section.6.4.p.1"><ul><li>Header field name: DPR</li><li>Applicable protocol: HTTP</li><li>Status: standard</li><li>Author/Change controller: IETF</li><li>Specification document(s): <a href="#dpr" title="The DPR Header Field">Section&nbsp;3.1</a> of this document</li><li>Related information: for Client Hints</li></ul></div></section><section id="iana-save-data"><h3 id="rfc.section.6.5"><a href="#rfc.section.6.5">6.5.</a>&nbsp;<a href="#iana-save-data">Save-Data</a></h3><div id="rfc.section.6.5.p.1"><ul><li>Header field name: Save-Data</li><li>Applicable protocol: HTTP</li><li>Status: standard</li><li>Author/Change controller: IETF</li><li>Specification document(s): <a href="#save-data" title="The Save-Data Header Field">Section&nbsp;3.4</a> of this document</li><li>Related information: for Client Hints</li></ul></div></section><section id="iana-viewport-width"><h3 id="rfc.section.6.6"><a href="#rfc.section.6.6">6.6.</a>&nbsp;<a href="#iana-viewport-width">Viewport-Width</a></h3><div id="rfc.section.6.6.p.1"><ul><li>Header field name: Viewport-Width</li><li>Applicable protocol: HTTP</li><li>Status: standard</li><li>Author/Change controller: IETF</li><li>Specification document(s): <a href="#viewport-width" title="The Viewport-Width Header Field">Section&nbsp;3.3</a> of this document</li><li>Related information: for Client Hints</li></ul></div></section><section id="iana-width"><h3 id="rfc.section.6.7"><a href="#rfc.section.6.7">6.7.</a>&nbsp;<a href="#iana-width">Width</a></h3><div id="rfc.section.6.7.p.1"><ul><li>Header field name: Width</li><li>Applicable protocol: HTTP</li><li>Status: standard</li><li>Author/Change controller: IETF</li><li>Specification document(s): <a href="#width" title="The Width Header Field">Section&nbsp;3.2</a> of this document</li><li>Related information: for Client Hints</li></ul></div></section></section><section id="acknowledgements"><h2 id="rfc.section.7"><a href="#rfc.section.7">7.</a>&nbsp;<a href="#acknowledgements">Acknowledgements</a></h2><div id="rfc.section.7.p.1"><p>Thanks to Mark Nottingham, Julian Reschke, Chris Bentzel, Yoav Weiss, Ben Greenstein, Tarun Bansal, Roy Fielding, Vasiliy Faronov, Ted Hardie, Jonas Sicking, and numerous other members of the IETF HTTP Working Group for invaluable help and feedback.</p></div></section><section id="rfc.references"><h2 id="rfc.section.8"><a href="#rfc.section.8">8.</a> References</h2><section id="rfc.references.1"><h3 id="rfc.section.8.1"><a href="#rfc.section.8.1">8.1.</a> Normative References</h3><dl class="dl-horizontal"><dt id="CSS2">[CSS2]</dt><dd>Bos, B., Celic, T., Hickson, I., and H. Lie, “<a href="http://www.w3.org/TR/2011/REC-CSS2-20110607">Cascading Style Sheets Level 2 Revision 1 (CSS 2.1) Specification</a>”, W3C Recommendation&nbsp;REC-CSS2-20110607, June&nbsp;2011, &lt;<a href="http://www.w3.org/TR/2011/REC-CSS2-20110607">http://www.w3.org/TR/2011/REC-CSS2-20110607</a>&gt;.</dd><dt id="CSSVAL">[CSSVAL]</dt><dd>Atkins, T. and E. Etemad, “<a href="https://www.w3.org/TR/2016/CR-css-values-3-20160929">CSS Values and Units Module Level 3</a>”, World Wide Web Consortium CR&nbsp;CR-css-values-3-20160929, September&nbsp;2016, &lt;<a href="https://www.w3.org/TR/2016/CR-css-values-3-20160929">https://www.w3.org/TR/2016/CR-css-values-3-20160929</a>&gt;.</dd><dt id="HTML5">[HTML5]</dt><dd>Hickson, I., Berjon, R., Faulkner, S., Leithead, T., Navara, E., O&amp;#039;Connor, T., and S. Pfeiffer, “<a href="http://www.w3.org/TR/2014/REC-html5-20141028">HTML5</a>”, World Wide Web Consortium Recommendation&nbsp;REC-html5-20141028, October&nbsp;2014, &lt;<a href="http://www.w3.org/TR/2014/REC-html5-20141028">http://www.w3.org/TR/2014/REC-html5-20141028</a>&gt;.</dd><dt id="RFC2119">[RFC2119]</dt><dd>Bradner, S., “<a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>”, BCP&nbsp;14, RFC&nbsp;2119, <a href="http://dx.doi.org/10.17487/RFC2119">DOI&nbsp;10.17487/RFC2119</a>, March&nbsp;1997, &lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;.</dd><dt id="RFC5234">[RFC5234]</dt><dd>Crocker, D., Ed. and P. Overell, “<a href="https://tools.ietf.org/html/rfc5234">Augmented BNF for Syntax Specifications: ABNF</a>”, STD&nbsp;68, RFC&nbsp;5234, <a href="http://dx.doi.org/10.17487/RFC5234">DOI&nbsp;10.17487/RFC5234</a>, January&nbsp;2008, &lt;<a href="https://www.rfc-editor.org/info/rfc5234">https://www.rfc-editor.org/info/rfc5234</a>&gt;.</dd><dt id="RFC6454">[RFC6454]</dt><dd>Barth, A., “<a href="https://tools.ietf.org/html/rfc6454">The Web Origin Concept</a>”, RFC&nbsp;6454, <a href="http://dx.doi.org/10.17487/RFC6454">DOI&nbsp;10.17487/RFC6454</a>, December&nbsp;2011, &lt;<a href="https://www.rfc-editor.org/info/rfc6454">https://www.rfc-editor.org/info/rfc6454</a>&gt;.</dd><dt id="RFC7230">[RFC7230]</dt><dd>Fielding, R., Ed. and J. Reschke, Ed., “<a href="https://tools.ietf.org/html/rfc7230">Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing</a>”, RFC&nbsp;7230, <a href="http://dx.doi.org/10.17487/RFC7230">DOI&nbsp;10.17487/RFC7230</a>, June&nbsp;2014, &lt;<a href="https://www.rfc-editor.org/info/rfc7230">https://www.rfc-editor.org/info/rfc7230</a>&gt;.</dd><dt id="RFC7231">[RFC7231]</dt><dd>Fielding, R., Ed. and J. Reschke, Ed., “<a href="https://tools.ietf.org/html/rfc7231">Hypertext Transfer Protocol (HTTP/1.1): Semantics and Content</a>”, RFC&nbsp;7231, <a href="http://dx.doi.org/10.17487/RFC7231">DOI&nbsp;10.17487/RFC7231</a>, June&nbsp;2014, &lt;<a href="https://www.rfc-editor.org/info/rfc7231">https://www.rfc-editor.org/info/rfc7231</a>&gt;.</dd><dt id="RFC7234">[RFC7234]</dt><dd>Fielding, R., Ed., Nottingham, M., Ed., and J. Reschke, Ed., “<a href="https://tools.ietf.org/html/rfc7234">Hypertext Transfer Protocol (HTTP/1.1): Caching</a>”, RFC&nbsp;7234, <a href="http://dx.doi.org/10.17487/RFC7234">DOI&nbsp;10.17487/RFC7234</a>, June&nbsp;2014, &lt;<a href="https://www.rfc-editor.org/info/rfc7234">https://www.rfc-editor.org/info/rfc7234</a>&gt;.</dd></dl></section><section id="rfc.references.2"><h3 id="rfc.section.8.2"><a href="#rfc.section.8.2">8.2.</a> Informative References</h3><dl class="dl-horizontal"><dt id="KEY">[KEY]</dt><dd>Fielding, R. and M. Nottingham, “<a href="https://tools.ietf.org/html/draft-ietf-httpbis-key-01">The Key HTTP Response Header Field</a>”, Internet-Draft&nbsp;draft-ietf-httpbis-key-01 (work in progress), March&nbsp;2016.</dd><dt id="RFC6265">[RFC6265]</dt><dd>Barth, A., “<a href="https://tools.ietf.org/html/rfc6265">HTTP State Management Mechanism</a>”, RFC&nbsp;6265, <a href="http://dx.doi.org/10.17487/RFC6265">DOI&nbsp;10.17487/RFC6265</a>, April&nbsp;2011, &lt;<a href="https://www.rfc-editor.org/info/rfc6265">https://www.rfc-editor.org/info/rfc6265</a>&gt;.</dd></dl></section></section><section id="interaction-with-key-response-header-field"><h2 id="rfc.section.A" class="np"><a href="#rfc.section.A">A.</a>&nbsp;<a href="#interaction-with-key-response-header-field">Interaction with Key Response Header Field</a></h2><div id="rfc.section.A.p.1" class="avoidbreakafter"><p>Client Hints may be combined with Key response header field (<a href="#KEY"><cite title="The Key HTTP Response Header Field">[KEY]</cite></a>) to enable fine-grained control of the cache key for improved cache efficiency. For example, the server can return the following set of instructions:</p></div><div id="rfc.figure.u.14"><pre class="text">
  Key: DPR;partition=1.5:2.5:4.0
</pre></div><div id="rfc.section.A.p.2"><p>Above example indicates that the cache key needs to include the value of the DPR header field with three segments: less than 1.5, 1.5 to less than 2.5, and 4.0 or greater.</p></div><div id="rfc.figure.u.15"><pre class="text">
  Key: Width;div=320
</pre></div><div id="rfc.section.A.p.3"><p>Above example indicates that the cache key needs to include the value of the Width header field and be partitioned into groups of 320: 0-320, 320-640, and so on.</p></div></section><section id="changes"><h2 id="rfc.section.B"><a href="#rfc.section.B">B.</a>&nbsp;<a href="#changes">Changes</a></h2><section id="since-00"><h3 id="rfc.section.B.1"><a href="#rfc.section.B.1">B.1.</a>&nbsp;<a href="#since-00">Since -00</a></h3><div id="rfc.section.B.1.p.1"><ul><li>Issue 168 (make Save-Data extensible) updated ABNF.</li><li>Issue 163 (CH review feedback) editorial feedback from httpwg list.</li><li>Issue 153 (NetInfo API citation) added normative reference.</li></ul></div></section><section id="since-01"><h3 id="rfc.section.B.2"><a href="#rfc.section.B.2">B.2.</a>&nbsp;<a href="#since-01">Since -01</a></h3><div id="rfc.section.B.2.p.1"><ul><li>Issue 200: Moved Key reference to informative.</li><li>Issue 215: Extended passive fingerprinting and mitigation considerations.</li><li>Changed document status to experimental.</li></ul></div></section><section id="since-02"><h3 id="rfc.section.B.3"><a href="#rfc.section.B.3">B.3.</a>&nbsp;<a href="#since-02">Since -02</a></h3><div id="rfc.section.B.3.p.1"><ul><li>Issue 239: Updated reference to CR-css-values-3</li><li>Issue 240: Updated reference for Network Information API</li><li>Issue 241: Consistency in IANA considerations</li><li>Issue 250: Clarified Accept-CH</li></ul></div></section><section id="since-03"><h3 id="rfc.section.B.4"><a href="#rfc.section.B.4">B.4.</a>&nbsp;<a href="#since-03">Since -03</a></h3><div id="rfc.section.B.4.p.1"><ul><li>Issue 284: Extended guidance for Accept-CH</li><li>Issue 308: Editorial cleanup</li><li>Issue 306: Define Accept-CH-Lifetime</li></ul></div></section><section id="since-04"><h3 id="rfc.section.B.5"><a href="#rfc.section.B.5">B.5.</a>&nbsp;<a href="#since-04">Since -04</a></h3><div id="rfc.section.B.5.p.1"><ul><li>Issue 361: Removed Downlink</li><li>Issue 361: Moved Key to appendix, plus other editorial feedback.</li></ul></div></section><section id="since-05"><h3 id="rfc.section.B.6"><a href="#rfc.section.B.6">B.6.</a>&nbsp;<a href="#since-05">Since -05</a></h3><div id="rfc.section.B.6.p.1"><ul><li>None</li></ul></div></section></section><section id="rfc.authors" class="avoidbreakinside"><h2><a href="#rfc.authors">Author's Address</a></h2><address><b>Ilya Grigorik</b><br>Google<br>EMail: <a href="mailto:ilya@igvita.com">ilya@igvita.com</a><br>URI: <a href="https://www.igvita.com/">https://www.igvita.com/</a></address></section></div></div></div><script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script></body></html>